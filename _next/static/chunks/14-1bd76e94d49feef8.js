(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[14],{3733:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,a=l(e),s=a[0],o=a[1],u=new i((s+o)*3/4-o),c=0,h=o>0?s-4:s;for(r=0;r<h;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[c++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a=[],s=0,o=n-i;s<o;s+=16383)a.push(function(e,t,n){for(var i,a=[],s=t;s<n;s+=3)a.push(r[(i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]))>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return a.join("")}(e,s,s+16383>o?o:s+16383));return 1===i?a.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===i&&a.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),a.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,o=a.length;s<o;++s)r[s]=a[s],n[a.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},458:function(e,t,r){"use strict";let n,i;r.d(t,{K:function(){return nc}});var a,s,o,l,u,c,h,p,d,f,y,m,g,v,b={};r.r(b),r.d(b,{Decoder:function(){return r3},Encoder:function(){return r1},PacketType:function(){return g},protocol:function(){return r0}}),r(4540);var w=r(6745);let E=(e=21)=>{let t="",r=e;for(;r--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return t};function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach(function(t){!function(e,t,r){var n;(n=function(e,t){if("object"!=x(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=x(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==x(n)?n:n+"")in e)?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function I(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var S="function"==typeof Symbol&&Symbol.observable||"@@observable",O=function(){return Math.random().toString(36).substring(7).split("").join(".")},k={INIT:"@@redux/INIT"+O(),REPLACE:"@@redux/REPLACE"+O(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+O()}};function A(e,t,r){if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw Error(I(0));if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw Error(I(1));return r(A)(e,t)}if("function"!=typeof e)throw Error(I(2));var n,i=e,a=t,s=[],o=s,l=!1;function u(){o===s&&(o=s.slice())}function c(){if(l)throw Error(I(3));return a}function h(e){if("function"!=typeof e)throw Error(I(4));if(l)throw Error(I(5));var t=!0;return u(),o.push(e),function(){if(t){if(l)throw Error(I(6));t=!1,u();var r=o.indexOf(e);o.splice(r,1),s=null}}}function p(e){if(!function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e))throw Error(I(7));if(void 0===e.type)throw Error(I(8));if(l)throw Error(I(9));try{l=!0,a=i(a,e)}finally{l=!1}for(var t=s=o,r=0;r<t.length;r++)(0,t[r])();return e}return p({type:k.INIT}),(n={dispatch:p,subscribe:h,getState:c,replaceReducer:function(e){if("function"!=typeof e)throw Error(I(10));i=e,p({type:k.REPLACE})}})[S]=function(){var e;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw Error(I(11));function t(){e.next&&e.next(c())}return t(),{unsubscribe:h(t)}}})[S]=function(){return this},e},n}function C(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}function N(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),n=function(){throw Error(I(15))},i={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},a=t.map(function(e){return e(i)});return n=C.apply(void 0,a)(r.dispatch),P(P({},r),{},{dispatch:n})}}}function M(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(e){return"'"+e+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function D(e){return!!e&&!!e[em]}function T(e){var t;return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===eg}(e)||Array.isArray(e)||!!e[ey]||!!(null===(t=e.constructor)||void 0===t?void 0:t[ey])||U(e)||W(e))}function B(e,t,r){void 0===r&&(r=!1),0===R(e)?(r?Object.keys:ev)(e).forEach(function(n){r&&"symbol"==typeof n||t(n,e[n],e)}):e.forEach(function(r,n){return t(n,r,e)})}function R(e){var t=e[em];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:U(e)?2:W(e)?3:0}function j(e,t){return 2===R(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function L(e,t,r){var n=R(e);2===n?e.set(t,r):3===n?e.add(r):e[t]=r}function U(e){return eh&&e instanceof Map}function W(e){return ep&&e instanceof Set}function z(e){return e.o||e.t}function G(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=eb(e);delete t[em];for(var r=ev(t),n=0;n<r.length;n++){var i=r[n],a=t[i];!1===a.writable&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[i]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[i]})}return Object.create(Object.getPrototypeOf(e),t)}function q(e,t){return void 0===t&&(t=!1),V(e)||D(e)||!T(e)||(R(e)>1&&(e.set=e.add=e.clear=e.delete=F),Object.freeze(e),t&&B(e,function(e,t){return q(t,!0)},!0)),e}function F(){M(2)}function V(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function $(e){var t=ew[e];return t||M(18,e),t}function J(e,t){t&&($("Patches"),e.u=[],e.s=[],e.v=t)}function H(e){K(e),e.p.forEach(X),e.p=null}function K(e){e===eu&&(eu=e.l)}function Y(e){return eu={p:[],l:eu,h:e,m:!0,_:0}}function X(e){var t=e[em];0===t.i||1===t.i?t.j():t.g=!0}function Q(e,t){t._=t.p.length;var r=t.p[0],n=void 0!==e&&e!==r;return t.h.O||$("ES5").S(t,e,n),n?(r[em].P&&(H(t),M(4)),T(e)&&(e=Z(t,e),t.l||et(t,e)),t.u&&$("Patches").M(r[em].t,e,t.u,t.s)):e=Z(t,r,[]),H(t),t.u&&t.v(t.u,t.s),e!==ef?e:void 0}function Z(e,t,r){if(V(t))return t;var n=t[em];if(!n)return B(t,function(i,a){return ee(e,n,t,i,a,r)},!0),t;if(n.A!==e)return t;if(!n.P)return et(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=4===n.i||5===n.i?n.o=G(n.k):n.o,a=i,s=!1;3===n.i&&(a=new Set(i),i.clear(),s=!0),B(a,function(t,a){return ee(e,n,i,t,a,r,s)}),et(e,i,!1),r&&e.u&&$("Patches").N(n,r,e.u,e.s)}return n.o}function ee(e,t,r,n,i,a,s){if(D(i)){var o=Z(e,i,a&&t&&3!==t.i&&!j(t.R,n)?a.concat(n):void 0);if(L(r,n,o),!D(o))return;e.m=!1}else s&&r.add(i);if(T(i)&&!V(i)){if(!e.h.D&&e._<1)return;Z(e,i),t&&t.A.l||et(e,i)}}function et(e,t,r){void 0===r&&(r=!1),!e.l&&e.h.D&&e.m&&q(t,r)}function er(e,t){var r=e[em];return(r?z(r):e)[t]}function en(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function ei(e){e.P||(e.P=!0,e.l&&ei(e.l))}function ea(e){e.o||(e.o=G(e.t))}function es(e,t,r){var n,i,a,s,o,l,u,c=U(t)?$("MapSet").F(t,r):W(t)?$("MapSet").T(t,r):e.O?(a=i={i:(n=Array.isArray(t))?1:0,A:r?r.A:eu,P:!1,I:!1,R:{},l:r,t:t,k:null,o:null,j:null,C:!1},s=eE,n&&(a=[i],s=ex),l=(o=Proxy.revocable(a,s)).revoke,u=o.proxy,i.k=u,i.j=l,u):$("ES5").J(t,r);return(r?r.A:eu).p.push(c),c}function eo(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return G(e)}var el,eu,ec="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),eh="undefined"!=typeof Map,ep="undefined"!=typeof Set,ed="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,ef=ec?Symbol.for("immer-nothing"):((el={})["immer-nothing"]=!0,el),ey=ec?Symbol.for("immer-draftable"):"__$immer_draftable",em=ec?Symbol.for("immer-state"):"__$immer_state",eg=""+Object.prototype.constructor,ev="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,eb=Object.getOwnPropertyDescriptors||function(e){var t={};return ev(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},ew={},eE={get:function(e,t){if(t===em)return e;var r,n,i=z(e);if(!j(i,t))return(n=en(i,t))?"value"in n?n.value:null===(r=n.get)||void 0===r?void 0:r.call(e.k):void 0;var a=i[t];return e.I||!T(a)?a:a===er(e.t,t)?(ea(e),e.o[t]=es(e.A.h,a,e)):a},has:function(e,t){return t in z(e)},ownKeys:function(e){return Reflect.ownKeys(z(e))},set:function(e,t,r){var n=en(z(e),t);if(null==n?void 0:n.set)return n.set.call(e.k,r),!0;if(!e.P){var i=er(z(e),t),a=null==i?void 0:i[em];if(a&&a.t===r)return e.o[t]=r,e.R[t]=!1,!0;if((r===i?0!==r||1/r==1/i:r!=r&&i!=i)&&(void 0!==r||j(e.t,t)))return!0;ea(e),ei(e)}return e.o[t]===r&&(void 0!==r||t in e.o)||Number.isNaN(r)&&Number.isNaN(e.o[t])||(e.o[t]=r,e.R[t]=!0),!0},deleteProperty:function(e,t){return void 0!==er(e.t,t)||t in e.t?(e.R[t]=!1,ea(e),ei(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=z(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:n.enumerable,value:r[t]}:n},defineProperty:function(){M(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){M(12)}},ex={};B(eE,function(e,t){ex[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),ex.deleteProperty=function(e,t){return ex.set.call(this,e,t,void 0)},ex.set=function(e,t,r){return eE.set.call(this,e[0],t,r,e[0])};var e_=new(function(){function e(e){var t=this;this.O=ed,this.D=!0,this.produce=function(e,r,n){if("function"==typeof e&&"function"!=typeof r){var i,a=r;return r=e,function(e){var n=this;void 0===e&&(e=a);for(var i=arguments.length,s=Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return t.produce(e,function(e){var t;return(t=r).call.apply(t,[n,e].concat(s))})}}if("function"!=typeof r&&M(6),void 0!==n&&"function"!=typeof n&&M(7),T(e)){var s=Y(t),o=es(t,e,void 0),l=!0;try{i=r(o),l=!1}finally{l?H(s):K(s)}return"undefined"!=typeof Promise&&i instanceof Promise?i.then(function(e){return J(s,n),Q(e,s)},function(e){throw H(s),e}):(J(s,n),Q(i,s))}if(!e||"object"!=typeof e){if(void 0===(i=r(e))&&(i=e),i===ef&&(i=void 0),t.D&&q(i,!0),n){var u=[],c=[];$("Patches").M(e,i,u,c),n(u,c)}return i}M(21,e)},this.produceWithPatches=function(e,r){if("function"==typeof e)return function(r){for(var n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return t.produceWithPatches(r,function(t){return e.apply(void 0,[t].concat(i))})};var n,i,a=t.produce(e,r,function(e,t){n=e,i=t});return"undefined"!=typeof Promise&&a instanceof Promise?a.then(function(e){return[e,n,i]}):[a,n,i]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){T(e)||M(8),D(e)&&(D(t=e)||M(22,t),e=function e(t){if(!T(t))return t;var r,n=t[em],i=R(t);if(n){if(!n.P&&(n.i<4||!$("ES5").K(n)))return n.t;n.I=!0,r=eo(t,i),n.I=!1}else r=eo(t,i);return B(r,function(t,i){var a;n&&(2===R(a=n.t)?a.get(t):a[t])===i||L(r,t,e(i))}),3===i?new Set(r):r}(t));var t,r=Y(this),n=es(this,e,void 0);return n[em].C=!0,K(r),n},t.finishDraft=function(e,t){var r=(e&&e[em]).A;return J(r,t),Q(void 0,r)},t.setAutoFreeze=function(e){this.D=e},t.setUseProxies=function(e){e&&!ed&&M(20),this.O=e},t.applyPatches=function(e,t){for(r=t.length-1;r>=0;r--){var r,n=t[r];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}r>-1&&(t=t.slice(r+1));var i=$("Patches").$;return D(e)?i(e,t):this.produce(e,function(e){return i(e,t)})},e}()),eP=e_.produce;e_.produceWithPatches.bind(e_),e_.setAutoFreeze.bind(e_),e_.setUseProxies.bind(e_),e_.applyPatches.bind(e_),e_.createDraft.bind(e_),e_.finishDraft.bind(e_);class eI{constructor(e){let t;let r=(t=4022871197,function(e){let r=e.toString();for(let e=0;e<r.length;e++){let n=.02519603282416938*(t+=r.charCodeAt(e));t=n>>>0,n-=t,n*=t,t=n>>>0,n-=t,t+=4294967296*n}return(t>>>0)*23283064365386963e-26});this.c=1,this.s0=r(" "),this.s1=r(" "),this.s2=r(" "),this.s0-=r(e),this.s0<0&&(this.s0+=1),this.s1-=r(e),this.s1<0&&(this.s1+=1),this.s2-=r(e),this.s2<0&&(this.s2+=1)}next(){let e=2091639*this.s0+23283064365386963e-26*this.c;return this.s0=this.s1,this.s1=this.s2,this.s2=e-(this.c=Math.trunc(e))}}function eS(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function eO(e,t){let r=new eI(e),n=r.next.bind(r);return t&&eS(t,r),n.state=()=>eS(r,{}),n}class ek{constructor(e){this.state=e||{seed:"0"},this.used=!1}static seed(){return Date.now().toString(36).slice(-10)}isUsed(){return this.used}getState(){return this.state}_random(){this.used=!0;let e=this.state,t=eO(e.prngstate?"":e.seed,e.prngstate),r=t();return this.state={...e,prngstate:t.state()},r}api(){let e=this._random.bind(this),t={D4:4,D6:6,D8:8,D10:10,D12:12,D20:20},r={};for(let n in t){let i=t[n];r[n]=t=>void 0===t?Math.floor(e()*i)+1:Array.from({length:t}).map(()=>Math.floor(e()*i)+1)}return{...r,Die:function(t=6,r){return void 0===r?Math.floor(e()*t)+1:Array.from({length:r}).map(()=>Math.floor(e()*t)+1)},Number:()=>e(),Shuffle:t=>{let r=[...t],n=t.length,i=0,a=Array.from({length:n});for(;n;){let t=Math.trunc(n*e());a[i++]=r[t],r[t]=r[--n]}return a},_private:this}}}let eA="MAKE_MOVE",eC="GAME_EVENT",eN="REDO",eM="RESET",eD="SYNC",eT="UNDO",eB="UPDATE",eR="PATCH",ej="PLUGIN",eL="STRIP_TRANSIENTS",eU=(e,t,r,n)=>({type:eA,payload:{type:e,args:t,playerID:r,credentials:n}}),eW=(e,t,r,n)=>({type:eC,payload:{type:e,args:t,playerID:r,credentials:n}}),ez=(e,t,r,n)=>({type:eC,payload:{type:e,args:t,playerID:r,credentials:n},automatic:!0}),eG=e=>({type:eD,state:e.state,log:e.log,initialState:e.initialState,clientOnly:!0}),eq=(e,t,r,n)=>({type:eR,prevStateID:e,stateID:t,patch:r,deltalog:n,clientOnly:!0}),eF=(e,t)=>({type:eB,state:e,deltalog:t,clientOnly:!0}),eV=e=>({type:eM,state:e,clientOnly:!0}),e$=(e,t)=>({type:eT,payload:{type:null,args:null,playerID:e,credentials:t}}),eJ=(e,t)=>({type:eN,payload:{type:null,args:null,playerID:e,credentials:t}}),eH=()=>({type:eL});var eK=Object.freeze({__proto__:null,makeMove:eU,gameEvent:eW,automaticGameEvent:ez,sync:eG,patch:eq,update:eF,reset:eV,undo:e$,redo:eJ,plugin:(e,t,r,n)=>({type:ej,payload:{type:e,args:t,playerID:r,credentials:n}}),stripTransients:eH});let eY="INVALID_MOVE";(a=p||(p={})).MOVE="MOVE",a.GAME_ON_END="GAME_ON_END",a.PHASE_ON_BEGIN="PHASE_ON_BEGIN",a.PHASE_ON_END="PHASE_ON_END",a.TURN_ON_BEGIN="TURN_ON_BEGIN",a.TURN_ON_MOVE="TURN_ON_MOVE",a.TURN_ON_END="TURN_ON_END",(s=d||(d={})).CalledOutsideHook="Events must be called from moves or the `onBegin`, `onEnd`, and `onMove` hooks.\nThis error probably means you called an event from other game code, like an `endIf` trigger or one of the `turn.order` methods.",s.EndTurnInOnEnd="`endTurn` is disallowed in `onEnd` hooks — the turn is already ending.",s.MaxTurnEndings="Maximum number of turn endings exceeded for this update.\nThis likely means game code is triggering an infinite loop.",s.PhaseEventInOnEnd="`setPhase` & `endPhase` are disallowed in a phase’s `onEnd` hook — the phase is already ending.\nIf you’re trying to dynamically choose the next phase when a phase ends, use the phase’s `next` trigger.",s.StageEventInOnEnd="`setStage`, `endStage` & `setActivePlayers` are disallowed in `onEnd` hooks.",s.StageEventInPhaseBegin="`setStage`, `endStage` & `setActivePlayers` are disallowed in a phase’s `onBegin` hook.\nUse `setActivePlayers` in a `turn.onBegin` hook or declare stages with `turn.activePlayers` instead.",s.StageEventInTurnBegin="`setStage` & `endStage` are disallowed in `turn.onBegin`.\nUse `setActivePlayers` or declare stages with `turn.activePlayers` instead.";class eX{constructor(e,t,r){this.flow=e,this.playerID=r,this.dispatch=[],this.initialTurn=t.turn,this.updateTurnContext(t,void 0),this.maxEndedTurnsPerAction=100*t.numPlayers}api(){let e={_private:this};for(let t of this.flow.eventNames)e[t]=(...e)=>{this.dispatch.push({type:t,args:e,phase:this.currentPhase,turn:this.currentTurn,calledFrom:this.currentMethod,error:Error("Events Plugin Error")})};return e}isUsed(){return this.dispatch.length>0}updateTurnContext(e,t){this.currentPhase=e.phase,this.currentTurn=e.turn,this.currentMethod=t}unsetCurrentMethod(){this.currentMethod=void 0}update(e){let t=e,r=({stack:e},r)=>({...t,plugins:{...t.plugins,events:{...t.plugins.events,data:{error:r+"\n"+e}}}});for(let t=0;t<this.dispatch.length;t++){let n=this.dispatch[t],i=n.turn!==e.ctx.turn;if(this.currentTurn-this.initialTurn>=this.maxEndedTurnsPerAction)return r(n.error,d.MaxTurnEndings);if(void 0===n.calledFrom)return r(n.error,d.CalledOutsideHook);if(e.ctx.gameover)break;switch(n.type){case"endStage":case"setStage":case"setActivePlayers":switch(n.calledFrom){case p.TURN_ON_END:case p.PHASE_ON_END:return r(n.error,d.StageEventInOnEnd);case p.PHASE_ON_BEGIN:return r(n.error,d.StageEventInPhaseBegin);case p.TURN_ON_BEGIN:if("setActivePlayers"===n.type)break;return r(n.error,d.StageEventInTurnBegin)}if(i)continue;break;case"endTurn":if(n.calledFrom===p.TURN_ON_END||n.calledFrom===p.PHASE_ON_END)return r(n.error,d.EndTurnInOnEnd);if(i)continue;break;case"endPhase":case"setPhase":if(n.calledFrom===p.PHASE_ON_END)return r(n.error,d.PhaseEventInOnEnd);if(n.phase!==e.ctx.phase)continue}let a=ez(n.type,n.args,this.playerID);e=this.flow.processEvent(e,a)}return e}}let eQ={name:"events",noClient:({api:e})=>e._private.isUsed(),isInvalid:({data:e})=>e.error||!1,fnWrap:(e,t)=>(r,...n)=>{let i=r.events;i&&i._private.updateTurnContext(r.ctx,t);let a=e(r,...n);return i&&i._private.unsetCurrentMethod(),a},dangerouslyFlushRawState:({state:e,api:t})=>t._private.update(e),api:({game:e,ctx:t,playerID:r})=>new eX(e.flow,t,r).api()},eZ=()=>{},e0=(...e)=>console.error(...e);function e1(e){eZ(`INFO: ${e}`)}function e2(e){e0("ERROR:",e)}let e3=[{name:"plugin-immer",fnWrap:e=>(t,...r)=>{let n=!1,i=eP(t.G,i=>{let a=e({...t,G:i},...r);if(a===eY){n=!0;return}return a});return n?eY:i}},{name:"random",noClient:({api:e})=>e._private.isUsed(),flush:({api:e})=>e._private.getState(),api:({data:e})=>new ek(e).api(),setup:({game:e})=>{let{seed:t}=e;return void 0===t&&(t=ek.seed()),{seed:t}},playerView:()=>void 0},{name:"log",flush:()=>({}),api:({data:e})=>({setMetadata:t=>{e.metadata=t}}),setup:()=>({})},{name:"plugin-serializable",fnWrap:e=>(t,...r)=>e(t,...r)}],e6=[...e3,eQ],e5=(e,t,r)=>(r.game.plugins.filter(e=>void 0!==e.action).filter(e=>e.name===t.payload.type).forEach(r=>{let n=r.name,i=e.plugins[n]||{data:{}},a=r.action(i.data,t.payload);e={...e,plugins:{...e.plugins,[n]:{...i,data:a}}}}),e),e8=({plugins:e})=>Object.entries(e||{}).reduce((e,[t,{api:r}])=>(e[t]=r,e),{}),e4=(e,t,r)=>[...e3,...r,eQ].filter(e=>void 0!==e.fnWrap).reduce((e,{fnWrap:r})=>r(e,t),e),e9=(e,t)=>([...e6,...t.game.plugins].filter(e=>void 0!==e.setup).forEach(r=>{let n=r.name,i=r.setup({G:e.G,ctx:e.ctx,game:t.game});e={...e,plugins:{...e.plugins,[n]:{data:i}}}}),e),e7=(e,t)=>([...e6,...t.game.plugins].filter(e=>void 0!==e.api).forEach(r=>{let n=r.name,i=e.plugins[n]||{data:{}},a=r.api({G:e.G,ctx:e.ctx,data:i.data,game:t.game,playerID:t.playerID});e={...e,plugins:{...e.plugins,[n]:{...i,api:a}}}}),e),te=(e,t)=>([...e3,...t.game.plugins,eQ].reverse().forEach(r=>{let n=r.name,i=e.plugins[n]||{data:{}};if(r.flush){let n=r.flush({G:e.G,ctx:e.ctx,game:t.game,api:i.api,data:i.data});e={...e,plugins:{...e.plugins,[r.name]:{data:n}}}}else if(r.dangerouslyFlushRawState){let a=(e=r.dangerouslyFlushRawState({state:e,game:t.game,api:i.api,data:i.data})).plugins[n].data;e={...e,plugins:{...e.plugins,[r.name]:{data:a}}}}}),e),tt=(e,t)=>[...e6,...t.game.plugins].filter(e=>void 0!==e.noClient).map(r=>{let n=r.name,i=e.plugins[n];return!!i&&r.noClient({G:e.G,ctx:e.ctx,game:t.game,api:i.api,data:i.data})}).includes(!0),tr=(e,t)=>[...e6,...t.game.plugins].filter(e=>void 0!==e.isInvalid).map(r=>{let{name:n}=r,i=e.plugins[n],a=r.isInvalid({G:e.G,ctx:e.ctx,game:t.game,data:i&&i.data});return!!a&&{plugin:n,message:a}}).find(e=>e)||!1,tn=(e,t)=>{let r=te(e,t),n=tr(r,t);if(!n)return[r];let{plugin:i,message:a}=n;return e2(`${i} plugin declared action invalid:
${a}`),[e,n]},ti=({G:e,ctx:t,plugins:r={}},{game:n,playerID:i})=>([...e6,...n.plugins].forEach(({name:a,playerView:s})=>{if(!s)return;let{data:o}=r[a]||{data:{}},l=s({G:e,ctx:t,game:n,data:o,playerID:i});r={...r,[a]:{data:l}}}),r);function ta(e,t=!1){e.moveLimit&&(t&&(e.minMoves=e.moveLimit),e.maxMoves=e.moveLimit,delete e.moveLimit)}function ts(e,t){let r={},n=[],i=null,a={},s={};if(Array.isArray(t)){let e={};t.forEach(t=>e[t]=tu.NULL),r=e}else{if(ta(t),t.next&&(i=t.next),t.revert&&(n=[...e._prevActivePlayers,{activePlayers:e.activePlayers,_activePlayersMinMoves:e._activePlayersMinMoves,_activePlayersMaxMoves:e._activePlayersMaxMoves,_activePlayersNumMoves:e._activePlayersNumMoves}]),void 0!==t.currentPlayer&&to(r,a,s,e.currentPlayer,t.currentPlayer),void 0!==t.others)for(let n=0;n<e.playOrder.length;n++){let i=e.playOrder[n];i!==e.currentPlayer&&to(r,a,s,i,t.others)}if(void 0!==t.all)for(let n=0;n<e.playOrder.length;n++)to(r,a,s,e.playOrder[n],t.all);if(t.value)for(let e in t.value)to(r,a,s,e,t.value[e]);if(t.minMoves)for(let e in r)void 0===a[e]&&(a[e]=t.minMoves);if(t.maxMoves)for(let e in r)void 0===s[e]&&(s[e]=t.maxMoves)}0===Object.keys(r).length&&(r=null),0===Object.keys(a).length&&(a=null),0===Object.keys(s).length&&(s=null);let o={};for(let e in r)o[e]=0;return{...e,activePlayers:r,_activePlayersMinMoves:a,_activePlayersMaxMoves:s,_activePlayersNumMoves:o,_prevActivePlayers:n,_nextActivePlayers:i}}function to(e,t,r,n,i){("object"!=typeof i||i===tu.NULL)&&(i={stage:i}),void 0!==i.stage&&(ta(i),e[n]=i.stage,i.minMoves&&(t[n]=i.minMoves),i.maxMoves&&(r[n]=i.maxMoves))}let tl={DEFAULT:{first:({ctx:e})=>0===e.turn?e.playOrderPos:(e.playOrderPos+1)%e.playOrder.length,next:({ctx:e})=>(e.playOrderPos+1)%e.playOrder.length}},tu={NULL:null};function tc(e){if(void 0!==e.processMove)return e;if(void 0===e.name&&(e.name="default"),void 0===e.deltaState&&(e.deltaState=!1),void 0===e.disableUndo&&(e.disableUndo=!1),void 0===e.setup&&(e.setup=()=>({})),void 0===e.moves&&(e.moves={}),void 0===e.playerView&&(e.playerView=({G:e})=>e),void 0===e.plugins&&(e.plugins=[]),e.plugins.forEach(e=>{if(void 0===e.name)throw Error("Plugin missing name attribute");if(e.name.includes(" "))throw Error(e.name+": Plugin name must not include spaces")}),e.name.includes(" "))throw Error(e.name+": Game name must not include spaces");let t=function({moves:e,phases:t,endIf:r,onEnd:n,turn:i,events:a,plugins:s}){void 0===e&&(e={}),void 0===a&&(a={}),void 0===s&&(s=[]),void 0===t&&(t={}),r||(r=()=>void 0),n||(n=({G:e})=>e),i||(i={});let o={...t};""in o&&e2("cannot specify phase with empty name"),o[""]={};let l={},u=new Set,c=null;Object.keys(e).forEach(e=>u.add(e));let h=(e,t)=>{let r=e4(e,t,s);return e=>r({...e8(e),G:e.G,ctx:e.ctx,playerID:e.playerID})},d=e=>t=>e({...e8(t),G:t.G,ctx:t.ctx}),f={onEnd:h(n,p.GAME_ON_END),endIf:d(r)};for(let e in o){let t=o[e];if(!0===t.start&&(c=e),void 0!==t.moves)for(let r of Object.keys(t.moves))l[e+"."+r]=t.moves[r],u.add(r);for(let r in void 0===t.endIf&&(t.endIf=()=>void 0),void 0===t.onBegin&&(t.onBegin=({G:e})=>e),void 0===t.onEnd&&(t.onEnd=({G:e})=>e),void 0===t.turn&&(t.turn=i),void 0===t.turn.order&&(t.turn.order=tl.DEFAULT),void 0===t.turn.onBegin&&(t.turn.onBegin=({G:e})=>e),void 0===t.turn.onEnd&&(t.turn.onEnd=({G:e})=>e),void 0===t.turn.endIf&&(t.turn.endIf=()=>!1),void 0===t.turn.onMove&&(t.turn.onMove=({G:e})=>e),void 0===t.turn.stages&&(t.turn.stages={}),ta(t.turn,!0),t.turn.stages){let n=t.turn.stages[r].moves||{};for(let t of Object.keys(n))l[e+"."+r+"."+t]=n[t],u.add(t)}if(t.wrapped={onBegin:h(t.onBegin,p.PHASE_ON_BEGIN),onEnd:h(t.onEnd,p.PHASE_ON_END),endIf:d(t.endIf)},t.turn.wrapped={onMove:h(t.turn.onMove,p.TURN_ON_MOVE),onBegin:h(t.turn.onBegin,p.TURN_ON_BEGIN),onEnd:h(t.turn.onEnd,p.TURN_ON_END),endIf:d(t.turn.endIf)},"function"!=typeof t.next){let{next:e}=t;t.next=()=>e||null}t.wrapped.next=d(t.next)}function y(e){return e.phase?o[e.phase]:o[""]}function m(e){return e}function g(e,t){let r=new Set,n=new Set;for(let s=0;s<t.length;s++){var i,a;let{fn:o,arg:l,...u}=t[s];if(o===S){n.clear();let t=e.ctx.phase;if(r.has(t)){let t={...e.ctx,phase:null};return{...e,ctx:t}}r.add(t)}let c=[];if(e=o(e,{...u,arg:l,next:c}),o===I)break;let h=(i=e,f.endIf(i));if(h){t.push({fn:I,arg:h,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});continue}let p=y((a=e).ctx).wrapped.endIf(a);if(p){t.push({fn:S,arg:p,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});continue}if([m,_,P].includes(o)){let r=function(e){let t=y(e.ctx),r=e.ctx.numMoves||0;return!!t.turn.maxMoves&&r>=t.turn.maxMoves||t.turn.wrapped.endIf(e)}(e);if(r){t.push({fn:O,arg:r,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});continue}}t.push(...c)}return e}function v(e,{next:t}){return t.push({fn:b}),e}function b(e,{next:t}){let{G:r,ctx:n}=e;return r=y(n).wrapped.onBegin(e),t.push({fn:w}),{...e,G:r,ctx:n}}function w(e,{currentPlayer:t}){let{ctx:r}=e,n=y(r);t?(r={...r,currentPlayer:t},n.turn.activePlayers&&(r=ts(r,n.turn.activePlayers))):r=function(e,t){let{G:r,ctx:n}=e,{numPlayers:i}=n,a={...e8(e),G:r,ctx:n},s=t.order,o=[...Array.from({length:i})].map((e,t)=>t+"");void 0!==s.playOrder&&(o=s.playOrder(a));let l=s.first(a),u=typeof l;"number"!==u&&e2(`invalid value returned by turn.order.first — expected number got ${u} “${l}”.`);let c=o[l]+"";return ts(n={...n,currentPlayer:c,playOrderPos:l,playOrder:o},t.activePlayers||{})}(e,n.turn);let i=r.turn+1;r={...r,turn:i,numMoves:0,_prevActivePlayers:[]};let a=n.turn.wrapped.onBegin({...e,ctx:r});return{...e,G:a,ctx:r,_undo:[],_redo:[]}}function E(e,{arg:t,next:r,phase:n}){let i=y({phase:n}),{ctx:a}=e;if(t&&t.next){if(!(t.next in o))return e2("invalid phase: "+t.next),e;a={...a,phase:t.next}}else a={...a,phase:i.wrapped.next(e)||null};return e={...e,ctx:a},r.push({fn:b}),e}function x(e,{arg:t,currentPlayer:r,next:n}){let{G:i,ctx:a}=e,{endPhase:s,ctx:o}=function(e,t,r,n){let i=r.order,{G:a,ctx:s}=e,o=s.playOrderPos,l=!1;if(n&&!0!==n)"object"!=typeof n&&e2(`invalid argument to endTurn: ${n}`),Object.keys(n).forEach(e=>{switch(e){case"remove":t=s.playOrder[o]+"";break;case"next":o=s.playOrder.indexOf(n.next),t=n.next;break;default:e2(`invalid argument to endTurn: ${e}`)}});else{let r={...e8(e),G:a,ctx:s},n=i.next(r),u=typeof n;(void 0!==n&&"number"!==u&&e2(`invalid value returned by turn.order.next — expected number or undefined got ${u} “${n}”.`),void 0===n)?l=!0:(o=n,t=s.playOrder[o]+"")}return{endPhase:l,ctx:s={...s,playOrderPos:o,currentPlayer:t}}}(e,r,y(a).turn,t);return a=o,e={...e,G:i,ctx:a},s?n.push({fn:S,turn:a.turn,phase:a.phase}):n.push({fn:w,currentPlayer:a.currentPlayer}),e}function _(e,{arg:t,playerID:r}){if(("string"==typeof t||t===tu.NULL)&&(t={stage:t}),"object"!=typeof t)return e;ta(t);let{ctx:n}=e,{activePlayers:i,_activePlayersMinMoves:a,_activePlayersMaxMoves:s,_activePlayersNumMoves:o}=n;return void 0!==t.stage&&(null===i&&(i={}),i[r]=t.stage,o[r]=0,t.minMoves&&(null===a&&(a={}),a[r]=t.minMoves),t.maxMoves&&(null===s&&(s={}),s[r]=t.maxMoves)),n={...n,activePlayers:i,_activePlayersMinMoves:a,_activePlayersMaxMoves:s,_activePlayersNumMoves:o},{...e,ctx:n}}function P(e,{arg:t}){return{...e,ctx:ts(e.ctx,t)}}function I(e,{arg:t,phase:r}){e=S(e,{phase:r}),void 0===t&&(t=!0),e={...e,ctx:{...e.ctx,gameover:t}};let n=f.onEnd(e);return{...e,G:n}}function S(e,{arg:t,next:r,turn:n,automatic:i}){let{phase:a,turn:s}=(e=O(e,{turn:n,force:!0,automatic:!0})).ctx;if(r&&r.push({fn:E,arg:t,phase:a}),null===a)return e;let o=y(e.ctx).wrapped.onEnd(e),l={...e.ctx,phase:null},u=eW("endPhase",t),{_stateID:c}=e,h={action:u,_stateID:c,turn:s,phase:a};i&&(h.automatic=!0);let p=[...e.deltalog||[],h];return{...e,G:o,ctx:l,deltalog:p}}function O(e,{arg:t,next:r,turn:n,force:i,automatic:a,playerID:s}){if(n!==e.ctx.turn)return e;let{currentPlayer:o,numMoves:l,phase:u,turn:c}=e.ctx,h=y(e.ctx);if(!i&&h.turn.minMoves&&(l||0)<h.turn.minMoves)return e1(`cannot end turn before making ${h.turn.minMoves} moves`),e;let p=h.turn.wrapped.onEnd(e);r&&r.push({fn:x,arg:t,currentPlayer:o});let d={...e.ctx,activePlayers:null};if(t&&t.remove){s=s||o;let t=d.playOrder.filter(e=>e!=s),n=d.playOrderPos>t.length-1?0:d.playOrderPos;if(d={...d,playOrder:t,playOrderPos:n},0===t.length)return r.push({fn:S,turn:c,phase:u}),e}let f=eW("endTurn",t),{_stateID:m}=e,g={action:f,_stateID:m,turn:c,phase:u};a&&(g.automatic=!0);let v=[...e.deltalog||[],g];return{...e,G:p,ctx:d,deltalog:v,_undo:[],_redo:[]}}function k(e,{arg:t,next:r,automatic:n,playerID:i}){i=i||e.ctx.currentPlayer;let{ctx:a,_stateID:s}=e,{activePlayers:o,_activePlayersNumMoves:l,_activePlayersMinMoves:u,_activePlayersMaxMoves:c,phase:h,turn:p}=a,d=null!==o&&i in o,f=y(a);if(!t&&d){let e=f.turn.stages[o[i]];e&&e.next&&(t=e.next)}if(r&&r.push({fn:_,arg:t,playerID:i}),!d)return e;let m=l[i]||0;if(u&&u[i]&&m<u[i])return e1(`cannot end stage before making ${u[i]} moves`),e;o={...o},delete o[i],u&&(u={...u},delete u[i]),c&&(c={...c},delete c[i]),a=function(e){let{activePlayers:t,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:i,_prevActivePlayers:a,_nextActivePlayers:s}=e;if(t&&0===Object.keys(t).length){if(s)e=ts(e,s),{activePlayers:t,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:i,_prevActivePlayers:a}=e;else if(a.length>0){let e=a.length-1;({activePlayers:t,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:i}=a[e]),a=a.slice(0,e)}else t=null,r=null,n=null}return{...e,activePlayers:t,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:i,_prevActivePlayers:a}}({...a,activePlayers:o,_activePlayersMinMoves:u,_activePlayersMaxMoves:c});let g={action:eW("endStage",t),_stateID:s,turn:p,phase:h};n&&(g.automatic=!0);let v=[...e.deltalog||[],g];return{...e,ctx:a,deltalog:v}}function A(t,r,n){let i=y(t),a=i.turn.stages,{activePlayers:s}=t;if(s&&void 0!==s[n]&&s[n]!==tu.NULL&&void 0!==a[s[n]]&&void 0!==a[s[n]].moves){let e=a[s[n]].moves;if(r in e)return e[r]}else if(i.moves){if(r in i.moves)return i.moves[r]}else if(r in e)return e[r];return null}let C={endStage:function(e,t){return g(e,[{fn:k,playerID:t}])},setStage:function(e,t,r){return g(e,[{fn:k,arg:r,playerID:t}])},endTurn:function(e,t,r){return g(e,[{fn:O,turn:e.ctx.turn,phase:e.ctx.phase,arg:r}])},pass:function(e,t,r){return g(e,[{fn:O,turn:e.ctx.turn,phase:e.ctx.phase,force:!0,arg:r}])},endPhase:function(e){return g(e,[{fn:S,phase:e.ctx.phase,turn:e.ctx.turn}])},setPhase:function(e,t,r){return g(e,[{fn:S,phase:e.ctx.phase,turn:e.ctx.turn,arg:{next:r}}])},endGame:function(e,t,r){return g(e,[{fn:I,turn:e.ctx.turn,phase:e.ctx.phase,arg:r}])},setActivePlayers:function(e,t,r){return g(e,[{fn:P,arg:r}])}},N=[];return!1!==a.endTurn&&N.push("endTurn"),!1!==a.pass&&N.push("pass"),!1!==a.endPhase&&N.push("endPhase"),!1!==a.setPhase&&N.push("setPhase"),!1!==a.endGame&&N.push("endGame"),!1!==a.setActivePlayers&&N.push("setActivePlayers"),!1!==a.endStage&&N.push("endStage"),!1!==a.setStage&&N.push("setStage"),{ctx:e=>({numPlayers:e,turn:0,currentPlayer:"0",playOrder:[...Array.from({length:e})].map((e,t)=>t+""),playOrderPos:0,phase:c,activePlayers:null}),init:e=>g(e,[{fn:v}]),isPlayerActive:function(e,t,r){return t.activePlayers?r in t.activePlayers:t.currentPlayer===r},eventHandlers:C,eventNames:Object.keys(C),enabledEventNames:N,moveMap:l,moveNames:[...u.values()],processMove:function(e,t){let{playerID:r,type:n}=t,{currentPlayer:i,activePlayers:a,_activePlayersMaxMoves:s}=e.ctx,o=A(e.ctx,n,r),l=!o||"function"==typeof o||!0!==o.noLimit,{numMoves:u,_activePlayersNumMoves:c}=e.ctx;l&&(r===i&&u++,a&&c[r]++),e={...e,ctx:{...e.ctx,numMoves:u,_activePlayersNumMoves:c}},s&&c[r]>=s[r]&&(e=k(e,{playerID:r,automatic:!0}));let h=y(e.ctx).turn.wrapped.onMove({...e,playerID:r});return g(e={...e,G:h},[{fn:m}])},processEvent:function(e,t){let{type:r,playerID:n,args:i}=t.payload;return"function"!=typeof C[r]?e:C[r](e,n,...Array.isArray(i)?i:[i])},getMove:A}}(e);return{...e,flow:t,moveNames:t.moveNames,pluginNames:e.plugins.map(e=>e.name),processMove:(r,n)=>{let i=t.getMove(r.ctx,n.type,n.playerID);if(th(i)&&(i=i.move),i instanceof Function){let t=e4(i,p.MOVE,e.plugins),a=[];return void 0!==n.args&&(a=Array.isArray(n.args)?n.args:[n.args]),t({...e8(r),G:r.G,ctx:r.ctx,playerID:n.playerID},...a)}return e2(`invalid move object: ${n.type}`),r.G}}}function th(e){return e instanceof Object&&void 0!==e.move}tu.NULL,tu.NULL,tu.NULL,tu.NULL,(o=f||(f={})).UnauthorizedAction="update/unauthorized_action",o.MatchNotFound="update/match_not_found",o.PatchFailed="update/patch_failed",(l=y||(y={})).StaleStateId="action/stale_state_id",l.UnavailableMove="action/unavailable_move",l.InvalidMove="action/invalid_move",l.InactivePlayer="action/inactive_player",l.GameOver="action/gameover",l.ActionDisabled="action/action_disabled",l.ActionInvalid="action/action_invalid",l.PluginActionInvalid="action/plugin_invalid";let tp=e=>null!==e.payload.playerID&&void 0!==e.payload.playerID,td=(e,t,r)=>void 0===r.undoable||(r.undoable instanceof Function?r.undoable({G:e,ctx:t}):r.undoable);function tf(e,t){if(t.game.disableUndo)return e;let r={G:e.G,ctx:e.ctx,plugins:e.plugins,playerID:t.action.payload.playerID||e.ctx.currentPlayer};return"MAKE_MOVE"===t.action.type&&(r.moveType=t.action.payload.type),{...e,_undo:[...e._undo,r],_redo:[]}}function ty(e,t,r){let n={action:t,_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase},i=e.plugins.log.data.metadata;return void 0!==i&&(n.metadata=i),"object"==typeof r&&!0===r.redact?n.redact=!0:"object"==typeof r&&r.redact instanceof Function&&(n.redact=r.redact({G:e.G,ctx:e.ctx})),{...e,deltalog:[n]}}function tm(e,t,r){let[n,i]=tn(e,r);return i?[n,tv(t,y.PluginActionInvalid,i)]:[n]}function tg(e){if(!e)return[null,void 0];let{transients:t,...r}=e;return[r,t]}function tv(e,t,r){return{...e,transients:{error:{type:t,payload:r}}}}let tb=e=>t=>r=>{let n=t(r);if(r.type===eL)return n;{let[,t]=tg(e.getState());return void 0!==t?(e.dispatch(eH()),{...n,transients:t}):n}};function tw({game:e,isClient:t}){return e=tc(e),(r=null,n)=>{let[i]=tg(r);switch(n.type){case eL:return i;case eC:{let r;if(i={...i,deltalog:[]},t)return i;if(void 0!==i.ctx.gameover)return e2("cannot call event after game end"),tv(i,y.GameOver);if(tp(n)&&!e.flow.isPlayerActive(i.G,i.ctx,n.payload.playerID))return e2(`disallowed event: ${n.payload.type}`),tv(i,y.InactivePlayer);i=e7(i,{game:e,isClient:!1,playerID:n.payload.playerID});let a=e.flow.processEvent(i,n);if([a,r]=tm(a,i,{game:e,isClient:!1}),r)return r;return{...a=tf(a,{game:e,action:n}),_stateID:i._stateID+1}}case eA:{let r;let a=i={...i,deltalog:[]},s=e.flow.getMove(i.ctx,n.payload.type,n.payload.playerID||i.ctx.currentPlayer);if(null===s)return e2(`disallowed move: ${n.payload.type}`),tv(i,y.UnavailableMove);if(t&&!1===s.client)return i;if(void 0!==i.ctx.gameover)return e2("cannot make move after game end"),tv(i,y.GameOver);if(tp(n)&&!e.flow.isPlayerActive(i.G,i.ctx,n.payload.playerID))return e2(`disallowed move: ${n.payload.type}`),tv(i,y.InactivePlayer);i=e7(i,{game:e,isClient:t,playerID:n.payload.playerID});let o=e.processMove(i,n.payload);if(o===eY)return e2(`invalid move: ${n.payload.type} args: ${n.payload.args}`),tv(i,y.InvalidMove);let l={...i,G:o};if(t&&tt(l,{game:e}))return i;if(i=l,t){let t;if([i,t]=tm(i,a,{game:e,isClient:!0}),t)return t;return{...i,_stateID:i._stateID+1}}if(i=ty(i,n,s),i=e.flow.processMove(i,n.payload),[i,r]=tm(i,a,{game:e}),r)return r;return{...i=tf(i,{game:e,action:n}),_stateID:i._stateID+1}}case eM:case eB:case eD:return n.state;case eT:{if(i={...i,deltalog:[]},e.disableUndo)return e2("Undo is not enabled"),tv(i,y.ActionDisabled);let{G:t,ctx:r,_undo:a,_redo:s,_stateID:o}=i;if(a.length<2)return e2("No moves to undo"),tv(i,y.ActionInvalid);let l=a[a.length-1],u=a[a.length-2];if(tp(n)&&n.payload.playerID!==l.playerID)return e2("Cannot undo other players' moves"),tv(i,y.ActionInvalid);if(l.moveType&&!td(t,r,e.flow.getMove(u.ctx,l.moveType,l.playerID)))return e2("Move cannot be undone"),tv(i,y.ActionInvalid);return{...i=ty(i,n),G:u.G,ctx:u.ctx,plugins:u.plugins,_stateID:o+1,_undo:a.slice(0,-1),_redo:[l,...s]}}case eN:{if(i={...i,deltalog:[]},e.disableUndo)return e2("Redo is not enabled"),tv(i,y.ActionDisabled);let{_undo:t,_redo:r,_stateID:a}=i;if(0===r.length)return e2("No moves to redo"),tv(i,y.ActionInvalid);let s=r[0];if(tp(n)&&n.payload.playerID!==s.playerID)return e2("Cannot redo other players' moves"),tv(i,y.ActionInvalid);return{...i=ty(i,n),G:s.G,ctx:s.ctx,plugins:s.plugins,_stateID:a+1,_undo:[...t,s],_redo:r.slice(1)}}case ej:return e5(i,n,{game:e});case eR:{let e=i,t=JSON.parse(JSON.stringify(e)),r=(0,w.af)(t,n.patch);if(r.some(e=>null!==e))return e2(`Patch ${JSON.stringify(n.patch)} apply failed`),tv(e,f.PatchFailed,r);return t}default:return i}}}function tE({game:e,numPlayers:t,setupData:r}){e=tc(e),t||(t=2);let n={G:{},ctx:e.flow.ctx(t),plugins:{}},i=e8(n=e7(n=e9(n,{game:e}),{game:e,playerID:void 0}));n.G=e.setup({...i,ctx:n.ctx},r);let a={...n,_undo:[],_redo:[],_stateID:0};return a=e.flow.init(a),[a]=tn(a,{game:e}),e.disableUndo||(a._undo=[{G:a.G,ctx:a.ctx,plugins:a.plugins}]),a}class tx{constructor({transportDataCallback:e,gameName:t,playerID:r,matchID:n,credentials:i,numPlayers:a}){this.connectionStatusCallback=()=>{},this.isConnected=!1,this.transportDataCallback=e,this.gameName=t||"default",this.playerID=r||null,this.matchID=n||"default",this.credentials=i,this.numPlayers=a||2}subscribeToConnectionStatus(e){this.connectionStatusCallback=e}setConnectionStatus(e){this.isConnected=e,this.connectionStatusCallback()}notifyClient(e){this.transportDataCallback(e)}}class t_ extends tx{connect(){}disconnect(){}sendAction(){}sendChatMessage(){}requestSync(){}updateCredentials(){}updateMatchID(){}updatePlayerID(){}}let tP=e=>new t_(e);class tI{constructor(){this.debugPanel=null,this.currentClient=null,this.clients=new Map,this.subscribers=new Map}register(e){this.clients.set(e,e),this.mountDebug(e),this.notifySubscribers()}unregister(e){if(this.clients.delete(e),this.currentClient===e)for(let[e]of(this.unmountDebug(),this.clients)){if(this.debugPanel)break;this.mountDebug(e)}this.notifySubscribers()}subscribe(e){let t=Symbol();return this.subscribers.set(t,e),e(this.getState()),()=>{this.subscribers.delete(t)}}switchPlayerID(e){if(this.currentClient.multiplayer){for(let[t]of this.clients)if(t.playerID===e&&!1!==t.debugOpt&&t.multiplayer===this.currentClient.multiplayer){this.switchToClient(t);return}}this.currentClient.updatePlayerID(e),this.notifySubscribers()}switchToClient(e){e!==this.currentClient&&(this.unmountDebug(),this.mountDebug(e),this.notifySubscribers())}notifySubscribers(){let e=this.getState();this.subscribers.forEach(t=>{t(e)})}getState(){return{client:this.currentClient,debuggableClients:this.getDebuggableClients()}}getDebuggableClients(){return[...this.clients.values()].filter(e=>!1!==e.debugOpt)}mountDebug(e){let t;if(!1===e.debugOpt||null!==this.debugPanel||"undefined"==typeof document)return;let r=document.body;e.debugOpt&&!0!==e.debugOpt&&(t=e.debugOpt.impl||t,r=e.debugOpt.target||r),t&&(this.currentClient=e,this.debugPanel=new t({target:r,props:{clientManager:this}}))}unmountDebug(){this.debugPanel.$destroy(),this.debugPanel=null,this.currentClient=null}}let tS=new tI;function tO(e,t,r){return r||null!=e||(e=t.getState().ctx.currentPlayer),e}function tk(e,t,r,n,i,a){let s={};for(let o of t)s[o]=(...t)=>{let s=eK[e](o,t,tO(n,r,a),i);r.dispatch(s)};return s}let tA=tk.bind(null,"makeMove"),tC=tk.bind(null,"gameEvent"),tN=tk.bind(null,"plugin");class tM{constructor({game:e,debug:t,numPlayers:r,multiplayer:n,matchID:i,playerID:a,credentials:s,enhancer:o}){this.game=tc(e),this.playerID=a,this.matchID=i||"default",this.credentials=s,this.multiplayer=n,this.debugOpt=t,this.manager=tS,this.gameStateOverride=null,this.subscribers={},this._running=!1,this.reducer=tw({game:this.game,isClient:void 0!==n}),this.initialState=null,n||(this.initialState=tE({game:this.game,numPlayers:r})),this.reset=()=>{this.store.dispatch(eV(this.initialState))},this.undo=()=>{let e=e$(tO(this.playerID,this.store,this.multiplayer),this.credentials);this.store.dispatch(e)},this.redo=()=>{let e=eJ(tO(this.playerID,this.store,this.multiplayer),this.credentials);this.store.dispatch(e)},this.log=[];let l=N(tb,()=>e=>t=>{let r=e(t);return this.notifySubscribers(),r},e=>t=>r=>{let n=e.getState(),i=t(r);return"clientOnly"in r||r.type===eL||this.transport.sendAction(n,r),i},e=>t=>r=>{let n=t(r),i=e.getState();switch(r.type){case eA:case eC:case eT:case eN:{let e=i.deltalog;this.log=[...this.log,...e];break}case eM:this.log=[];break;case eR:case eB:{let e=-1;this.log.length>0&&(e=this.log[this.log.length-1]._stateID);let t=r.deltalog||[];t=t.filter(t=>t._stateID>e),this.log=[...this.log,...t];break}case eD:this.initialState=r.initialState,this.log=r.log||[]}return n});o=void 0!==o?C(l,o):l,this.store=A(this.reducer,this.initialState,o),n||(n=tP),this.transport=n({transportDataCallback:e=>this.receiveTransportData(e),gameKey:e,game:this.game,matchID:i,playerID:a,credentials:s,gameName:this.game.name,numPlayers:r}),this.createDispatchers(),this.chatMessages=[],this.sendChatMessage=e=>{this.transport.sendChatMessage(this.matchID,{id:E(7),sender:this.playerID,payload:e})}}receiveMatchData(e){this.matchData=e,this.notifySubscribers()}receiveChatMessage(e){this.chatMessages=[...this.chatMessages,e],this.notifySubscribers()}receiveTransportData(e){let[t]=e.args;if(t===this.matchID)switch(e.type){case"sync":{let[,t]=e.args,r=eG(t);this.receiveMatchData(t.filteredMetadata),this.store.dispatch(r);break}case"update":{let[,t,r]=e.args,n=this.store.getState();if(t._stateID>=n._stateID){let e=eF(t,r);this.store.dispatch(e)}break}case"patch":{let[,t,r,n,i]=e.args,a=this.store.getState()._stateID;if(t!==a)break;let s=eq(t,r,n,i);this.store.dispatch(s),this.store.getState()._stateID===a&&this.transport.requestSync();break}case"matchData":{let[,t]=e.args;this.receiveMatchData(t);break}case"chat":{let[,t]=e.args;this.receiveChatMessage(t)}}}notifySubscribers(){Object.values(this.subscribers).forEach(e=>e(this.getState()))}overrideGameState(e){this.gameStateOverride=e,this.notifySubscribers()}start(){this.transport.connect(),this._running=!0,this.manager.register(this)}stop(){this.transport.disconnect(),this._running=!1,this.manager.unregister(this)}subscribe(e){let t=Object.keys(this.subscribers).length;return this.subscribers[t]=e,this.transport.subscribeToConnectionStatus(()=>this.notifySubscribers()),(this._running||!this.multiplayer)&&e(this.getState()),()=>{delete this.subscribers[t]}}getInitialState(){return this.initialState}getState(){let e=this.store.getState();if(null!==this.gameStateOverride&&(e=this.gameStateOverride),null===e)return e;let t=!0,r=this.game.flow.isPlayerActive(e.G,e.ctx,this.playerID);return this.multiplayer&&!r&&(t=!1),this.multiplayer||null===this.playerID||void 0===this.playerID||r||(t=!1),void 0!==e.ctx.gameover&&(t=!1),this.multiplayer||(e={...e,G:this.game.playerView({G:e.G,ctx:e.ctx,playerID:this.playerID}),plugins:ti(e,this)}),{...e,log:this.log,isActive:t,isConnected:this.transport.isConnected}}createDispatchers(){this.moves=tA(this.game.moveNames,this.store,this.playerID,this.credentials,this.multiplayer),this.events=tC(this.game.flow.enabledEventNames,this.store,this.playerID,this.credentials,this.multiplayer),this.plugins=tN(this.game.pluginNames,this.store,this.playerID,this.credentials,this.multiplayer)}updatePlayerID(e){this.playerID=e,this.createDispatchers(),this.transport.updatePlayerID(e),this.notifySubscribers()}updateMatchID(e){this.matchID=e,this.createDispatchers(),this.transport.updateMatchID(e),this.notifySubscribers()}updateCredentials(e){this.credentials=e,this.createDispatchers(),this.transport.updateCredentials(e),this.notifySubscribers()}}let{parse:tD,stringify:tT}=JSON,{keys:tB}=Object;r(699);class tR{constructor({enumerate:e,seed:t}){this.enumerateFn=e,this.seed=t,this.iterationCounter=0,this._opts={}}addOpt({key:e,range:t,initial:r}){this._opts[e]={range:t,value:r}}getOpt(e){return this._opts[e].value}setOpt(e,t){e in this._opts&&(this._opts[e].value=t)}opts(){return this._opts}enumerate(e,t,r){return this.enumerateFn(e,t,r).map(e=>"payload"in e?e:"move"in e?eU(e.move,e.args,r):"event"in e?eW(e.event,e.args,r):void 0)}random(e){let t;if(void 0!==this.seed){let e=eO(this.prngstate?"":this.seed,this.prngstate);t=e(),this.prngstate=e.state()}else t=Math.random();if(e){if(!Array.isArray(e))return Math.floor(t*e);{let r=Math.floor(t*e.length);return e[r]}}return t}}class tj extends tR{constructor({enumerate:e,seed:t,objectives:r,game:n,iterations:i,playoutDepth:a,iterationCallback:s}){super({enumerate:e,seed:t}),void 0===r&&(r=()=>({})),this.objectives=r,this.iterationCallback=s||(()=>{}),this.reducer=tw({game:n}),this.iterations=i,this.playoutDepth=a,this.addOpt({key:"async",initial:!1}),this.addOpt({key:"iterations",initial:"number"==typeof i?i:1e3,range:{min:1,max:2e3}}),this.addOpt({key:"playoutDepth",initial:"number"==typeof a?a:50,range:{min:1,max:100}})}createNode({state:e,parentAction:t,parent:r,playerID:n}){let{G:i,ctx:a}=e,s=[],o=[];if(void 0!==n)s=this.enumerate(i,a,n),o=this.objectives(i,a,n);else if(a.activePlayers)for(let e in a.activePlayers)s.push(...this.enumerate(i,a,e)),o.push(this.objectives(i,a,e));else s=this.enumerate(i,a,a.currentPlayer),o=this.objectives(i,a,a.currentPlayer);return{state:e,parent:r,parentAction:t,actions:s,objectives:o,children:[],visits:0,value:0}}select(e){if(e.actions.length>0||0===e.children.length)return e;let t=null,r=0;for(let n of e.children){let i=n.visits+Number.EPSILON,a=n.value/i+Math.sqrt(2*Math.log(e.visits)/i);(null==t||a>r)&&(r=a,t=n)}return this.select(t)}expand(e){let t=e.actions;if(0===t.length||void 0!==e.state.ctx.gameover)return e;let r=this.random(t.length),n=t[r];e.actions.splice(r,1);let i=this.reducer(e.state,n),a=this.createNode({state:i,parentAction:n,parent:e});return e.children.push(a),a}playout({state:e}){let t=this.getOpt("playoutDepth");"function"==typeof this.playoutDepth&&(t=this.playoutDepth(e.G,e.ctx));for(let r=0;r<t&&void 0===e.ctx.gameover;r++){let{G:t,ctx:r}=e,n=r.currentPlayer;r.activePlayers&&(n=Object.keys(r.activePlayers)[0]);let i=this.enumerate(t,r,n),a=this.objectives(t,r,n),s=Object.keys(a).reduce((e,n)=>{let i=a[n];return i.checker(t,r)?e+i.weight:e},0);if(s>0)return{score:s};if(!i||0===i.length)return;let o=this.random(i.length);e=this.reducer(e,i[o])}return e.ctx.gameover}backpropagate(e,t={}){e.visits++,void 0!==t.score&&(e.value+=t.score),!0===t.draw&&(e.value+=.5),e.parentAction&&t.winner===e.parentAction.payload.playerID&&e.value++,e.parent&&this.backpropagate(e.parent,t)}play(e,t){let r=this.createNode({state:e,playerID:t}),n=this.getOpt("iterations");"function"==typeof this.iterations&&(n=this.iterations(e.G,e.ctx));let i=()=>{let e=null;for(let t of r.children)(null==e||t.visits>e.visits)&&(e=t);return{action:e&&e.parentAction,metadata:r}};return new Promise(e=>{let t=()=>{for(let e=0;e<25&&this.iterationCounter<n;e++){let e=this.select(r),t=this.expand(e),n=this.playout(t);this.backpropagate(t,n),this.iterationCounter++}this.iterationCallback({iterationCounter:this.iterationCounter,numIterations:n,metadata:r})};if(this.iterationCounter=0,this.getOpt("async")){let r=()=>{this.iterationCounter<n?(t(),setImmediate(r)):e(i())};r()}else{for(;this.iterationCounter<n;)t();e(i())}})}}let tL=(e,t)=>{if(!e||"string"!=typeof e)throw Error(`Expected ${t} string, got "${e}".`)},tU=e=>tL(e,"game name"),tW=e=>tL(e,"match ID"),tz=(e,t)=>{if(!e)throw Error(`Expected body, got “${e}”.`);for(let r in t){let n=t[r],i=Array.isArray(n)?n:[n],a=e[r];if(!i.includes(typeof a)){let e=i.join("|");throw TypeError(`Expected body.${r} to be of type ${e}, got “${a}”.`)}}};class tG extends Error{constructor(e,t){super(e),this.details=t}}class tq{constructor({server:e=""}={}){this.server=e.replace(/\/$/,"")}async request(e,t){let r=await fetch(this.server+e,t);if(!r.ok){let e;try{e=await r.clone().json()}catch{try{e=await r.text()}catch(t){e=t.message}}throw new tG(`HTTP status ${r.status}`,e)}return r.json()}async post(e,t){let r={method:"post",body:JSON.stringify(t.body),headers:{"Content-Type":"application/json"}};return t.init&&(r={...r,...t.init,headers:{...r.headers,...t.init.headers}}),this.request(e,r)}async listGames(e){return this.request("/games",e)}async listMatches(e,t,r){tU(e);let n="";if(t){let e=[],{isGameover:r,updatedBefore:i,updatedAfter:a}=t;void 0!==r&&e.push(`isGameover=${r}`),i&&e.push(`updatedBefore=${i}`),a&&e.push(`updatedAfter=${a}`),e.length>0&&(n="?"+e.join("&"))}return this.request(`/games/${e}${n}`,r)}async getMatch(e,t,r){return tU(e),tW(t),this.request(`/games/${e}/${t}`,r)}async createMatch(e,t,r){return tU(e),tz(t,{numPlayers:"number"}),this.post(`/games/${e}/create`,{body:t,init:r})}async joinMatch(e,t,r,n){return tU(e),tW(t),tz(r,{playerID:["string","undefined"],playerName:"string"}),this.post(`/games/${e}/${t}/join`,{body:r,init:n})}async leaveMatch(e,t,r,n){tU(e),tW(t),tz(r,{playerID:"string",credentials:"string"}),await this.post(`/games/${e}/${t}/leave`,{body:r,init:n})}async updatePlayer(e,t,r,n){tU(e),tW(t),tz(r,{playerID:"string",credentials:"string"}),await this.post(`/games/${e}/${t}/update`,{body:r,init:n})}async playAgain(e,t,r,n){return tU(e),tW(t),tz(r,{playerID:"string",credentials:"string"}),this.post(`/games/${e}/${t}/playAgain`,{body:r,init:n})}}var tF=r(1527),tV=r(8202),t$=r.n(tV),tJ=r(783);function tH(e){return e.type()===m.SYNC}(u=m||(m={}))[u.SYNC=0]="SYNC",u[u.ASYNC=1]="ASYNC";class tK{type(){return m.SYNC}connect(){}createMatch(e,t){if(this.createGame)return console.warn("The database connector does not implement a createMatch method.","\nUsing the deprecated createGame method instead."),this.createGame(e,t);console.error("The database connector does not implement a createMatch method.")}listMatches(e){if(this.listGames)return console.warn("The database connector does not implement a listMatches method.","\nUsing the deprecated listGames method instead."),this.listGames(e);console.error("The database connector does not implement a listMatches method.")}}let tY=({game:e,unlisted:t,setupData:r,numPlayers:n})=>{let i={gameName:e.name,unlisted:!!t,players:{},createdAt:Date.now(),updatedAt:Date.now()};void 0!==r&&(i.setupData=r);for(let e=0;e<n;e++)i.players[e]={id:e};return i},tX=({game:e,numPlayers:t,setupData:r,unlisted:n})=>{t&&"number"==typeof t||(t=2);let i=e.validateSetupData&&e.validateSetupData(r,t);return void 0!==i?{setupDataError:i}:{metadata:tY({game:e,numPlayers:t,setupData:r,unlisted:n}),initialState:tE({game:e,numPlayers:t,setupData:r})}},tQ=e=>Object.values(e.players).map(e=>{let{credentials:t,...r}=e;return r}),tZ=e=>{let{credentials:t,...r}=e.payload;return{...e,payload:r}};class t0{constructor(e,t,r,n){this.game=tc(e),this.storageAPI=t,this.transportAPI=r,this.subscribeCallback=()=>{},this.auth=n}subscribe(e){this.subscribeCallback=e}async onUpdate(e,t,r,n){let i,a,s;if(!e||!e.payload)return{error:"missing action or action payload"};if(tH(this.storageAPI)?{metadata:i}=this.storageAPI.fetch(r,{metadata:!0}):{metadata:i}=await this.storageAPI.fetch(r,{metadata:!0}),this.auth&&!await this.auth.authenticateCredentials({playerID:n,credentials:e.payload.credentials,metadata:i}))return{error:"unauthorized action"};let o=tZ(e);if(tH(this.storageAPI)?{state:a}=this.storageAPI.fetch(r,{state:!0}):{state:a}=await this.storageAPI.fetch(r,{state:!0}),void 0===a)return e2(`game not found, matchID=[${r}]`),{error:"game not found"};if(void 0!==a.ctx.gameover){e2(`game over - matchID=[${r}] - playerID=[${n}] - action[${o.payload.type}]`);return}let l=A(tw({game:this.game}),a,N(tb));if(o.type==eT||o.type==eN){let e=null!==a.ctx.activePlayers,t=a.ctx.currentPlayer===n;if(!e&&!t||e&&(void 0===a.ctx.activePlayers[n]||Object.keys(a.ctx.activePlayers).length>1)){e2(`playerID=[${n}] cannot undo / redo right now`);return}}if(!this.game.flow.isPlayerActive(a.G,a.ctx,n)){e2(`player not active - playerID=[${n}] - action[${o.payload.type}]`);return}let u=o.type==eA?this.game.flow.getMove(a.ctx,o.payload.type,n):null;if(o.type==eA&&!u){e2(`move not processed - canPlayerMakeMove=false - playerID=[${n}] - action[${o.payload.type}]`);return}if(a._stateID!==t&&!(u&&th(u)&&u.ignoreStaleStateID)){e2(`invalid stateID, was=[${t}], expected=[${a._stateID}] - playerID=[${n}] - action[${o.payload.type}]`);return}let c=l.getState();l.dispatch(o),a=l.getState(),this.subscribeCallback({state:a,action:o,matchID:r}),this.game.deltaState?this.transportAPI.sendAll({type:"patch",args:[r,t,c,a]}):this.transportAPI.sendAll({type:"update",args:[r,a]});let{deltalog:h,...p}=a;if(i&&(void 0===i.gameover||null===i.gameover)&&(s={...i,updatedAt:Date.now()},void 0!==a.ctx.gameover&&(s.gameover=a.ctx.gameover)),tH(this.storageAPI))this.storageAPI.setState(r,p,h),s&&this.storageAPI.setMetadata(r,s);else{let e=[this.storageAPI.setState(r,p,h)];s&&e.push(this.storageAPI.setMetadata(r,s)),await Promise.all(e)}}async onSync(e,t,r,n=2){let i={state:!0,metadata:!0,log:!0,initialState:!0},{state:a,initialState:s,log:o,metadata:l}=tH(this.storageAPI)?this.storageAPI.fetch(e,i):await this.storageAPI.fetch(e,i);if(this.auth&&null!=t&&!await this.auth.authenticateCredentials({playerID:t,credentials:r,metadata:l}))return{error:"unauthorized"};if(void 0===a){let t=tX({game:this.game,unlisted:!0,numPlayers:n,setupData:void 0});if("setupDataError"in t)return{error:"game requires setupData"};s=a=t.initialState,l=t.metadata,this.subscribeCallback({state:a,matchID:e}),tH(this.storageAPI)?this.storageAPI.createMatch(e,{initialState:s,metadata:l}):await this.storageAPI.createMatch(e,{initialState:s,metadata:l})}let u={state:a,log:o,filteredMetadata:l?tQ(l):void 0,initialState:s};this.transportAPI.send({playerID:t,type:"sync",args:[e,u]})}async onConnectionChange(e,t,r,n){let i;if(null==t)return;if(tH(this.storageAPI)?{metadata:i}=this.storageAPI.fetch(e,{metadata:!0}):{metadata:i}=await this.storageAPI.fetch(e,{metadata:!0}),void 0===i)return e2(`metadata not found for matchID=[${e}]`),{error:"metadata not found"};if(void 0===i.players[t])return e2(`Player not in the match, matchID=[${e}] playerID=[${t}]`),{error:"player not in the match"};if(this.auth&&!await this.auth.authenticateCredentials({playerID:t,credentials:r,metadata:i}))return{error:"unauthorized"};i.players[t].isConnected=n;let a=tQ(i);this.transportAPI.sendAll({type:"matchData",args:[e,a]}),tH(this.storageAPI)?this.storageAPI.setMetadata(e,i):await this.storageAPI.setMetadata(e,i)}async onChatMessage(e,t,r){if(this.auth){let{metadata:n}=await this.storageAPI.fetch(e,{metadata:!0});if(!(t&&"string"==typeof t.sender)||!await this.auth.authenticateCredentials({playerID:t.sender,credentials:r,metadata:n}))return{error:"unauthorized"}}this.transportAPI.sendAll({type:"chat",args:[e,t]})}}let t1=(e,t,r)=>({...r,G:e.playerView({G:r.G,ctx:r.ctx,playerID:t}),plugins:ti(r,{playerID:t,game:e}),deltalog:void 0,_undo:[],_redo:[]}),t2=e=>(t,r)=>{switch(r.type){case"patch":{let[n,i,a,s]=r.args,o=t3(s.deltalog,t),l=t1(e,t,s),u=s._stateID,c=t1(e,t,a);return{type:"patch",args:[n,i,u,(0,w.rh)(c,l),o]}}case"update":{let[n,i]=r.args,a=t3(i.deltalog,t);return{type:"update",args:[n,t1(e,t,i),a]}}case"sync":{let[n,i]=r.args,a=t1(e,t,i.state),s=t3(i.log,t);return{type:"sync",args:[n,{...i,state:a,log:s}]}}default:return r}};function t3(e,t){return void 0===e?e:e.map(e=>{if(null!==t&&+t==+e.action.payload.playerID||!0!==e.redact)return e;let r={...e.action.payload,args:null},{redact:n,...i}={...e,action:{...e.action,payload:r}};return i})}let t6=Object.create(null);t6.open="0",t6.close="1",t6.ping="2",t6.pong="3",t6.message="4",t6.upgrade="5",t6.noop="6";let t5=Object.create(null);Object.keys(t6).forEach(e=>{t5[t6[e]]=e});let t8={type:"error",data:"parser error"},t4="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),t9="function"==typeof ArrayBuffer,t7=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,re=({type:e,data:t},r,n)=>t4&&t instanceof Blob?r?n(t):rt(t,n):t9&&(t instanceof ArrayBuffer||t7(t))?r?n(t):rt(new Blob([t]),n):n(t6[e]+(t||"")),rt=(e,t)=>{let r=new FileReader;return r.onload=function(){t("b"+(r.result.split(",")[1]||""))},r.readAsDataURL(e)};function rr(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let rn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ri="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let e=0;e<rn.length;e++)ri[rn.charCodeAt(e)]=e;let ra=e=>{let t=.75*e.length,r=e.length,n,i=0,a,s,o,l;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);let u=new ArrayBuffer(t),c=new Uint8Array(u);for(n=0;n<r;n+=4)a=ri[e.charCodeAt(n)],s=ri[e.charCodeAt(n+1)],o=ri[e.charCodeAt(n+2)],l=ri[e.charCodeAt(n+3)],c[i++]=a<<2|s>>4,c[i++]=(15&s)<<4|o>>2,c[i++]=(3&o)<<6|63&l;return u},rs="function"==typeof ArrayBuffer,ro=(e,t)=>{if("string"!=typeof e)return{type:"message",data:ru(e,t)};let r=e.charAt(0);return"b"===r?{type:"message",data:rl(e.substring(1),t)}:t5[r]?e.length>1?{type:t5[r],data:e.substring(1)}:{type:t5[r]}:t8},rl=(e,t)=>rs?ru(ra(e),t):{base64:!0,data:e},ru=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,rc=(e,t)=>{let r=e.length,n=Array(r),i=0;e.forEach((e,a)=>{re(e,!1,e=>{n[a]=e,++i===r&&t(n.join("\x1e"))})})},rh=(e,t)=>{let r=e.split("\x1e"),n=[];for(let e=0;e<r.length;e++){let i=ro(r[e],t);if(n.push(i),"error"===i.type)break}return n};function rp(e){return e.reduce((e,t)=>e+t.length,0)}function rd(e,t){if(e[0].length===t)return e.shift();let r=new Uint8Array(t),n=0;for(let i=0;i<t;i++)r[i]=e[0][n++],n===e[0].length&&(e.shift(),n=0);return e.length&&n<e[0].length&&(e[0]=e[0].slice(n)),r}function rf(e){if(e)return function(e){for(var t in rf.prototype)e[t]=rf.prototype[t];return e}(e)}rf.prototype.on=rf.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},rf.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},rf.prototype.off=rf.prototype.removeListener=rf.prototype.removeAllListeners=rf.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},rf.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n)r[n].apply(this,t)}return this},rf.prototype.emitReserved=rf.prototype.emit,rf.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},rf.prototype.hasListeners=function(e){return!!this.listeners(e).length};let ry="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function rm(e,...t){return t.reduce((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t),{})}let rg=ry.setTimeout,rv=ry.clearTimeout;function rb(e,t){t.useNativeTimers?(e.setTimeoutFn=rg.bind(ry),e.clearTimeoutFn=rv.bind(ry)):(e.setTimeoutFn=ry.setTimeout.bind(ry),e.clearTimeoutFn=ry.clearTimeout.bind(ry))}class rw extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class rE extends rf{constructor(e){super(),this.writable=!1,rb(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,r){return super.emitReserved("error",new rw(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let t=ro(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){let e=this.opts.hostname;return -1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){let t=function(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}(e);return t.length?"?"+t:""}}let rx="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),r_={},rP=0,rI=0,rS;function rO(e){let t="";do t=rx[e%64]+t,e=Math.floor(e/64);while(e>0);return t}function rk(){let e=rO(+new Date);return e!==rS?(rP=0,rS=e):e+"."+rO(rP++)}for(;rI<64;rI++)r_[rx[rI]]=rI;let rA=!1;try{rA="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){}let rC=rA;function rN(e){let t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||rC))return new XMLHttpRequest}catch(e){}if(!t)try{return new ry[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(e){}}function rM(){}let rD=null!=new rN({xdomain:!1}).responseType;class rT extends rE{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){let t="https:"===location.protocol,r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port}let t=e&&e.forceBase64;this.supportsBinary=rD&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";let t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){rh(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){let e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,rc(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=rk()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new rB(this.uri(),e)}doWrite(e,t){let r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}class rB extends rf{constructor(e,t){super(),rb(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=void 0!==t.data?t.data:null,this.create()}create(){var e;let t=rm(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;let r=this.xhr=new rN(t);try{r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders)for(let e in r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&r.setRequestHeader(e,this.opts.extraHeaders[e])}catch(e){}if("POST"===this.method)try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{r.setRequestHeader("Accept","*/*")}catch(e){}null===(e=this.opts.cookieJar)||void 0===e||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{var e;3===r.readyState&&(null===(e=this.opts.cookieJar)||void 0===e||e.parseCookies(r)),4===r.readyState&&(200===r.status||1223===r.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof r.status?r.status:0)},0))},r.send(this.data)}catch(e){this.setTimeoutFn(()=>{this.onError(e)},0);return}"undefined"!=typeof document&&(this.index=rB.requestsCount++,rB.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=rM,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete rB.requests[this.index],this.xhr=null}}onLoad(){let e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function rR(){for(let e in rB.requests)rB.requests.hasOwnProperty(e)&&rB.requests[e].abort()}rB.requestsCount=0,rB.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",rR):"function"==typeof addEventListener&&addEventListener("onpagehide"in ry?"pagehide":"unload",rR,!1));let rj="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),rL=ry.WebSocket||ry.MozWebSocket;r(6299).lW;let rU="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class rW extends rE{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let e=this.uri(),t=this.opts.protocols,r=rU?{}:rm(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=rU?new rL(e,t,r):t?new rL(e,t):new rL(e)}catch(e){return this.emitReserved("error",e)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let r=e[t],n=t===e.length-1;re(r,this.supportsBinary,e=>{try{this.ws.send(e)}catch(e){}n&&rj(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=rk()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!rL}}class rz extends rE{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{let t=function(e,t){i||(i=new TextDecoder);let r=[],n=0,a=-1,s=!1;return new TransformStream({transform(o,l){for(r.push(o);;){if(0===n){if(1>rp(r))break;let e=rd(r,1);s=(128&e[0])==128,n=(a=127&e[0])<126?3:126===a?1:2}else if(1===n){if(2>rp(r))break;let e=rd(r,2);a=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),n=3}else if(2===n){if(8>rp(r))break;let e=rd(r,8),t=new DataView(e.buffer,e.byteOffset,e.length),i=t.getUint32(0);if(i>2097151){l.enqueue(t8);break}a=4294967296*i+t.getUint32(4),n=3}else{if(rp(r)<a)break;let e=rd(r,a);l.enqueue(ro(s?e:i.decode(e),t)),n=0}if(0===a||a>e){l.enqueue(t8);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),a=new TransformStream({transform(e,t){var r;r=r=>{let n;let i=r.length;if(i<126)new DataView((n=new Uint8Array(1)).buffer).setUint8(0,i);else if(i<65536){let e=new DataView((n=new Uint8Array(3)).buffer);e.setUint8(0,126),e.setUint16(1,i)}else{let e=new DataView((n=new Uint8Array(9)).buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(i))}e.data&&"string"!=typeof e.data&&(n[0]|=128),t.enqueue(n),t.enqueue(r)},t4&&e.data instanceof Blob?e.data.arrayBuffer().then(rr).then(r):t9&&(e.data instanceof ArrayBuffer||t7(e.data))?r(rr(e.data)):re(e,!1,e=>{n||(n=new TextEncoder),r(n.encode(e))})}});a.readable.pipeTo(e.writable),this.writer=a.writable.getWriter();let s=()=>{r.read().then(({done:e,value:t})=>{e||(this.onPacket(t),s())}).catch(e=>{})};s();let o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this.writer.write(o).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let r=e[t],n=t===e.length-1;this.writer.write(r).then(()=>{n&&rj(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;null===(e=this.transport)||void 0===e||e.close()}}let rG={websocket:rW,webtransport:rz,polling:rT},rq=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,rF=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function rV(e){if(e.length>2e3)throw"URI too long";let t=e,r=e.indexOf("["),n=e.indexOf("]");-1!=r&&-1!=n&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));let i=rq.exec(e||""),a={},s=14;for(;s--;)a[rF[s]]=i[s]||"";return -1!=r&&-1!=n&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function(e,t){let r=t.replace(/\/{2,9}/g,"/").split("/");return("/"==t.slice(0,1)||0===t.length)&&r.splice(0,1),"/"==t.slice(-1)&&r.splice(r.length-1,1),r}(0,a.path),a.queryKey=function(e,t){let r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,n){t&&(r[t]=n)}),r}(0,a.query),a}class r$ extends rf{constructor(e,t={}){super(),this.binaryType="arraybuffer",this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=rV(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=rV(t.host).host),rb(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},r=e.split("&");for(let e=0,n=r.length;e<n;e++){let n=r[e].split("=");t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return t}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){let t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);let r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new rG[e](r)}open(){let e;if(this.opts.rememberUpgrade&&r$.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else if(0===this.transports.length){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch(e){this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",e=>this.onClose("transport close",e))}probe(e){let t=this.createTransport(e),r=!1;r$.priorWebsocketSuccess=!1;let n=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",e=>{if(!r){if("pong"===e.type&&"probe"===e.data)this.upgrading=!0,this.emitReserved("upgrading",t),t&&(r$.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{r||"closed"===this.readyState||(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}));else{let e=Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}}}))};function i(){r||(r=!0,u(),t.close(),t=null)}let a=e=>{let r=Error("probe error: "+e);r.transport=t.name,i(),this.emitReserved("upgradeError",r)};function s(){a("transport closed")}function o(){a("socket closed")}function l(e){t&&e.name!==t.name&&i()}let u=()=>{t.removeListener("open",n),t.removeListener("error",a),t.removeListener("close",s),this.off("close",o),this.off("upgrading",l)};t.once("open",n),t.once("error",a),t.once("close",s),this.once("close",o),this.once("upgrading",l),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onOpen(){if(this.readyState="open",r$.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0,t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let t=Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){let r=this.writeBuffer[t].data;if(r&&(e+="string"==typeof r?function(e){let t=0,r=0;for(let n=0,i=e.length;n<i;n++)(t=e.charCodeAt(n))<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}(r):Math.ceil(1.33*(r.byteLength||r.size))),t>0&&e>this.maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}write(e,t,r){return this.sendPacket("message",e,t,r),this}send(e,t,r){return this.sendPacket("message",e,t,r),this}sendPacket(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;let i={type:e,data:t,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){let e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}onError(e){r$.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){let t=[],r=0,n=e.length;for(;r<n;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}r$.protocol=4,r$.protocol;let rJ="function"==typeof ArrayBuffer,rH=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,rK=Object.prototype.toString,rY="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===rK.call(Blob),rX="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===rK.call(File);function rQ(e){return rJ&&(e instanceof ArrayBuffer||rH(e))||rY&&e instanceof Blob||rX&&e instanceof File}let rZ=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],r0=5;(c=g||(g={}))[c.CONNECT=0]="CONNECT",c[c.DISCONNECT=1]="DISCONNECT",c[c.EVENT=2]="EVENT",c[c.ACK=3]="ACK",c[c.CONNECT_ERROR=4]="CONNECT_ERROR",c[c.BINARY_EVENT=5]="BINARY_EVENT",c[c.BINARY_ACK=6]="BINARY_ACK";class r1{constructor(e){this.replacer=e}encode(e){return(e.type===g.EVENT||e.type===g.ACK)&&function e(t,r){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let r=0,n=t.length;r<n;r++)if(e(t[r]))return!0;return!1}if(rQ(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1==arguments.length)return e(t.toJSON(),!0);for(let r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&e(t[r]))return!0;return!1}(e)?this.encodeAsBinary({type:e.type===g.EVENT?g.BINARY_EVENT:g.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===g.BINARY_EVENT||e.type===g.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){let t=function(e){let t=[],r=e.data;return e.data=function e(t,r){if(!t)return t;if(rQ(t)){let e={_placeholder:!0,num:r.length};return r.push(t),e}if(Array.isArray(t)){let n=Array(t.length);for(let i=0;i<t.length;i++)n[i]=e(t[i],r);return n}if("object"==typeof t&&!(t instanceof Date)){let n={};for(let i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=e(t[i],r));return n}return t}(r,t),e.attachments=t.length,{packet:e,buffers:t}}(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}}function r2(e){return"[object Object]"===Object.prototype.toString.call(e)}class r3 extends rf{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw Error("got plaintext data when reconstructing a packet");let r=(t=this.decodeString(e)).type===g.BINARY_EVENT;r||t.type===g.BINARY_ACK?(t.type=r?g.EVENT:g.ACK,this.reconstructor=new r6(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(rQ(e)||e.base64){if(this.reconstructor)(t=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw Error("got binary data when not reconstructing a packet")}else throw Error("Unknown type: "+e)}decodeString(e){let t=0,r={type:Number(e.charAt(0))};if(void 0===g[r.type])throw Error("unknown packet type "+r.type);if(r.type===g.BINARY_EVENT||r.type===g.BINARY_ACK){let n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);let i=e.substring(n,t);if(i!=Number(i)||"-"!==e.charAt(t))throw Error("Illegal attachments");r.attachments=Number(i)}if("/"===e.charAt(t+1)){let n=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);r.nsp=e.substring(n,t)}else r.nsp="/";let n=e.charAt(t+1);if(""!==n&&Number(n)==n){let n=t+1;for(;++t;){let r=e.charAt(t);if(null==r||Number(r)!=r){--t;break}if(t===e.length)break}r.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){let n=this.tryParse(e.substr(t));if(r3.isPayloadValid(r.type,n))r.data=n;else throw Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(e){return!1}}static isPayloadValid(e,t){switch(e){case g.CONNECT:return r2(t);case g.DISCONNECT:return void 0===t;case g.CONNECT_ERROR:return"string"==typeof t||r2(t);case g.EVENT:case g.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===rZ.indexOf(t[0]));case g.ACK:case g.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class r6{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t,r;let e=(t=this.reconPack,r=this.buffers,t.data=function e(t,r){if(!t)return t;if(t&&!0===t._placeholder){if("number"==typeof t.num&&t.num>=0&&t.num<r.length)return r[t.num];throw Error("illegal attachments")}if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=e(t[n],r);else if("object"==typeof t)for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=e(t[n],r));return t}(t.data,r),delete t.attachments,t);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function r5(e,t,r){return e.on(t,r),function(){e.off(t,r)}}let r8=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class r4 extends rf{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[r5(e,"open",this.onopen.bind(this)),r5(e,"packet",this.onpacket.bind(this)),r5(e,"error",this.onerror.bind(this)),r5(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(r8.hasOwnProperty(e))throw Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let r={type:g.EVENT,data:t};if(r.options={},r.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){let e=this.ids++,n=t.pop();this._registerAckCallback(e,n),r.id=e}let n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return(!this.flags.volatile||n&&this.connected)&&(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,t){var r;let n=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===n){this.acks[e]=t;return}let i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,Error("operation has timed out"))},n),a=(...e)=>{this.io.clearTimeoutFn(i),t.apply(this,e)};a.withError=!0,this.acks[e]=a}emitWithAck(e,...t){return new Promise((r,n)=>{let i=(e,t)=>e?n(e):r(t);i.withError=!0,t.push(i),this.emit(e,...t)})}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());let r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((e,...n)=>{if(r===this._queue[0])return null!==e?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...n)),r.pending=!1,this._drainQueue()}),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;let t=this._queue[0];(!t.pending||e)&&(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:g.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){let t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,Error("socket has been disconnected"))}})}onpacket(e){if(!(e.nsp!==this.nsp))switch(e.type){case g.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case g.EVENT:case g.BINARY_EVENT:this.onevent(e);break;case g.ACK:case g.BINARY_ACK:this.onack(e);break;case g.DISCONNECT:this.ondisconnect();break;case g.CONNECT_ERROR:this.destroy();let t=Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){let t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length)for(let t of this._anyListeners.slice())t.apply(this,e);super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,r=!1;return function(...n){r||(r=!0,t.packet({type:g.ACK,id:e,data:n}))}}onack(e){let t=this.acks[e.id];"function"==typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:g.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r]){t.splice(r,1);break}}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r]){t.splice(r,1);break}}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length)for(let t of this._anyOutgoingListeners.slice())t.apply(this,e.data)}}function r9(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}r9.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=(1&Math.floor(10*t))==0?e-r:e+r}return 0|Math.min(e,this.max)},r9.prototype.reset=function(){this.attempts=0},r9.prototype.setMin=function(e){this.ms=e},r9.prototype.setMax=function(e){this.max=e},r9.prototype.setJitter=function(e){this.jitter=e};class r7 extends rf{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,rb(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new r9({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;let n=t.parser||b;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new r$(this.uri,this.opts);let t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;let n=r5(t,"open",function(){r.onopen(),e&&e()}),i=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},a=r5(t,"error",i);if(!1!==this._timeout){let e=this._timeout,r=this.setTimeoutFn(()=>{n(),i(Error("timeout")),t.close()},e);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}return this.subs.push(n),this.subs.push(a),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(r5(e,"ping",this.onping.bind(this)),r5(e,"data",this.ondata.bind(this)),r5(e,"error",this.onerror.bind(this)),r5(e,"close",this.onclose.bind(this)),r5(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(e){this.onclose("parse error",e)}}ondecoded(e){rj(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new r4(this,e,t),this.nsps[e]=r),r}_destroy(e){for(let e of Object.keys(this.nsps))if(this.nsps[e].active)return;this._close()}_packet(e){let t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();this._reconnecting=!0;let r=this.setTimeoutFn(()=>{!e.skipReconnect&&(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}let ne={};function nt(e,t){let r;"object"==typeof e&&(t=e,e=void 0);let n=function(e,t="",r){let n=e;r=r||"undefined"!=typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==r?r.protocol+"//"+e:"https://"+e),n=rV(e)),!n.port&&(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";let i=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+i+":"+n.port+t,n.href=n.protocol+"://"+i+(r&&r.port===n.port?"":":"+n.port),n}(e,(t=t||{}).path||"/socket.io"),i=n.source,a=n.id,s=n.path,o=ne[a]&&s in ne[a].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||o?r=new r7(i,t):(ne[a]||(ne[a]=new r7(i,t)),r=ne[a]),n.query&&!t.query&&(t.query=n.queryKey),r.socket(n.path,t)}Object.assign(nt,{Manager:r7,Socket:r4,io:nt,connect:nt});class nr extends tK{constructor(){super(),this.state=new Map,this.initial=new Map,this.metadata=new Map,this.log=new Map}createMatch(e,t){this.initial.set(e,t.initialState),this.setState(e,t.initialState),this.setMetadata(e,t.metadata)}setMetadata(e,t){this.metadata.set(e,t)}setState(e,t,r){if(r&&r.length>0){let t=this.log.get(e)||[];this.log.set(e,[...t,...r])}this.state.set(e,t)}fetch(e,t){let r={};return t.state&&(r.state=this.state.get(e)),t.metadata&&(r.metadata=this.metadata.get(e)),t.log&&(r.log=this.log.get(e)||[]),t.initialState&&(r.initialState=this.initial.get(e)),r}wipe(e){this.state.delete(e),this.metadata.delete(e)}listMatches(e){return[...this.metadata.entries()].filter(([,t])=>!e||(void 0===e.gameName||t.gameName===e.gameName)&&(void 0===e.where||(void 0===e.where.isGameover||void 0!==t.gameover===e.where.isGameover)&&(void 0===e.where.updatedBefore||!(t.updatedAt>=e.where.updatedBefore))&&(void 0===e.where.updatedAfter||!(t.updatedAt<=e.where.updatedAfter)))).map(([e])=>e)}}class nn extends Map{constructor(e){super(),this.key=e,(JSON.parse(localStorage.getItem(this.key))||[]).forEach(e=>this.set(...e))}sync(){let e=[...this.entries()];localStorage.setItem(this.key,JSON.stringify(e))}set(e,t){return super.set(e,t),this.sync(),this}delete(e){let t=super.delete(e);return this.sync(),t}}class ni extends nr{constructor(e="bgio"){super();let t=t=>new nn(`${e}_${t}`);this.state=t("state"),this.initial=t("initial"),this.metadata=t("metadata"),this.log=t("log")}}class na extends t0{constructor({game:e,bots:t,storageKey:r,persist:n}){let i={},a={};if(e&&e.ai&&t)for(let r in t){let n=t[r];a[r]=new n({game:e,enumerate:e.ai.enumerate,seed:e.seed})}let s=({playerID:e,...t})=>{let r=i[e];void 0!==r&&r(o(e,t))},o=t2(e);super(e,n?new ni(r):new nr,{send:s,sendAll:e=>{for(let t in i)s({playerID:t,...e})}}),this.connect=(e,t)=>{i[e]=t},this.subscribe(({state:e,matchID:r})=>{if(!t)return;let n=function(e,t){if(void 0!==e.ctx.gameover)return null;if(e.ctx.activePlayers){for(let r of Object.keys(t))if(r in e.ctx.activePlayers)return r}else if(e.ctx.currentPlayer in t)return e.ctx.currentPlayer;return null}(e,a);null!==n&&setTimeout(async()=>{let t=await a[n].play(e,n);await this.onUpdate(t.action,e._stateID,r,t.action.payload.playerID)},100)})}}class ns extends tx{constructor({master:e,...t}){super(t),this.master=e}sendChatMessage(e,t){let r=[e,t,this.credentials];this.master.onChatMessage(...r)}sendAction(e,t){this.master.onUpdate(t,e._stateID,this.matchID,this.playerID)}requestSync(){this.master.onSync(this.matchID,this.playerID,this.credentials,this.numPlayers)}connect(){this.setConnectionStatus(!0),this.master.connect(this.playerID,e=>this.notifyClient(e)),this.requestSync()}disconnect(){this.setConnectionStatus(!1)}updateMatchID(e){this.matchID=e,this.connect()}updatePlayerID(e){this.playerID=e,this.connect()}updateCredentials(e){this.credentials=e,this.connect()}}let no=new Map;class nl extends tx{constructor({socket:e,socketOpts:t,server:r,...n}){super(n),this.server=r,this.socket=e,this.socketOpts=t}sendAction(e,t){let r=[t,e._stateID,this.matchID,this.playerID];this.socket.emit("update",...r)}sendChatMessage(e,t){let r=[e,t,this.credentials];this.socket.emit("chat",...r)}connect(){if(!this.socket){if(this.server){let e=this.server;-1==e.search(/^https?:\/\//)&&(e="http://"+this.server),"/"!=e.slice(-1)&&(e+="/"),this.socket=nt(e+this.gameName,this.socketOpts)}else this.socket=nt("/"+this.gameName,this.socketOpts)}this.socket.on("patch",(e,t,r,n,i)=>{this.notifyClient({type:"patch",args:[e,t,r,n,i]})}),this.socket.on("update",(e,t,r)=>{this.notifyClient({type:"update",args:[e,t,r]})}),this.socket.on("sync",(e,t)=>{this.notifyClient({type:"sync",args:[e,t]})}),this.socket.on("matchData",(e,t)=>{this.notifyClient({type:"matchData",args:[e,t]})}),this.socket.on("chat",(e,t)=>{this.notifyClient({type:"chat",args:[e,t]})}),this.socket.on("connect",()=>{this.requestSync(),this.setConnectionStatus(!0)}),this.socket.on("disconnect",()=>{this.setConnectionStatus(!1)})}disconnect(){this.socket.close(),this.socket=null,this.setConnectionStatus(!1)}requestSync(){if(this.socket){let e=[this.matchID,this.playerID,this.credentials,this.numPlayers];this.socket.emit("sync",...e)}}updateMatchID(e){this.matchID=e,this.requestSync()}updatePlayerID(e){this.playerID=e,this.requestSync()}updateCredentials(e){this.credentials=e,this.requestSync()}}function nu({server:e,socketOpts:t}={}){return r=>new nl({server:e,socketOpts:t,...r})}function nc(e){var t;let{game:r,numPlayers:n,board:i,multiplayer:a,enhancer:s}=e,{loading:o,debug:l}=e;return void 0===o&&(o=()=>tF.createElement("div",{className:"bgio-loading"},"connecting...")),(t=class extends tF.Component{constructor(e){super(e),void 0===l&&(l=e.debug),this.client=new tM({game:r,debug:l,numPlayers:n,multiplayer:a,matchID:e.matchID,playerID:e.playerID,credentials:e.credentials,enhancer:s})}componentDidMount(){this.unsubscribe=this.client.subscribe(()=>this.forceUpdate()),this.client.start()}componentWillUnmount(){this.client.stop(),this.unsubscribe()}componentDidUpdate(e){this.props.matchID!=e.matchID&&this.client.updateMatchID(this.props.matchID),this.props.playerID!=e.playerID&&this.client.updatePlayerID(this.props.playerID),this.props.credentials!=e.credentials&&this.client.updateCredentials(this.props.credentials)}render(){let e=this.client.getState();if(null===e)return tF.createElement(o);let t=null;return i&&(t=tF.createElement(i,{...e,...this.props,isMultiplayer:!!a,moves:this.client.moves,events:this.client.events,matchID:this.client.matchID,playerID:this.client.playerID,reset:this.client.reset,undo:this.client.undo,redo:this.client.redo,log:this.client.log,matchData:this.client.matchData,sendChatMessage:this.client.sendChatMessage,chatMessages:this.client.chatMessages})),tF.createElement("div",{className:"bgio-client"},t)}}).propTypes={matchID:t$().string,playerID:t$().string,credentials:t$().string,debug:t$().any},t.defaultProps={matchID:"default",playerID:null,credentials:null,debug:!0},t}class nh{constructor({server:e,gameComponents:t,playerName:r,playerCredentials:n}){this.client=new tq({server:e}),this.gameComponents=t,this.playerName=r||"Visitor",this.playerCredentials=n,this.matches=[]}async refresh(){try{for(let e of(this.matches=[],await this.client.listGames())){if(!this._getGameComponents(e))continue;let{matches:t}=await this.client.listMatches(e);this.matches.push(...t)}}catch(e){throw Error("failed to retrieve list of matches ("+e+")")}}_getMatchInstance(e){for(let t of this.matches)if(t.matchID===e)return t}_getGameComponents(e){for(let t of this.gameComponents)if(t.game.name===e)return t}_findPlayer(e){for(let t of this.matches)if(t.players.some(t=>t.name===e))return t}async join(e,t,r){try{let n=this._findPlayer(this.playerName);if(n)throw Error("player has already joined "+n.matchID);if(!(n=this._getMatchInstance(t)))throw Error("game instance "+t+" not found");let i=await this.client.joinMatch(e,t,{playerID:r,playerName:this.playerName});n.players[Number.parseInt(r)].name=this.playerName,this.playerCredentials=i.playerCredentials}catch(e){throw Error("failed to join match "+t+" ("+e+")")}}async leave(e,t){try{let r=this._getMatchInstance(t);if(!r)throw Error("match instance not found");for(let n of r.players)if(n.name===this.playerName){await this.client.leaveMatch(e,t,{playerID:n.id.toString(),credentials:this.playerCredentials}),delete n.name,delete this.playerCredentials;return}throw Error("player not found in match")}catch(e){throw Error("failed to leave match "+t+" ("+e+")")}}async disconnect(){let e=this._findPlayer(this.playerName);e&&await this.leave(e.gameName,e.matchID),this.matches=[],this.playerName="Visitor"}async create(e,t){try{let r=this._getGameComponents(e);if(!r)throw Error("game not found");if(t<r.game.minPlayers||t>r.game.maxPlayers)throw Error("invalid number of players "+t);await this.client.createMatch(e,{numPlayers:t})}catch(t){throw Error("failed to create match for "+e+" ("+t+")")}}}class np extends tF.Component{constructor(){super(...arguments),this.state={playerName:this.props.playerName,nameErrorMsg:""},this.onClickEnter=()=>{""!==this.state.playerName&&this.props.onEnter(this.state.playerName)},this.onKeyPress=e=>{"Enter"===e.key&&this.onClickEnter()},this.onChangePlayerName=e=>{let t=e.target.value.trim();this.setState({playerName:t,nameErrorMsg:t.length>0?"":"empty player name"})}}render(){return tF.createElement("div",null,tF.createElement("p",{className:"phase-title"},"Choose a player name:"),tF.createElement("input",{type:"text",value:this.state.playerName,onChange:this.onChangePlayerName,onKeyPress:this.onKeyPress}),tF.createElement("span",{className:"buttons"},tF.createElement("button",{className:"buttons",onClick:this.onClickEnter},"Enter")),tF.createElement("br",null),tF.createElement("span",{className:"error-msg"},this.state.nameErrorMsg,tF.createElement("br",null)))}}np.defaultProps={playerName:""};class nd extends tF.Component{constructor(){super(...arguments),this._createSeat=e=>e.name||"[free]",this._createButtonJoin=(e,t)=>tF.createElement("button",{key:"button-join-"+e.matchID,onClick:()=>this.props.onClickJoin(e.gameName,e.matchID,""+t)},"Join"),this._createButtonLeave=e=>tF.createElement("button",{key:"button-leave-"+e.matchID,onClick:()=>this.props.onClickLeave(e.gameName,e.matchID)},"Leave"),this._createButtonPlay=(e,t)=>tF.createElement("button",{key:"button-play-"+e.matchID,onClick:()=>this.props.onClickPlay(e.gameName,{matchID:e.matchID,playerID:""+t,numPlayers:e.players.length})},"Play"),this._createButtonSpectate=e=>tF.createElement("button",{key:"button-spectate-"+e.matchID,onClick:()=>this.props.onClickPlay(e.gameName,{matchID:e.matchID,numPlayers:e.players.length})},"Spectate"),this._createInstanceButtons=e=>{let t=e.players.find(e=>e.name===this.props.playerName),r=e.players.find(e=>!e.name);return t&&r?this._createButtonLeave(e):r?this._createButtonJoin(e,r.id):t?tF.createElement("div",null,[this._createButtonPlay(e,t.id),this._createButtonLeave(e)]):this._createButtonSpectate(e)}}render(){let e=this.props.match,t="OPEN";return e.players.some(e=>!e.name)||(t="RUNNING"),tF.createElement("tr",{key:"line-"+e.matchID},tF.createElement("td",{key:"cell-name-"+e.matchID},e.gameName),tF.createElement("td",{key:"cell-status-"+e.matchID},t),tF.createElement("td",{key:"cell-seats-"+e.matchID},e.players.map(e=>this._createSeat(e)).join(", ")),tF.createElement("td",{key:"cell-buttons-"+e.matchID},this._createInstanceButtons(e)))}}class nf extends tF.Component{constructor(e){for(let t of(super(e),this.state={selectedGame:0,numPlayers:2},this._createGameNameOption=(e,t)=>tF.createElement("option",{key:"name-option-"+t,value:t},e.game.name),this._createNumPlayersOption=e=>tF.createElement("option",{key:"num-option-"+e,value:e},e),this._createNumPlayersRange=e=>Array.from({length:e.maxPlayers+1}).map((e,t)=>t).slice(e.minPlayers),this.onChangeNumPlayers=e=>{this.setState({numPlayers:Number.parseInt(e.target.value)})},this.onChangeSelectedGame=e=>{let t=Number.parseInt(e.target.value);this.setState({selectedGame:t,numPlayers:this.props.games[t].game.minPlayers})},this.onClickCreate=()=>{this.props.createMatch(this.props.games[this.state.selectedGame].game.name,this.state.numPlayers)},e.games)){let e=t.game;e.minPlayers||(e.minPlayers=1),e.maxPlayers||(e.maxPlayers=4),console.assert(e.maxPlayers>=e.minPlayers)}this.state={selectedGame:0,numPlayers:e.games[0].game.minPlayers}}render(){return tF.createElement("div",null,tF.createElement("select",{value:this.state.selectedGame,onChange:e=>this.onChangeSelectedGame(e)},this.props.games.map((e,t)=>this._createGameNameOption(e,t))),tF.createElement("span",null,"Players:"),tF.createElement("select",{value:this.state.numPlayers,onChange:this.onChangeNumPlayers},this._createNumPlayersRange(this.props.games[this.state.selectedGame].game).map(e=>this._createNumPlayersOption(e))),tF.createElement("span",{className:"buttons"},tF.createElement("button",{onClick:this.onClickCreate},"Create")))}}(h=v||(v={})).ENTER="enter",h.PLAY="play",h.LIST="list";class ny extends tF.Component{constructor(e){super(e),this.state={phase:v.ENTER,playerName:"Visitor",runningMatch:null,errorMsg:"",credentialStore:{}},this._createConnection=e=>{let t=this.state.playerName;this.connection=new nh({server:e.lobbyServer,gameComponents:e.gameComponents,playerName:t,playerCredentials:this.state.credentialStore[t]})},this._updateCredentials=(e,t)=>{this.setState(r=>{let n=Object.assign({},r.credentialStore);return n[e]=t,{credentialStore:n}})},this._updateConnection=async()=>{await this.connection.refresh(),this.forceUpdate()},this._enterLobby=e=>{this._startRefreshInterval(),this.setState({playerName:e,phase:v.LIST})},this._exitLobby=async()=>{this._clearRefreshInterval(),await this.connection.disconnect(),this.setState({phase:v.ENTER,errorMsg:""})},this._createMatch=async(e,t)=>{try{await this.connection.create(e,t),await this.connection.refresh(),this.setState({})}catch(e){this.setState({errorMsg:e.message})}},this._joinMatch=async(e,t,r)=>{try{await this.connection.join(e,t,r),await this.connection.refresh(),this._updateCredentials(this.connection.playerName,this.connection.playerCredentials)}catch(e){this.setState({errorMsg:e.message})}},this._leaveMatch=async(e,t)=>{try{await this.connection.leave(e,t),await this.connection.refresh(),this._updateCredentials(this.connection.playerName,this.connection.playerCredentials)}catch(e){this.setState({errorMsg:e.message})}},this._startMatch=(e,t)=>{let r;let n=this.connection._getGameComponents(e);if(!n){this.setState({errorMsg:"game "+e+" not supported"});return}if(t.numPlayers>1&&(r=this.props.gameServer?nu({server:this.props.gameServer}):nu()),1==t.numPlayers){let e=n.game.maxPlayers,t={};for(let r=1;r<e;r++)t[r+""]=tj;r=function({bots:e,persist:t,storageKey:r}={}){return n=>{let i;let{gameKey:a,game:s}=n,o=no.get(a);return o&&o.bots===e&&o.storageKey===r&&o.persist===t&&(i=o.master),i||(i=new na({game:s,bots:e,persist:t,storageKey:r}),no.set(a,{master:i,bots:e,persist:t,storageKey:r})),new ns({master:i,...n})}}({bots:t})}let i={app:this.props.clientFactory({game:n.game,board:n.board,debug:this.props.debug,multiplayer:r}),matchID:t.matchID,playerID:t.numPlayers>1?t.playerID:"0",credentials:this.connection.playerCredentials};this._clearRefreshInterval(),this.setState({phase:v.PLAY,runningMatch:i})},this._exitMatch=()=>{this._startRefreshInterval(),this.setState({phase:v.LIST,runningMatch:null})},this._getPhaseVisibility=e=>this.state.phase!==e?"hidden":"phase",this.renderMatches=(e,t)=>e.map(e=>{let{matchID:r,gameName:n,players:i}=e;return tF.createElement(nd,{key:"instance-"+r,match:{matchID:r,gameName:n,players:Object.values(i)},playerName:t,onClickJoin:this._joinMatch,onClickLeave:this._leaveMatch,onClickPlay:this._startMatch})}),this._createConnection(this.props)}componentDidMount(){let e=tJ.ZP.load("lobbyState")||{};e.phase&&e.phase===v.PLAY&&(e.phase=v.LIST),e.phase&&e.phase!==v.ENTER&&this._startRefreshInterval(),this.setState({phase:e.phase||v.ENTER,playerName:e.playerName||"Visitor",credentialStore:e.credentialStore||{}})}componentDidUpdate(e,t){let r=this.state.playerName,n=this.state.credentialStore[r];if(t.phase!==this.state.phase||t.credentialStore[r]!==n||t.playerName!==r){this._createConnection(this.props),this._updateConnection();let e={phase:this.state.phase,playerName:r,credentialStore:this.state.credentialStore};tJ.ZP.save("lobbyState",e,{path:"/"})}e.refreshInterval!==this.props.refreshInterval&&this._startRefreshInterval()}componentWillUnmount(){this._clearRefreshInterval()}_startRefreshInterval(){this._clearRefreshInterval(),this._currentInterval=setInterval(this._updateConnection,this.props.refreshInterval)}_clearRefreshInterval(){clearInterval(this._currentInterval)}render(){let{gameComponents:e,renderer:t}=this.props,{errorMsg:r,playerName:n,phase:i,runningMatch:a}=this.state;return t?t({errorMsg:r,gameComponents:e,matches:this.connection.matches,phase:i,playerName:n,runningMatch:a,handleEnterLobby:this._enterLobby,handleExitLobby:this._exitLobby,handleCreateMatch:this._createMatch,handleJoinMatch:this._joinMatch,handleLeaveMatch:this._leaveMatch,handleExitMatch:this._exitMatch,handleRefreshMatches:this._updateConnection,handleStartMatch:this._startMatch}):tF.createElement("div",{id:"lobby-view",style:{padding:50}},tF.createElement("div",{className:this._getPhaseVisibility(v.ENTER)},tF.createElement(np,{key:n,playerName:n,onEnter:this._enterLobby})),tF.createElement("div",{className:this._getPhaseVisibility(v.LIST)},tF.createElement("p",null,"Welcome, ",n),tF.createElement("div",{className:"phase-title",id:"match-creation"},tF.createElement("span",null,"Create a match:"),tF.createElement(nf,{games:e,createMatch:this._createMatch})),tF.createElement("p",{className:"phase-title"},"Join a match:"),tF.createElement("div",{id:"instances"},tF.createElement("table",null,tF.createElement("tbody",null,this.renderMatches(this.connection.matches,n))),tF.createElement("span",{className:"error-msg"},r,tF.createElement("br",null))),tF.createElement("p",{className:"phase-title"},"Matches that become empty are automatically deleted.")),tF.createElement("div",{className:this._getPhaseVisibility(v.PLAY)},a&&tF.createElement(a.app,{matchID:a.matchID,playerID:a.playerID,credentials:a.credentials}),tF.createElement("div",{className:"buttons",id:"match-exit"},tF.createElement("button",{onClick:this._exitMatch},"Exit match"))),tF.createElement("div",{className:"buttons",id:"lobby-exit"},tF.createElement("button",{onClick:this._exitLobby},"Exit lobby")))}}ny.propTypes={gameComponents:t$().array.isRequired,lobbyServer:t$().string,gameServer:t$().string,debug:t$().bool,clientFactory:t$().func,refreshInterval:t$().number},ny.defaultProps={debug:!1,clientFactory:nc,refreshInterval:2e3}},6299:function(e,t,r){"use strict";var n=r(3733),i=r(2917),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function s(e){if(e>2147483647)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return c(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e)return function(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!o.isEncoding(t))throw TypeError("Unknown encoding: "+t);var r=0|f(e,t),n=s(r),i=n.write(e,t);return i!==r&&(n=n.slice(0,i)),n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(A(e,Uint8Array)){var t=new Uint8Array(e);return p(t.buffer,t.byteOffset,t.byteLength)}return h(e)}(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(A(e,ArrayBuffer)||e&&A(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(A(e,SharedArrayBuffer)||e&&A(e.buffer,SharedArrayBuffer)))return p(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return o.from(n,t,r);var i=function(e){if(o.isBuffer(e)){var t,r=0|d(e.length),n=s(r);return 0===n.length||e.copy(n,0,0,r),n}return void 0!==e.length?"number"!=typeof e.length||(t=e.length)!=t?s(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return u(e),s(e<0?0:0|d(e))}function h(e){for(var t=e.length<0?0:0|d(e.length),r=s(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function p(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),n}function d(e){if(e>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||A(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return S(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return O(e).length;default:if(i)return n?-1:S(e).length;t=(""+t).toLowerCase(),i=!0}}function y(e,t,r){var i,a,s=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=C[e[a]];return i}(this,t,r);case"utf8":case"utf-8":return b(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return i=t,a=r,0===i&&a===this.length?n.fromByteArray(this):n.fromByteArray(this.slice(i,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length-1;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}(this,t,r);default:if(s)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),s=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function g(e,t,r,n,i){var a;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),(a=r=+r)!=a&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return -1;r=e.length-1}else if(r<0){if(!i)return -1;r=0}if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:v(e,t,r,n,i);if("number"==typeof t)return(t&=255,"function"==typeof Uint8Array.prototype.indexOf)?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):v(e,[t],r,n,i);throw TypeError("val must be string, number or Buffer")}function v(e,t,r,n,i){var a,s=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;s=2,o/=2,l/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var c=-1;for(a=r;a<o;a++)if(u(e,a)===u(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===l)return c*s}else -1!==c&&(a-=a-c),c=-1}else for(r+l>o&&(r=o-l),a=r;a>=0;a--){for(var h=!0,p=0;p<l;p++)if(u(e,a+p)!==u(t,p)){h=!1;break}if(h)return a}return -1}function b(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,s,o,l,u=e[i],c=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=r)switch(h){case 1:u<128&&(c=u);break;case 2:(192&(a=e[i+1]))==128&&(l=(31&u)<<6|63&a)>127&&(c=l);break;case 3:a=e[i+1],s=e[i+2],(192&a)==128&&(192&s)==128&&(l=(15&u)<<12|(63&a)<<6|63&s)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:a=e[i+1],s=e[i+2],o=e[i+3],(192&a)==128&&(192&s)==128&&(192&o)==128&&(l=(15&u)<<18|(63&a)<<12|(63&s)<<6|63&o)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}function w(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function E(e,t,r,n,i,a){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function x(e,t,r,n,i,a){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function _(e,t,r,n,a){return t=+t,r>>>=0,a||x(e,t,r,4,34028234663852886e22,-34028234663852886e22),i.write(e,t,r,n,23,4),r+4}function P(e,t,r,n,a){return t=+t,r>>>=0,a||x(e,t,r,8,17976931348623157e292,-17976931348623157e292),i.write(e,t,r,n,52,8),r+8}t.lW=o,t.h2=50,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(u(e),e<=0)?s(e):void 0!==t?"string"==typeof r?s(e).fill(t,r):s(e).fill(t):s(e)},o.allocUnsafe=function(e){return c(e)},o.allocUnsafeSlow=function(e){return c(e)},o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(A(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),A(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=o.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(A(a,Uint8Array))i+a.length>n.length?o.from(a).copy(n,i):Uint8Array.prototype.set.call(n,a,i);else if(o.isBuffer(a))a.copy(n,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=a.length}return n},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?b(this,0,e):y.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.h2;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},a&&(o.prototype[a]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,i){if(A(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var a=i-n,s=r-t,l=Math.min(a,s),u=this.slice(n,i),c=e.slice(t,r),h=0;h<l;++h)if(u[h]!==c[h]){a=u[h],s=c[h];break}return a<s?-1:s<a?1:0},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)},o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,a,s,o,l,u,c,h,p=this.length-t;if((void 0===r||r>p)&&(r=p),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var d=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;n>a/2&&(n=a/2);for(var s=0;s<n;++s){var o=parseInt(t.substr(2*s,2),16);if(o!=o)break;e[r+s]=o}return s}(this,e,t,r);case"utf8":case"utf-8":return i=t,a=r,k(S(e,this.length-i),this,i,a);case"ascii":case"latin1":case"binary":return s=t,o=r,k(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(e),this,s,o);case"base64":return l=t,u=r,k(O(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c=t,h=r,k(function(e,t){for(var r,n,i=[],a=0;a<e.length&&!((t-=2)<0);++a)n=(r=e.charCodeAt(a))>>8,i.push(r%256),i.push(n);return i}(e,this.length-c),this,c,h);default:if(d)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),d=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUintLE=o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},o.prototype.readUintBE=o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},o.prototype.readUint8=o.prototype.readUInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),this[e]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},o.prototype.readInt8=function(e,t){return(e>>>=0,t||w(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||w(e,4,this.length),i.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||w(e,8,this.length),i.read(this,e,!1,52,8)},o.prototype.writeUintLE=o.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;E(this,e,t,r,i,0)}var a=1,s=0;for(this[t]=255&e;++s<r&&(a*=256);)this[t+s]=e/a&255;return t+r},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;E(this,e,t,r,i,0)}var a=r-1,s=1;for(this[t+a]=255&e;--a>=0&&(s*=256);)this[t+a]=e/s&255;return t+r},o.prototype.writeUint8=o.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);E(this,e,t,r,i-1,-i)}var a=0,s=1,o=0;for(this[t]=255&e;++a<r&&(s*=256);)e<0&&0===o&&0!==this[t+a-1]&&(o=1),this[t+a]=(e/s>>0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);E(this,e,t,r,i-1,-i)}var a=r-1,s=1,o=0;for(this[t+a]=255&e;--a>=0&&(s*=256);)e<0&&0===o&&0!==this[t+a+1]&&(o=1),this[t+a]=(e/s>>0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||E(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return _(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return _(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return P(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return P(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var i,a=e.charCodeAt(0);("utf8"===n&&a<128||"latin1"===n)&&(e=a)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var s=o.isBuffer(e)?e:o.from(e,n),l=s.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=s[i%l]}return this};var I=/[^+/0-9A-Za-z-_]/g;function S(e,t){t=t||1/0;for(var r,n=e.length,i=null,a=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319||s+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return a}function O(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(I,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function k(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function A(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var C=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},1140:function(e,t){"use strict";t.parse=function(e,t){if("string"!=typeof e)throw TypeError("argument str must be a string");for(var n={},a=e.split(i),s=(t||{}).decode||r,o=0;o<a.length;o++){var l=a[o],u=l.indexOf("=");if(!(u<0)){var c=l.substr(0,u).trim(),h=l.substr(++u,l.length).trim();'"'==h[0]&&(h=h.slice(1,-1)),void 0==n[c]&&(n[c]=function(e,t){try{return t(e)}catch(t){return e}}(h,s))}}return n},t.serialize=function(e,t,r){var i=r||{},s=i.encode||n;if("function"!=typeof s)throw TypeError("option encode is invalid");if(!a.test(e))throw TypeError("argument name is invalid");var o=s(t);if(o&&!a.test(o))throw TypeError("argument val is invalid");var l=e+"="+o;if(null!=i.maxAge){var u=i.maxAge-0;if(isNaN(u))throw Error("maxAge should be a Number");l+="; Max-Age="+Math.floor(u)}if(i.domain){if(!a.test(i.domain))throw TypeError("option domain is invalid");l+="; Domain="+i.domain}if(i.path){if(!a.test(i.path))throw TypeError("option path is invalid");l+="; Path="+i.path}if(i.expires){if("function"!=typeof i.expires.toUTCString)throw TypeError("option expires is invalid");l+="; Expires="+i.expires.toUTCString()}if(i.httpOnly&&(l+="; HttpOnly"),i.secure&&(l+="; Secure"),i.sameSite)switch("string"==typeof i.sameSite?i.sameSite.toLowerCase():i.sameSite){case!0:case"strict":l+="; SameSite=Strict";break;case"lax":l+="; SameSite=Lax";break;default:throw TypeError("option sameSite is invalid")}return l};var r=decodeURIComponent,n=encodeURIComponent,i=/; */,a=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/},2917:function(e,t){t.read=function(e,t,r,n,i){var a,s,o=8*i-n-1,l=(1<<o)-1,u=l>>1,c=-7,h=r?i-1:0,p=r?-1:1,d=e[t+h];for(h+=p,a=d&(1<<-c)-1,d>>=-c,c+=o;c>0;a=256*a+e[t+h],h+=p,c-=8);for(s=a&(1<<-c)-1,a>>=-c,c+=n;c>0;s=256*s+e[t+h],h+=p,c-=8);if(0===a)a=1-u;else{if(a===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,n),a-=u}return(d?-1:1)*s*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var s,o,l,u=8*a-i-1,c=(1<<u)-1,h=c>>1,p=23===i?5960464477539062e-23:0,d=n?0:a-1,f=n?1:-1,y=t<0||0===t&&1/t<0?1:0;for(isNaN(t=Math.abs(t))||t===1/0?(o=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),s+h>=1?t+=p/l:t+=p*Math.pow(2,1-h),t*l>=2&&(s++,l/=2),s+h>=c?(o=0,s=c):s+h>=1?(o=(t*l-1)*Math.pow(2,i),s+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[r+d]=255&o,d+=f,o/=256,i-=8);for(s=s<<i|o,u+=i;u>0;e[r+d]=255&s,d+=f,s/=256,u-=8);e[r+d-f]|=128*y}},4540:function(e){var t,r,n=Object.prototype,i=Function.prototype.toString,a=n.hasOwnProperty,s=i.call(Object),o=n.toString,l=(t=Object.getPrototypeOf,r=Object,function(e){return t(r(e))});e.exports=function(e){if(!(e&&"object"==typeof e)||"[object Object]"!=o.call(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e))return!1;var t=l(e);if(null===t)return!0;var r=a.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&i.call(r)==s}},3335:function(e){"use strict";var t=Object.assign.bind(Object);e.exports=t,e.exports.default=e.exports},3920:function(e,t,r){"use strict";var n,i;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(i=r.g.process)?void 0:i.env)?r.g.process:r(3012)},3012:function(e){!function(){var t={229:function(e){var t,r,n,i=e.exports={};function a(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var l=[],u=!1,c=-1;function h(){u&&n&&(u=!1,n.length?l=n.concat(l):c=-1,l.length&&p())}function p(){if(!u){var e=o(h);u=!0;for(var t=l.length;t;){for(n=l,l=[];++c<t;)n&&n[c].run();c=-1,t=l.length}n=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function f(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new d(e,t)),1!==l.length||u||o(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=f,i.addListener=f,i.once=f,i.off=f,i.removeListener=f,i.removeAllListeners=f,i.emit=f,i.prependListener=f,i.prependOnceListener=f,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},r={};function n(e){var i=r[e];if(void 0!==i)return i.exports;var a=r[e]={exports:{}},s=!0;try{t[e](a,a.exports,n),s=!1}finally{s&&delete r[e]}return a.exports}n.ab="//";var i=n(229);e.exports=i}()},699:function(e,t,r){var n=r(3920);"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab="//"),({189:function(){!function(e,t){"use strict";if(!e.setImmediate){var r,i,a,s,o,l=1,u={},c=!1,h=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);(p=p&&p.setTimeout?p:e,"[object process]"===({}).toString.call(e.process))?o=function(e){n.nextTick(function(){f(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,r=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=r,t}}()?(r="setImmediate$"+Math.random()+"$",i=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(r)&&f(+t.data.slice(r.length))},e.addEventListener?e.addEventListener("message",i,!1):e.attachEvent("onmessage",i),o=function(t){e.postMessage(r+t,"*")}):e.MessageChannel?((a=new MessageChannel).port1.onmessage=function(e){f(e.data)},o=function(e){a.port2.postMessage(e)}):h&&"onreadystatechange"in h.createElement("script")?(s=h.documentElement,o=function(e){var t=h.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,s.removeChild(t),t=null},s.appendChild(t)}):o=function(e){setTimeout(f,0,e)},p.setImmediate=function(e){"function"!=typeof e&&(e=Function(""+e));for(var t=Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var n={callback:e,args:t};return u[l]=n,o(l),l++},p.clearImmediate=d}function d(e){delete u[e]}function f(e){if(c)setTimeout(f,0,e);else{var r=u[e];if(r){c=!0;try{!function(e){var r=e.callback,n=e.args;switch(n.length){case 0:r();break;case 1:r(n[0]);break;case 2:r(n[0],n[1]);break;case 3:r(n[0],n[1],n[2]);break;default:r.apply(t,n)}}(r)}finally{d(e),c=!1}}}}}("undefined"==typeof self?void 0===r.g?this:r.g:self)}})[189](),e.exports={}},541:function(e,t,r){"use strict";var n=r(1237);function i(){}function a(){}a.resetWarningCache=i,e.exports=function(){function e(e,t,r,i,a,s){if(s!==n){var o=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:i};return r.PropTypes=r,r}},8202:function(e,t,r){e.exports=r(541)()},1237:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},783:function(e,t,r){"use strict";var n=r(3920),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=o(r(1140)),s=o(r(3335));function o(e){return e&&e.__esModule?e:{default:e}}var l="undefined"==typeof document||void 0!==n&&n.env&&!1,u={},c=void 0;function h(){return c&&!c.headersSent}function p(e){u=e?a.default.parse(e):{}}t.ZP={setRawCookie:p,load:function(e,t){var r=l?u:a.default.parse(document.cookie),n=r&&r[e];if(void 0===t&&(t=!n||"{"!==n[0]&&"["!==n[0]),!t)try{n=JSON.parse(n)}catch(e){}return n},loadAll:function(e){var t=l?u:a.default.parse(document.cookie);if(void 0===e&&(e=!t||"{"!==t[0]&&"["!==t[0]),!e)try{t=JSON.parse(t)}catch(e){}return t},select:function(e){var t=l?u:a.default.parse(document.cookie);return t?e?Object.keys(t).reduce(function(r,n){if(!e.test(n))return r;var i={};return i[n]=t[n],(0,s.default)({},r,i)},{}):t:{}},save:function(e,t,r){u[e]=t,(void 0===t?"undefined":i(t))==="object"&&(u[e]=JSON.stringify(t)),l||(document.cookie=a.default.serialize(e,u[e],r)),h()&&c.cookie&&c.cookie(e,t,r)},remove:function(e,t){delete u[e],t=void 0===t?{}:"string"==typeof t?{path:t}:(0,s.default)({},t),"undefined"!=typeof document&&(t.expires=new Date(1970,1,1,0,0,1),t.maxAge=0,document.cookie=a.default.serialize(e,"",t)),h()&&c.clearCookie&&c.clearCookie(e,t)},plugToRequest:function(e,t){return e.cookie?u=e.cookie:e.cookies?u=e.cookies:e.headers&&e.headers.cookie?p(e.headers.cookie):u={},c=t,function(){c=null,u={}}}}},4849:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.diffAny=t.diffObjects=t.diffArrays=t.intersection=t.subtract=t.isDestructive=void 0;var n=r(8220);function i(e,t){var r={};for(var i in e)n.hasOwnProperty.call(e,i)&&void 0!==e[i]&&(r[i]=1);for(var a in t)n.hasOwnProperty.call(t,a)&&void 0!==t[a]&&delete r[a];return Object.keys(r)}function a(e){for(var t=e.length,r={},i=0;i<t;i++){var a=e[i];for(var s in a)n.hasOwnProperty.call(a,s)&&void 0!==a[s]&&(r[s]=(r[s]||0)+1)}for(var s in r)r[s]<t&&delete r[s];return Object.keys(r)}function s(e,t){return{operations:e.operations.concat(t),cost:e.cost+1}}function o(e,t,r,n){void 0===n&&(n=u);var i={"0,0":{operations:[],cost:0}},a=isNaN(e.length)||e.length<=0?0:e.length;return(function a(o,l){var u="".concat(o,",").concat(l),c=i[u];if(void 0===c){if(o>0&&l>0&&!n(e[o-1],t[l-1],r.add(String(o-1))).length)c=a(o-1,l-1);else{var h=[];if(o>0){var p=a(o-1,l);h.push(s(p,{op:"remove",index:o-1}))}if(l>0){var d=a(o,l-1),f={op:"add",index:o-1,value:t[l-1]};h.push(s(d,f))}if(o>0&&l>0){var y=a(o-1,l-1),m={op:"replace",index:o-1,original:e[o-1],value:t[l-1]};h.push(s(y,m))}c=h.sort(function(e,t){return e.cost-t.cost})[0]}i[u]=c}return c})(a,isNaN(t.length)||t.length<=0?0:t.length).operations.reduce(function(e,t){var i=e[0],s=e[1];if("add"===t.op){var o=t.index+1+s,l=o<a+s?String(o):"-",u={op:t.op,path:r.add(l).toString(),value:t.value};return[i.concat(u),s+1]}if("remove"===t.op){var u={op:t.op,path:r.add(String(t.index+s)).toString()};return[i.concat(u),s-1]}var c=r.add(String(t.index+s)),h=n(t.original,t.value,c);return[i.concat.apply(i,h),s]},[[],0])[0]}function l(e,t,r,n){void 0===n&&(n=u);var s=[];return i(e,t).forEach(function(e){s.push({op:"remove",path:r.add(e).toString()})}),i(t,e).forEach(function(e){s.push({op:"add",path:r.add(e).toString(),value:t[e]})}),a([e,t]).forEach(function(i){s.push.apply(s,n(e[i],t[i],r.add(i)))}),s}function u(e,t,r,i){if(void 0===i&&(i=u),e===t)return[];var a=(0,n.objectType)(e),s=(0,n.objectType)(t);return"array"==a&&"array"==s?o(e,t,r,i):"object"==a&&"object"==s?l(e,t,r,i):[{op:"replace",path:r.toString(),value:t}]}t.isDestructive=function(e){var t=e.op;return"remove"===t||"replace"===t||"copy"===t||"move"===t},t.subtract=i,t.intersection=a,t.diffArrays=o,t.diffObjects=l,t.diffAny=u},6745:function(e,t,r){"use strict";t.rh=t.af=void 0;var n=r(915),i=r(1990),a=r(4849);t.af=function(e,t){return t.map(function(t){return(0,i.apply)(e,t)})},t.rh=function(e,t,r){var i=new n.Pointer;return(r?function e(t,n,i){var s=r(t,n,i);return Array.isArray(s)?s:(0,a.diffAny)(t,n,i,e)}:a.diffAny)(e,t,i)}},1990:function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.apply=t.InvalidOperationError=t.test=t.copy=t.move=t.replace=t.remove=t.add=t.TestError=t.MissingError=void 0;var a=r(915),s=r(8220),o=r(4849),l=function(e){function t(t){var r=e.call(this,"Value required at path: ".concat(t))||this;return r.path=t,r.name="MissingError",r}return i(t,e),t}(Error);t.MissingError=l;var u=function(e){function t(t,r){var n=e.call(this,"Test failed: ".concat(t," != ").concat(r))||this;return n.actual=t,n.expected=r,n.name="TestError",n}return i(t,e),t}(Error);function c(e,t,r){if(Array.isArray(e)){if("-"==t)e.push(r);else{var n=parseInt(t,10);e.splice(n,0,r)}}else e[t]=r}function h(e,t){if(Array.isArray(e)){var r=parseInt(t,10);e.splice(r,1)}else delete e[t]}function p(e,t){var r=a.Pointer.fromJSON(t.path).evaluate(e);return void 0===r.parent?new l(t.path):(c(r.parent,r.key,(0,s.clone)(t.value)),null)}function d(e,t){var r=a.Pointer.fromJSON(t.path).evaluate(e);return void 0===r.value?new l(t.path):(h(r.parent,r.key),null)}function f(e,t){var r=a.Pointer.fromJSON(t.path).evaluate(e);if(null===r.parent)return new l(t.path);if(Array.isArray(r.parent)){if(parseInt(r.key,10)>=r.parent.length)return new l(t.path)}else if(void 0===r.value)return new l(t.path);return r.parent[r.key]=(0,s.clone)(t.value),null}function y(e,t){var r=a.Pointer.fromJSON(t.from).evaluate(e);if(void 0===r.value)return new l(t.from);var n=a.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.parent?new l(t.path):(h(r.parent,r.key),c(n.parent,n.key,r.value),null)}function m(e,t){var r=a.Pointer.fromJSON(t.from).evaluate(e);if(void 0===r.value)return new l(t.from);var n=a.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.parent?new l(t.path):(c(n.parent,n.key,(0,s.clone)(r.value)),null)}function g(e,t){var r=a.Pointer.fromJSON(t.path).evaluate(e);return(0,o.diffAny)(r.value,t.value,new a.Pointer).length?new u(r.value,t.value):null}t.TestError=u,t.add=p,t.remove=d,t.replace=f,t.move=y,t.copy=m,t.test=g;var v=function(e){function t(t){var r=e.call(this,"Invalid operation: ".concat(t.op))||this;return r.operation=t,r.name="InvalidOperationError",r}return i(t,e),t}(Error);t.InvalidOperationError=v,t.apply=function(e,t){switch(t.op){case"add":return p(e,t);case"remove":return d(e,t);case"replace":return f(e,t);case"move":return y(e,t);case"copy":return m(e,t);case"test":return g(e,t)}return new v(t)}},915:function(e,t){"use strict";function r(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function n(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(t,"__esModule",{value:!0}),t.Pointer=void 0;var i=function(){function e(e){void 0===e&&(e=[""]),this.tokens=e}return e.fromJSON=function(t){var n=t.split("/").map(r);if(""!==n[0])throw Error("Invalid JSON Pointer: ".concat(t));return new e(n)},e.prototype.toString=function(){return this.tokens.map(n).join("/")},e.prototype.evaluate=function(e){for(var t=null,r="",n=e,i=1,a=this.tokens.length;i<a;i++)t=n,"__proto__"!=(r=this.tokens[i])&&"constructor"!=r&&"prototype"!=r&&(n=(t||{})[r]);return{parent:t,key:r,value:n}},e.prototype.get=function(e){return this.evaluate(e).value},e.prototype.set=function(e,t){var r=this.evaluate(e);r.parent&&(r.parent[r.key]=t)},e.prototype.push=function(e){this.tokens.push(e)},e.prototype.add=function(t){return new e(this.tokens.concat(String(t)))},e}();t.Pointer=i},8220:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.clone=t.objectType=t.hasOwnProperty=void 0,t.hasOwnProperty=Object.prototype.hasOwnProperty,t.objectType=function(e){return void 0===e?"undefined":null===e?"null":Array.isArray(e)?"array":typeof e},t.clone=function e(r){if(!(null!=r&&"object"==typeof r))return r;if(r.constructor==Array){for(var n=r.length,i=Array(n),a=0;a<n;a++)i[a]=e(r[a]);return i}if(r.constructor==Date)return new Date(+r);var s={};for(var o in r)t.hasOwnProperty.call(r,o)&&(s[o]=e(r[o]));return s}},4992:function(e,t,r){"use strict";r.d(t,{hE2:function(){return p},IIB:function(){return ee},$jN:function(){return d.c}});var n=r(5986),i=r(5501),a=r(4396),s=r(7189),o=r(1527),l=r(6876),u=r(516),c=r(244),h=(0,a.Gp)((e,t)=>{let{Component:r,domRef:h,context:p,children:d,classNames:f,getButtonGroupProps:y}=function(e){var t,r;let u=(0,i.w)(),[c,h]=(0,a.oe)(e,n.D.variantKeys),{ref:p,as:d,children:f,color:y="default",size:m="md",variant:g="solid",radius:v,isDisabled:b=!1,isIconOnly:w=!1,disableRipple:E=null!=(t=null==u?void 0:u.disableRipple)&&t,disableAnimation:x=null!=(r=null==u?void 0:u.disableAnimation)&&r,className:_,...P}=c,I=(0,s.gy)(p),S=(0,o.useMemo)(()=>(0,n.D)({...h,className:_}),[(0,l.Xx)(h),_]);return{Component:d||"div",children:f,domRef:I,context:(0,o.useMemo)(()=>({size:m,color:y,variant:g,radius:v,isIconOnly:w,isDisabled:b,disableAnimation:x,disableRipple:E,fullWidth:!!(null==e?void 0:e.fullWidth)}),[m,y,g,v,b,w,x,E,null==e?void 0:e.fullWidth]),classNames:S,getButtonGroupProps:(0,o.useCallback)(()=>({role:"group",...P}),[P])}}({...e,ref:t});return(0,c.jsx)(u.D,{value:p,children:(0,c.jsx)(r,{ref:h,className:f,...y(),children:d})})});h.displayName="NextUI.ButtonGroup";var p=h,d=r(8827),f=r(2456),y=r(1330),m=r(2034),g=r(9578),v=(0,m.tv)({slots:{base:"group flex flex-col data-[hidden=true]:hidden",label:["absolute","z-10","pointer-events-none","origin-top-left","rtl:origin-top-right","subpixel-antialiased","block","text-small","text-foreground-500"],mainWrapper:"h-full",inputWrapper:"relative w-full inline-flex tap-highlight-transparent flex-row items-center shadow-sm px-3 gap-3",innerWrapper:"inline-flex w-full items-center h-full box-border",input:["w-full font-normal bg-transparent !outline-none placeholder:text-foreground-500 focus-visible:outline-none","data-[has-start-content=true]:ps-1.5","data-[has-end-content=true]:pe-1.5","file:cursor-pointer file:bg-transparent file:border-0","autofill:bg-transparent bg-clip-text"],clearButton:["p-2","-m-2","z-10","hidden","absolute","end-3","start-auto","appearance-none","outline-none","select-none","opacity-0","hover:!opacity-100","cursor-pointer","active:!opacity-70","rounded-full",...g.Dh],helperWrapper:"hidden group-data-[has-helper=true]:flex p-1 relative flex-col gap-1.5",description:"text-tiny text-foreground-400",errorMessage:"text-tiny text-danger"},variants:{variant:{flat:{inputWrapper:["bg-default-100","data-[hover=true]:bg-default-200","group-data-[focus=true]:bg-default-100"]},faded:{inputWrapper:["bg-default-100","border-medium","border-default-200","data-[hover=true]:border-default-400"],value:"group-data-[has-value=true]:text-default-foreground"},bordered:{inputWrapper:["border-medium","border-default-200","data-[hover=true]:border-default-400","group-data-[focus=true]:border-default-foreground"]},underlined:{inputWrapper:["!px-1","!pb-0","!gap-0","relative","box-border","border-b-medium","shadow-[0_1px_0px_0_rgba(0,0,0,0.05)]","border-default-200","!rounded-none","hover:border-default-300","after:content-['']","after:w-0","after:origin-center","after:bg-default-foreground","after:absolute","after:left-1/2","after:-translate-x-1/2","after:-bottom-[2px]","after:h-[2px]","group-data-[focus=true]:after:w-full"],innerWrapper:"pb-1",label:"group-data-[filled-within=true]:text-foreground"}},color:{default:{},primary:{},secondary:{},success:{},warning:{},danger:{}},size:{sm:{label:"text-tiny",inputWrapper:"h-8 min-h-8 px-2 rounded-small",input:"text-small",clearButton:"text-medium"},md:{inputWrapper:"h-10 min-h-10 rounded-medium",input:"text-small",clearButton:"text-large"},lg:{inputWrapper:"h-12 min-h-12 rounded-large",input:"text-medium",clearButton:"text-large"}},radius:{none:{inputWrapper:"rounded-none"},sm:{inputWrapper:"rounded-small"},md:{inputWrapper:"rounded-medium"},lg:{inputWrapper:"rounded-large"},full:{inputWrapper:"rounded-full"}},labelPlacement:{outside:{mainWrapper:"flex flex-col"},"outside-left":{base:"flex-row items-center flex-nowrap data-[has-helper=true]:items-start",inputWrapper:"flex-1",mainWrapper:"flex flex-col",label:"relative text-foreground pe-2 ps-2 pointer-events-auto"},inside:{label:"text-tiny cursor-text",inputWrapper:"flex-col items-start justify-center gap-0",innerWrapper:"group-data-[has-label=true]:items-end"}},fullWidth:{true:{base:"w-full"}},isClearable:{true:{input:"peer pr-6 rtl:pr-0 rtl:pl-6",clearButton:"peer-data-[filled=true]:opacity-70 peer-data-[filled=true]:block"}},isDisabled:{true:{base:"opacity-disabled pointer-events-none",inputWrapper:"pointer-events-none",label:"pointer-events-none"}},isInvalid:{true:{label:"!text-danger",input:"!placeholder:text-danger !text-danger"}},isRequired:{true:{label:"after:content-['*'] after:text-danger after:ml-0.5 rtl:after:ml-[unset] rtl:after:mr-0.5"}},isMultiline:{true:{label:"relative",inputWrapper:"!h-auto",innerWrapper:"items-start group-data-[has-label=true]:items-start",input:"resize-none data-[hide-scroll=true]:scrollbar-hide"}},disableAnimation:{true:{input:"transition-none",inputWrapper:"transition-none",label:"transition-none"},false:{inputWrapper:"transition-background motion-reduce:transition-none !duration-150",label:["will-change-auto","!duration-200","!ease-out","motion-reduce:transition-none","transition-[transform,color,left,opacity]"],clearButton:["transition-opacity","motion-reduce:transition-none"]}}},defaultVariants:{variant:"flat",color:"default",size:"md",fullWidth:!0,labelPlacement:"inside",isDisabled:!1,isMultiline:!1},compoundVariants:[{variant:"flat",color:"default",class:{input:"group-data-[has-value=true]:text-default-foreground"}},{variant:"flat",color:"primary",class:{inputWrapper:["bg-primary-50","data-[hover=true]:bg-primary-100","text-primary","group-data-[focus=true]:bg-primary-50","placeholder:text-primary"],input:"placeholder:text-primary",label:"text-primary"}},{variant:"flat",color:"secondary",class:{inputWrapper:["bg-secondary-50","text-secondary","data-[hover=true]:bg-secondary-100","group-data-[focus=true]:bg-secondary-50","placeholder:text-secondary"],input:"placeholder:text-secondary",label:"text-secondary"}},{variant:"flat",color:"success",class:{inputWrapper:["bg-success-50","text-success-600","dark:text-success","placeholder:text-success-600","dark:placeholder:text-success","data-[hover=true]:bg-success-100","group-data-[focus=true]:bg-success-50"],input:"placeholder:text-success-600 dark:placeholder:text-success",label:"text-success-600 dark:text-success"}},{variant:"flat",color:"warning",class:{inputWrapper:["bg-warning-50","text-warning-600","dark:text-warning","placeholder:text-warning-600","dark:placeholder:text-warning","data-[hover=true]:bg-warning-100","group-data-[focus=true]:bg-warning-50"],input:"placeholder:text-warning-600 dark:placeholder:text-warning",label:"text-warning-600 dark:text-warning"}},{variant:"flat",color:"danger",class:{inputWrapper:["bg-danger-50","text-danger","dark:text-danger-500","placeholder:text-danger","dark:placeholder:text-danger-500","data-[hover=true]:bg-danger-100","group-data-[focus=true]:bg-danger-50"],input:"placeholder:text-danger dark:placeholder:text-danger-500",label:"text-danger dark:text-danger-500"}},{variant:"faded",color:"primary",class:{label:"text-primary",inputWrapper:"data-[hover=true]:border-primary focus-within:border-primary"}},{variant:"faded",color:"secondary",class:{label:"text-secondary",inputWrapper:"data-[hover=true]:border-secondary focus-within:border-secondary"}},{variant:"faded",color:"success",class:{label:"text-success",inputWrapper:"data-[hover=true]:border-success focus-within:border-success"}},{variant:"faded",color:"warning",class:{label:"text-warning",inputWrapper:"data-[hover=true]:border-warning focus-within:border-warning"}},{variant:"faded",color:"danger",class:{label:"text-danger",inputWrapper:"data-[hover=true]:border-danger focus-within:border-danger"}},{variant:"underlined",color:"default",class:{input:"group-data-[has-value=true]:text-foreground"}},{variant:"underlined",color:"primary",class:{inputWrapper:"after:bg-primary",label:"text-primary"}},{variant:"underlined",color:"secondary",class:{inputWrapper:"after:bg-secondary",label:"text-secondary"}},{variant:"underlined",color:"success",class:{inputWrapper:"after:bg-success",label:"text-success"}},{variant:"underlined",color:"warning",class:{inputWrapper:"after:bg-warning",label:"text-warning"}},{variant:"underlined",color:"danger",class:{inputWrapper:"after:bg-danger",label:"text-danger"}},{variant:"bordered",color:"primary",class:{inputWrapper:"group-data-[focus=true]:border-primary",label:"text-primary"}},{variant:"bordered",color:"secondary",class:{inputWrapper:"group-data-[focus=true]:border-secondary",label:"text-secondary"}},{variant:"bordered",color:"success",class:{inputWrapper:"group-data-[focus=true]:border-success",label:"text-success"}},{variant:"bordered",color:"warning",class:{inputWrapper:"group-data-[focus=true]:border-warning",label:"text-warning"}},{variant:"bordered",color:"danger",class:{inputWrapper:"group-data-[focus=true]:border-danger",label:"text-danger"}},{labelPlacement:"inside",color:"default",class:{label:"group-data-[filled-within=true]:text-default-600"}},{labelPlacement:"outside",color:"default",class:{label:"group-data-[filled-within=true]:text-foreground"}},{radius:"full",size:["sm"],class:{inputWrapper:"px-3"}},{radius:"full",size:"md",class:{inputWrapper:"px-4"}},{radius:"full",size:"lg",class:{inputWrapper:"px-5"}},{disableAnimation:!1,variant:["faded","bordered"],class:{inputWrapper:"transition-colors motion-reduce:transition-none"}},{disableAnimation:!1,variant:"underlined",class:{inputWrapper:"after:transition-width motion-reduce:after:transition-none"}},{variant:["flat","faded"],class:{inputWrapper:[...g.ID]}},{isInvalid:!0,variant:"flat",class:{inputWrapper:["!bg-danger-50","data-[hover=true]:!bg-danger-100","group-data-[focus=true]:!bg-danger-50"]}},{isInvalid:!0,variant:"bordered",class:{inputWrapper:"!border-danger group-data-[focus=true]:!border-danger"}},{isInvalid:!0,variant:"underlined",class:{inputWrapper:"after:!bg-danger"}},{labelPlacement:"inside",size:"sm",class:{inputWrapper:"h-12 py-1.5 px-3"}},{labelPlacement:"inside",size:"md",class:{inputWrapper:"h-14 py-2"}},{labelPlacement:"inside",size:"lg",class:{label:"text-small",inputWrapper:"h-16 py-2.5 gap-0"}},{labelPlacement:"inside",size:"sm",variant:["bordered","faded"],class:{inputWrapper:"py-1"}},{labelPlacement:["inside","outside"],class:{label:["group-data-[filled-within=true]:pointer-events-auto"]}},{labelPlacement:"outside",isMultiline:!1,class:{base:"relative justify-end",label:["pb-0","z-20","top-1/2","-translate-y-1/2","group-data-[filled-within=true]:start-0"]}},{labelPlacement:["inside"],class:{label:["group-data-[filled-within=true]:scale-85"]}},{labelPlacement:["inside"],variant:"flat",class:{innerWrapper:"pb-0.5"}},{variant:"underlined",size:"sm",class:{innerWrapper:"pb-1"}},{variant:"underlined",size:["md","lg"],class:{innerWrapper:"pb-1.5"}},{labelPlacement:"inside",size:["sm","md"],class:{label:"text-small"}},{labelPlacement:"inside",isMultiline:!1,size:"sm",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_theme(fontSize.tiny)/2_-_8px)]"]}},{labelPlacement:"inside",isMultiline:!1,size:"md",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_theme(fontSize.small)/2_-_6px)]"]}},{labelPlacement:"inside",isMultiline:!1,size:"lg",class:{label:["text-medium","group-data-[filled-within=true]:-translate-y-[calc(50%_+_theme(fontSize.small)/2_-_8px)]"]}},{labelPlacement:"inside",variant:["faded","bordered"],isMultiline:!1,size:"sm",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_theme(fontSize.tiny)/2_-_8px_-_theme(borderWidth.medium))]"]}},{labelPlacement:"inside",variant:["faded","bordered"],isMultiline:!1,size:"md",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_theme(fontSize.small)/2_-_6px_-_theme(borderWidth.medium))]"]}},{labelPlacement:"inside",variant:["faded","bordered"],isMultiline:!1,size:"lg",class:{label:["text-medium","group-data-[filled-within=true]:-translate-y-[calc(50%_+_theme(fontSize.small)/2_-_8px_-_theme(borderWidth.medium))]"]}},{labelPlacement:"inside",variant:"underlined",isMultiline:!1,size:"sm",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_theme(fontSize.tiny)/2_-_5px)]"]}},{labelPlacement:"inside",variant:"underlined",isMultiline:!1,size:"md",class:{label:["group-data-[filled-within=true]:-translate-y-[calc(50%_+_theme(fontSize.small)/2_-_3.5px)]"]}},{labelPlacement:"inside",variant:"underlined",size:"lg",isMultiline:!1,class:{label:["text-medium","group-data-[filled-within=true]:-translate-y-[calc(50%_+_theme(fontSize.small)/2_-_4px)]"]}},{labelPlacement:"outside",size:"sm",isMultiline:!1,class:{label:["start-2","text-tiny","group-data-[filled-within=true]:-translate-y-[calc(100%_+_theme(fontSize.tiny)/2_+_16px)]"],base:"data-[has-label=true]:mt-[calc(theme(fontSize.small)_+_8px)]"}},{labelPlacement:"outside",size:"md",isMultiline:!1,class:{label:["start-3","end-auto","text-small","group-data-[filled-within=true]:-translate-y-[calc(100%_+_theme(fontSize.small)/2_+_20px)]"],base:"data-[has-label=true]:mt-[calc(theme(fontSize.small)_+_10px)]"}},{labelPlacement:"outside",size:"lg",isMultiline:!1,class:{label:["start-3","end-auto","text-medium","group-data-[filled-within=true]:-translate-y-[calc(100%_+_theme(fontSize.small)/2_+_24px)]"],base:"data-[has-label=true]:mt-[calc(theme(fontSize.small)_+_12px)]"}},{labelPlacement:"outside-left",size:"sm",class:{label:"group-data-[has-helper=true]:pt-2"}},{labelPlacement:"outside-left",size:"md",class:{label:"group-data-[has-helper=true]:pt-3"}},{labelPlacement:"outside-left",size:"lg",class:{label:"group-data-[has-helper=true]:pt-4"}},{labelPlacement:["outside","outside-left"],isMultiline:!0,class:{inputWrapper:"py-2"}},{labelPlacement:"outside",isMultiline:!0,class:{label:"pb-1.5"}},{labelPlacement:"inside",isMultiline:!0,class:{label:"pb-0.5",input:"pt-0"}},{isMultiline:!0,disableAnimation:!1,class:{input:"transition-height !duration-100 motion-reduce:transition-none"}},{labelPlacement:["inside","outside"],class:{label:["pe-2","max-w-full","text-ellipsis","overflow-hidden"]}},{isMultiline:!0,radius:"full",class:{inputWrapper:"data-[has-multiple-rows=true]:rounded-large"}}]}),b=r(3273),w=r(2770),E=r(9802),x=r(3143),_=r(4251),P=r(1280),I=(...e)=>{let t=" ";for(let r of e)if("string"==typeof r&&r.length>0){t=r;break}return t},S=r(3920),O={},k=r(5797),A=r(308),C=r(7386),N=r(7243),M=r(6437),D=r(9967),T=r(7582),B=r(8447),R=r(3293),j=r(1484),L=r(7134),U=r(5622),W=r(2102);let z=o.createContext(null);var G=r(4350),q=r(1693);let F={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},V={...F,customError:!0,valid:!1},$={isInvalid:!1,validationDetails:F,validationErrors:[]},J=(0,o.createContext)({}),H="__formValidationState"+Date.now();function K(e){return e?Array.isArray(e)?e:[e]:[]}function Y(e){return e.length?{isInvalid:!0,validationErrors:e,validationDetails:V}:null}function X(e,t){return e===t||e&&t&&e.isInvalid===t.isInvalid&&e.validationErrors.length===t.validationErrors.length&&e.validationErrors.every((e,r)=>e===t.validationErrors[r])&&Object.entries(e.validationDetails).every(([e,r])=>t.validationDetails[e]===r)}var Q=e=>(0,c.jsx)("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 0 24 24",width:"1em",...e,children:(0,c.jsx)("path",{d:"M12 2a10 10 0 1010 10A10.016 10.016 0 0012 2zm3.36 12.3a.754.754 0 010 1.06.748.748 0 01-1.06 0l-2.3-2.3-2.3 2.3a.748.748 0 01-1.06 0 .754.754 0 010-1.06l2.3-2.3-2.3-2.3A.75.75 0 019.7 8.64l2.3 2.3 2.3-2.3a.75.75 0 011.06 1.06l-2.3 2.3z",fill:"currentColor"})}),Z=(0,a.Gp)((e,t)=>{let{Component:r,label:n,description:u,isClearable:h,startContent:p,endContent:d,labelPlacement:m,hasHelper:g,isOutsideLeft:F,shouldLabelBeOutside:Z,errorMessage:ee,isInvalid:et,getBaseProps:er,getLabelProps:en,getInputProps:ei,getInnerWrapperProps:ea,getInputWrapperProps:es,getMainWrapperProps:eo,getHelperWrapperProps:el,getDescriptionProps:eu,getErrorMessageProps:ec,getClearButtonProps:eh}=function(e){var t,r,n,u;let c=(0,i.w)(),[h,p]=(0,a.oe)(e,v.variantKeys),{ref:d,as:m,type:g,label:F,baseRef:Q,wrapperRef:Z,description:ee,className:et,classNames:er,autoFocus:en,startContent:ei,endContent:ea,onClear:es,onChange:eo,validationState:el,validationBehavior:eu=null!=(t=null==c?void 0:c.validationBehavior)?t:"aria",innerWrapperRef:ec,onValueChange:eh=()=>{},...ep}=h,ed=(0,o.useCallback)(e=>{eh(null!=e?e:"")},[eh]),[ef,ey]=(0,o.useState)(!1),em=null!=(n=null!=(r=e.disableAnimation)?r:null==c?void 0:c.disableAnimation)&&n,eg=(0,s.gy)(d),ev=(0,s.gy)(Q),eb=(0,s.gy)(Z),ew=(0,s.gy)(ec),[eE,ex]=function(e,t,r){let[n,i]=(0,o.useState)(e||t),a=(0,o.useRef)(void 0!==e),s=void 0!==e;(0,o.useEffect)(()=>{let e=a.current;e!==s&&console.warn(`WARN: A component changed from ${e?"controlled":"uncontrolled"} to ${s?"controlled":"uncontrolled"}.`),a.current=s},[s]);let l=s?e:n,u=(0,o.useCallback)((e,...t)=>{let n=(e,...t)=>{r&&!Object.is(l,e)&&r(e,...t),s||(l=e)};"function"==typeof e?(console.warn("We can not support a function callback. See Github Issues for details https://github.com/adobe/react-spectrum/issues/2320"),i((r,...i)=>{let a=e(s?l:r,...i);return(n(a,...t),s)?r:a})):(s||i(e),n(e,...t))},[s,l,r]);return[l,u]}(h.value,null!=(u=h.defaultValue)?u:"",ed),e_=["date","time","month","week","range"].includes(g),eP=!(0,_.xb)(eE)||e_,eI=eP||ef,eS="hidden"===g,eO=e.isMultiline,ek="file"===g,eA=(0,P.W)(null==er?void 0:er.base,et,eP?"is-filled":""),eC=(0,o.useCallback)(()=>{var e;ex(""),null==es||es(),null==(e=eg.current)||e.focus()},[ex,es]);(0,f.G)(()=>{eg.current&&ex(eg.current.value)},[eg.current]);let{labelProps:eN,inputProps:eM,isInvalid:eD,validationErrors:eT,validationDetails:eB,descriptionProps:eR,errorMessageProps:ej}=function(e,t){let r,n,{inputElementType:i="input",isDisabled:a=!1,isRequired:s=!1,isReadOnly:l=!1,type:u="text",validationBehavior:c="aria"}=e,[h,p]=(0,T.z)(e.value,e.defaultValue||"",e.onChange),{focusableProps:d}=function(e,t){let{focusProps:r}=(0,U.K)(e),{keyboardProps:n}=(0,W.v)(e),i=(0,D.d)(r,n),a=function(e){let t=(0,o.useContext)(z)||{};(0,L.l)(t,e);let{ref:r,...n}=t;return n}(t),s=e.isDisabled?{}:a,l=(0,o.useRef)(e.autoFocus);return(0,o.useEffect)(()=>{l.current&&t.current&&(0,j.e)(t.current),l.current=!1},[t]),{focusableProps:(0,D.d)({...i,tabIndex:e.excludeFromTabOrder&&!e.isDisabled?-1:void 0},s)}}(e,t),f=function(e){if(e[H]){let{realtimeValidation:t,displayValidation:r,updateValidation:n,resetValidation:i,commitValidation:a}=e[H];return{realtimeValidation:t,displayValidation:r,updateValidation:n,resetValidation:i,commitValidation:a}}return function(e){let{isInvalid:t,validationState:r,name:n,value:i,builtinValidation:a,validate:s,validationBehavior:l="aria"}=e;r&&(t||(t="invalid"===r));let u=void 0!==t?{isInvalid:t,validationErrors:[],validationDetails:V}:null,c=(0,o.useMemo)(()=>Y(function(e,t){if("function"==typeof e){let r=e(t);if(r&&"boolean"!=typeof r)return K(r)}return[]}(s,i)),[s,i]);(null==a?void 0:a.validationDetails.valid)&&(a=null);let h=(0,o.useContext)(J),p=(0,o.useMemo)(()=>n?Array.isArray(n)?n.flatMap(e=>K(h[e])):K(h[n]):[],[h,n]),[d,f]=(0,o.useState)(h),[y,m]=(0,o.useState)(!1);h!==d&&(f(h),m(!1));let g=(0,o.useMemo)(()=>Y(y?[]:p),[y,p]),v=(0,o.useRef)($),[b,w]=(0,o.useState)($),E=(0,o.useRef)($),[x,_]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{if(!x)return;_(!1);let e=c||a||v.current;X(e,E.current)||(E.current=e,w(e))}),{realtimeValidation:u||g||c||a||$,displayValidation:"native"===l?u||g||b:u||g||c||a||b,updateValidation(e){"aria"!==l||X(b,e)?v.current=e:w(e)},resetValidation(){X($,E.current)||(E.current=$,w($)),"native"===l&&_(!1),m(!0)},commitValidation(){"native"===l&&_(!0),m(!0)}}}(e)}({...e,value:h}),{isInvalid:y,validationErrors:m,validationDetails:g}=f.displayValidation,{labelProps:v,fieldProps:b,descriptionProps:w,errorMessageProps:E}=function(e){let{description:t,errorMessage:r,isInvalid:n,validationState:i}=e,{labelProps:a,fieldProps:s}=function(e){let{id:t,label:r,"aria-labelledby":n,"aria-label":i,labelElementType:a="label"}=e;t=(0,B.Me)(t);let s=(0,B.Me)(),o={};return r?(n=n?`${s} ${n}`:s,o={id:s,htmlFor:"label"===a?t:void 0}):n||i||console.warn("If you do not provide a visible label, you must specify an aria-label or aria-labelledby attribute for accessibility"),{labelProps:o,fieldProps:(0,R.b)({id:t,"aria-label":i,"aria-labelledby":n})}}(e),o=(0,B.mp)([!!t,!!r,n,i]),l=(0,B.mp)([!!t,!!r,n,i]);return{labelProps:a,fieldProps:s=(0,D.d)(s,{"aria-describedby":[o,l,e["aria-describedby"]].filter(Boolean).join(" ")||void 0}),descriptionProps:{id:o},errorMessageProps:{id:l}}}({...e,isInvalid:y,errorMessage:e.errorMessage||m}),x=(0,C.z)(e,{labelable:!0}),_={type:u,pattern:e.pattern};return r=(0,o.useRef)(h),n=(0,N.i)(()=>{p&&p(r.current)}),(0,o.useEffect)(()=>{var e;let r=null==t?void 0:null===(e=t.current)||void 0===e?void 0:e.form;return null==r||r.addEventListener("reset",n),()=>{null==r||r.removeEventListener("reset",n)}},[t,n]),!function(e,t,r){let{validationBehavior:n,focus:i}=e;(0,q.b)(()=>{if("native"===n&&(null==r?void 0:r.current)){var e;let n,i=t.realtimeValidation.isInvalid?t.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";r.current.setCustomValidity(i),r.current.hasAttribute("title")||(r.current.title=""),t.realtimeValidation.isInvalid||t.updateValidation({isInvalid:!(e=r.current).validity.valid,validationDetails:{badInput:(n=e.validity).badInput,customError:n.customError,patternMismatch:n.patternMismatch,rangeOverflow:n.rangeOverflow,rangeUnderflow:n.rangeUnderflow,stepMismatch:n.stepMismatch,tooLong:n.tooLong,tooShort:n.tooShort,typeMismatch:n.typeMismatch,valueMissing:n.valueMissing,valid:n.valid},validationErrors:e.validationMessage?[e.validationMessage]:[]})}});let a=(0,N.i)(()=>{t.resetValidation()}),s=(0,N.i)(e=>{var n,a;t.displayValidation.isInvalid||t.commitValidation();let s=null==r?void 0:null===(n=r.current)||void 0===n?void 0:n.form;!e.defaultPrevented&&r&&s&&function(e){for(let t=0;t<e.elements.length;t++){let r=e.elements[t];if(!r.validity.valid)return r}return null}(s)===r.current&&(i?i():null===(a=r.current)||void 0===a||a.focus(),(0,G._w)("keyboard")),e.preventDefault()}),l=(0,N.i)(()=>{t.commitValidation()});(0,o.useEffect)(()=>{let e=null==r?void 0:r.current;if(!e)return;let t=e.form;return e.addEventListener("invalid",s),e.addEventListener("change",l),null==t||t.addEventListener("reset",a),()=>{e.removeEventListener("invalid",s),e.removeEventListener("change",l),null==t||t.removeEventListener("reset",a)}},[r,s,l,a,n])}(e,f,t),(0,o.useEffect)(()=>{if(t.current instanceof(0,M.k)(t.current).HTMLTextAreaElement){let e=t.current;Object.defineProperty(e,"defaultValue",{get:()=>e.value,set:()=>{},configurable:!0})}},[t]),{labelProps:v,inputProps:(0,D.d)(x,"input"===i&&_,{disabled:a,readOnly:l,required:s&&"native"===c,"aria-required":s&&"aria"===c||void 0,"aria-invalid":y||void 0,"aria-errormessage":e["aria-errormessage"],"aria-activedescendant":e["aria-activedescendant"],"aria-autocomplete":e["aria-autocomplete"],"aria-haspopup":e["aria-haspopup"],value:h,onChange:e=>p(e.target.value),autoComplete:e.autoComplete,autoCapitalize:e.autoCapitalize,maxLength:e.maxLength,minLength:e.minLength,name:e.name,placeholder:e.placeholder,inputMode:e.inputMode,onCopy:e.onCopy,onCut:e.onCut,onPaste:e.onPaste,onCompositionEnd:e.onCompositionEnd,onCompositionStart:e.onCompositionStart,onCompositionUpdate:e.onCompositionUpdate,onSelect:e.onSelect,onBeforeInput:e.onBeforeInput,onInput:e.onInput,...d,...b}),descriptionProps:w,errorMessageProps:E,isInvalid:y,validationErrors:m,validationDetails:g}}({...e,validationBehavior:eu,autoCapitalize:e.autoCapitalize,value:eE,"aria-label":I(e["aria-label"],e.label,e.placeholder),inputElementType:eO?"textarea":"input",onChange:ex},eg);ek&&(delete eM.value,delete eM.onChange);let{isFocusVisible:eL,isFocused:eU,focusProps:eW}=(0,y.F)({autoFocus:en,isTextInput:!0}),{isHovered:ez,hoverProps:eG}=(0,w.X)({isDisabled:!!(null==e?void 0:e.isDisabled)}),{isHovered:eq,hoverProps:eF}=(0,w.X)({isDisabled:!!(null==e?void 0:e.isDisabled)}),{focusProps:eV,isFocusVisible:e$}=(0,y.F)(),{focusWithinProps:eJ}=function(e){let{isDisabled:t,onBlurWithin:r,onFocusWithin:n,onFocusWithinChange:i}=e,a=(0,o.useRef)({isFocusWithin:!1}),s=(0,o.useCallback)(e=>{a.current.isFocusWithin&&!e.currentTarget.contains(e.relatedTarget)&&(a.current.isFocusWithin=!1,r&&r(e),i&&i(!1))},[r,i,a]),l=(0,E.d)(s),u=(0,o.useCallback)(e=>{a.current.isFocusWithin||document.activeElement!==e.target||(n&&n(e),i&&i(!0),a.current.isFocusWithin=!0,l(e))},[n,i,l]);return t?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:u,onBlur:s}}}({onFocusWithinChange:ey}),{pressProps:eH}=(0,x.r)({isDisabled:!!(null==e?void 0:e.isDisabled)||!!(null==e?void 0:e.isReadOnly),onPress:eC}),eK="invalid"===el||e.isInvalid||eD,eY=(0,o.useMemo)(()=>{var t;if(ek){if(!e.labelPlacement)return"outside";if("inside"===e.labelPlacement)return!function(e,t,...r){var n;let i=`[Next UI] : ${e}`;"undefined"==typeof console||O[i]||(O[i]=!0,(null==(n=null==S?void 0:S.env)?void 0:n.NODE_ENV)==="production")||console.warn(i,r)}("Input with file type doesn't support inside label. Converting to outside ..."),"outside"}return e.labelPlacement&&"inside"!==e.labelPlacement||F?null!=(t=e.labelPlacement)?t:"inside":"outside"},[e.labelPlacement,F]),eX="function"==typeof h.errorMessage?h.errorMessage({isInvalid:eK,validationErrors:eT,validationDetails:eB}):h.errorMessage||(null==eT?void 0:eT.join(" ")),eQ=!!es||e.isClearable,eZ=!!F||!!ee||!!eX,e0=!!h.placeholder,e1=!!F,e2=!!ee||!!eX,e3="outside"===eY||"outside-left"===eY,e6="inside"===eY,e5=!!eg.current&&(!eg.current.value||""===eg.current.value||!eE||""===eE)&&e0,e8="outside-left"===eY,e4=!!ei,e9=!!e3&&("outside-left"===eY||e0||"outside"===eY&&e4),e7="outside"===eY&&!e0&&!e4,te=(0,o.useMemo)(()=>v({...p,isInvalid:eK,labelPlacement:eY,isClearable:eQ,disableAnimation:em}),[(0,l.Xx)(p),eK,eY,eQ,e4,em]),tt=(0,o.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{ref:ev,className:te.base({class:eA}),"data-slot":"base","data-filled":(0,_.PB)(eP||e0||e4||e5||ek),"data-filled-within":(0,_.PB)(eI||e0||e4||e5||ek),"data-focus-within":(0,_.PB)(ef),"data-focus-visible":(0,_.PB)(eL),"data-readonly":(0,_.PB)(e.isReadOnly),"data-focus":(0,_.PB)(eU),"data-hover":(0,_.PB)(ez||eq),"data-required":(0,_.PB)(e.isRequired),"data-invalid":(0,_.PB)(eK),"data-disabled":(0,_.PB)(e.isDisabled),"data-has-elements":(0,_.PB)(eZ),"data-has-helper":(0,_.PB)(e2),"data-has-label":(0,_.PB)(e1),"data-has-value":(0,_.PB)(!e5),"data-hidden":(0,_.PB)(eS),...eJ,...t}},[te,eA,eP,eU,ez,eq,eK,e2,e1,eZ,e5,e4,ef,eL,eI,e0,eJ,eS,e.isReadOnly,e.isRequired,e.isDisabled]),tr=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{"data-slot":"label",className:te.label({class:null==er?void 0:er.label}),...(0,k.d)(eN,eF,e)}},[te,eq,eN,null==er?void 0:er.label]),tn=(0,o.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{ref:eg,"data-slot":"input","data-filled":(0,_.PB)(eP),"data-filled-within":(0,_.PB)(eI),"data-has-start-content":(0,_.PB)(e4),"data-has-end-content":(0,_.PB)(!!ea),className:te.input({class:(0,P.W)(null==er?void 0:er.input,eP?"is-filled":"")}),...(0,k.d)(eW,eM,(0,b.z)(ep,{enabled:!0,labelable:!0,omitEventNames:new Set(Object.keys(eM))}),t),"aria-readonly":(0,_.PB)(e.isReadOnly),onChange:(0,A.t)(eM.onChange,eo)}},[te,eE,eW,eM,ep,eP,eI,e4,ea,null==er?void 0:er.input,e.isReadOnly,e.isRequired,eo]),ti=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{ref:eb,"data-slot":"input-wrapper","data-hover":(0,_.PB)(ez||eq),"data-focus-visible":(0,_.PB)(eL),"data-focus":(0,_.PB)(eU),className:te.inputWrapper({class:(0,P.W)(null==er?void 0:er.inputWrapper,eP?"is-filled":"")}),...(0,k.d)(e,eG),onClick:e=>{eg.current&&e.currentTarget===e.target&&eg.current.focus()},style:{cursor:"text",...e.style}}},[te,ez,eq,eL,eU,eE,null==er?void 0:er.inputWrapper]),ta=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...e,ref:ew,"data-slot":"inner-wrapper",onClick:e=>{eg.current&&e.currentTarget===e.target&&eg.current.focus()},className:te.innerWrapper({class:(0,P.W)(null==er?void 0:er.innerWrapper,null==e?void 0:e.className)})}},[te,null==er?void 0:er.innerWrapper]),ts=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...e,"data-slot":"main-wrapper",className:te.mainWrapper({class:(0,P.W)(null==er?void 0:er.mainWrapper,null==e?void 0:e.className)})}},[te,null==er?void 0:er.mainWrapper]),to=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...e,"data-slot":"helper-wrapper",className:te.helperWrapper({class:(0,P.W)(null==er?void 0:er.helperWrapper,null==e?void 0:e.className)})}},[te,null==er?void 0:er.helperWrapper]),tl=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...e,...eR,"data-slot":"description",className:te.description({class:(0,P.W)(null==er?void 0:er.description,null==e?void 0:e.className)})}},[te,null==er?void 0:er.description]),tu=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...e,...ej,"data-slot":"error-message",className:te.errorMessage({class:(0,P.W)(null==er?void 0:er.errorMessage,null==e?void 0:e.className)})}},[te,ej,null==er?void 0:er.errorMessage]),tc=(0,o.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...e,role:"button",tabIndex:0,"aria-label":"clear input","data-slot":"clear-button","data-focus-visible":(0,_.PB)(e$),className:te.clearButton({class:(0,P.W)(null==er?void 0:er.clearButton,null==e?void 0:e.className)}),...(0,k.d)(eH,eV)}},[te,e$,eH,eV,null==er?void 0:er.clearButton]);return{Component:m||"div",classNames:er,domRef:eg,label:F,description:ee,startContent:ei,endContent:ea,labelPlacement:eY,isClearable:eQ,hasHelper:e2,hasStartContent:e4,isLabelOutside:e9,isOutsideLeft:e8,isLabelOutsideAsPlaceholder:e7,shouldLabelBeOutside:e3,shouldLabelBeInside:e6,hasPlaceholder:e0,isInvalid:eK,errorMessage:eX,getBaseProps:tt,getLabelProps:tr,getInputProps:tn,getMainWrapperProps:ts,getInputWrapperProps:ti,getInnerWrapperProps:ta,getHelperWrapperProps:to,getDescriptionProps:tl,getErrorMessageProps:tu,getClearButtonProps:tc}}({...e,ref:t}),ep=n?(0,c.jsx)("label",{...en(),children:n}):null,ed=(0,o.useMemo)(()=>h?(0,c.jsx)("span",{...eh(),children:d||(0,c.jsx)(Q,{})}):d,[h,eh]),ef=(0,o.useMemo)(()=>g?(0,c.jsx)("div",{...el(),children:et&&ee?(0,c.jsx)("div",{...ec(),children:ee}):u?(0,c.jsx)("div",{...eu(),children:u}):null}):null,[g,et,ee,u,el,ec,eu]),ey=(0,o.useMemo)(()=>(0,c.jsxs)("div",{...ea(),children:[p,(0,c.jsx)("input",{...ei()}),ed]}),[p,ed,ei,ea]),em=(0,o.useMemo)(()=>Z?(0,c.jsxs)("div",{...eo(),children:[(0,c.jsxs)("div",{...es(),children:[F?null:ep,ey]}),ef]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{...es(),children:[ep,ey]}),ef]}),[m,ef,Z,ep,ey,ee,u,eo,es,ec,eu]);return(0,c.jsxs)(r,{...er(),children:[F?ep:null,em]})});Z.displayName="NextUI.Input";var ee=Z},6380:function(e,t,r){"use strict";r.d(t,{w:function(){return _}});var n=r(5501);let i=new Set(["Arab","Syrc","Samr","Mand","Thaa","Mend","Nkoo","Adlm","Rohg","Hebr"]),a=new Set(["ae","ar","arc","bcc","bqi","ckb","dv","fa","glk","he","ku","mzn","nqo","pnb","ps","sd","ug","ur","yi"]);function s(e){if(Intl.Locale){let t=new Intl.Locale(e).maximize(),r="function"==typeof t.getTextInfo?t.getTextInfo():t.textInfo;if(r)return"rtl"===r.direction;if(t.script)return i.has(t.script)}let t=e.split("-")[0];return a.has(t)}var o=r(1527),l=r(5445);let u=Symbol.for("react-aria.i18n.locale");function c(){let e="undefined"!=typeof window&&window[u]||"undefined"!=typeof navigator&&(navigator.language||navigator.userLanguage)||"en-US";try{Intl.DateTimeFormat.supportedLocalesOf([e])}catch(t){e="en-US"}return{locale:e,direction:s(e)?"rtl":"ltr"}}let h=c(),p=new Set;function d(){for(let e of(h=c(),p))e(h)}let f=o.createContext(null);function y(e){let{locale:t,children:r}=e,n=function(){let e=(0,l.Av)(),[t,r]=(0,o.useState)(h);return((0,o.useEffect)(()=>(0===p.size&&window.addEventListener("languagechange",d),p.add(r),()=>{p.delete(r),0===p.size&&window.removeEventListener("languagechange",d)}),[]),e)?{locale:"en-US",direction:"ltr"}:t}(),i=o.useMemo(()=>t?{locale:t,direction:s(t)?"rtl":"ltr"}:n,[n,t]);return o.createElement(f.Provider,{value:i},r)}var m=r(3890);r(3219);let g=o.createContext(null);function v(e){let{children:t}=e,r=(0,o.useContext)(g),[n,i]=(0,o.useState)(0),a=(0,o.useMemo)(()=>({parent:r,modalCount:n,addModal(){i(e=>e+1),r&&r.addModal()},removeModal(){i(e=>e-1),r&&r.removeModal()}}),[r,n]);return o.createElement(g.Provider,{value:a},t)}function b(e){let t;let{modalProviderProps:r}={modalProviderProps:{"aria-hidden":!!(t=(0,o.useContext)(g))&&t.modalCount>0||null}};return o.createElement("div",{"data-overlay-container":!0,...e,...r})}function w(e){return o.createElement(v,null,o.createElement(b,e))}var E=r(6932),x=r(244),_=e=>{let{children:t,navigate:r,useHref:i,disableAnimation:a=!1,disableRipple:s=!1,skipFramerMotionAnimations:l=a,validationBehavior:u="aria",locale:c="en-US",defaultDates:h,createCalendar:p,...d}=e,f=t;r&&(f=(0,x.jsx)(m.pG,{navigate:r,useHref:i,children:f}));let g=(0,o.useMemo)(()=>(a&&l&&(E.c.skipAnimations=!0),{createCalendar:p,defaultDates:h,disableAnimation:a,disableRipple:s,validationBehavior:u}),[p,null==h?void 0:h.maxDate,null==h?void 0:h.minDate,a,s,u]);return(0,x.jsx)(n.a,{value:g,children:(0,x.jsx)(y,{locale:c,children:(0,x.jsx)(w,{...d,children:f})})})}}}]);