(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[468],{1974:function(t,e){"use strict";e.byteLength=function(t){var e=c(t),r=e[0],n=e[1];return(r+n)*3/4-n},e.toByteArray=function(t){var e,r,s=c(t),a=s[0],o=s[1],l=new i((a+o)*3/4-o),u=0,h=o>0?a-4:a;for(r=0;r<h;r+=4)e=n[t.charCodeAt(r)]<<18|n[t.charCodeAt(r+1)]<<12|n[t.charCodeAt(r+2)]<<6|n[t.charCodeAt(r+3)],l[u++]=e>>16&255,l[u++]=e>>8&255,l[u++]=255&e;return 2===o&&(e=n[t.charCodeAt(r)]<<2|n[t.charCodeAt(r+1)]>>4,l[u++]=255&e),1===o&&(e=n[t.charCodeAt(r)]<<10|n[t.charCodeAt(r+1)]<<4|n[t.charCodeAt(r+2)]>>2,l[u++]=e>>8&255,l[u++]=255&e),l},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,s=[],a=0,o=n-i;a<o;a+=16383)s.push(function(t,e,n){for(var i,s=[],a=e;a<n;a+=3)s.push(r[(i=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]))>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}(t,a,a+16383>o?o:a+16383));return 1===i?s.push(r[(e=t[n-1])>>2]+r[e<<4&63]+"=="):2===i&&s.push(r[(e=(t[n-2]<<8)+t[n-1])>>10]+r[e>>4&63]+r[e<<2&63]+"="),s.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)r[a]=s[a],n[s.charCodeAt(a)]=a;function c(t){var e=t.length;if(e%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");-1===r&&(r=e);var n=r===e?0:4-r%4;return[r,n]}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},7468:function(t,e,r){"use strict";let n,i;r.d(e,{K:function(){return nu}});var s,a,o,c,l,u,h,p,f,d,y,g,m,v,b={};r.r(b),r.d(b,{Decoder:function(){return r8},Encoder:function(){return r1},PacketType:function(){return m},protocol:function(){return r0}}),r(5385);var w=r(8074);let E=(t=21)=>{let e="",r=t;for(;r--;)e+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return e};function _(t){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function P(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?O(Object(r),!0).forEach(function(e){!function(t,e,r){var n;(n=function(t,e){if("object"!=_(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=_(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(e,"string"),(e="symbol"==_(n)?n:n+"")in t)?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function I(t){return"Minified Redux error #"+t+"; visit https://redux.js.org/Errors?code="+t+" for the full message or use the non-minified dev environment for full errors. "}var S="function"==typeof Symbol&&Symbol.observable||"@@observable",A=function(){return Math.random().toString(36).substring(7).split("").join(".")},k={INIT:"@@redux/INIT"+A(),REPLACE:"@@redux/REPLACE"+A(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+A()}};function x(t,e,r){if("function"==typeof e&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw Error(I(0));if("function"==typeof e&&void 0===r&&(r=e,e=void 0),void 0!==r){if("function"!=typeof r)throw Error(I(1));return r(x)(t,e)}if("function"!=typeof t)throw Error(I(2));var n,i=t,s=e,a=[],o=a,c=!1;function l(){o===a&&(o=a.slice())}function u(){if(c)throw Error(I(3));return s}function h(t){if("function"!=typeof t)throw Error(I(4));if(c)throw Error(I(5));var e=!0;return l(),o.push(t),function(){if(e){if(c)throw Error(I(6));e=!1,l();var r=o.indexOf(t);o.splice(r,1),a=null}}}function p(t){if(!function(t){if("object"!=typeof t||null===t)return!1;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}(t))throw Error(I(7));if(void 0===t.type)throw Error(I(8));if(c)throw Error(I(9));try{c=!0,s=i(s,t)}finally{c=!1}for(var e=a=o,r=0;r<e.length;r++)(0,e[r])();return t}return p({type:k.INIT}),(n={dispatch:p,subscribe:h,getState:u,replaceReducer:function(t){if("function"!=typeof t)throw Error(I(10));i=t,p({type:k.REPLACE})}})[S]=function(){var t;return(t={subscribe:function(t){if("object"!=typeof t||null===t)throw Error(I(11));function e(){t.next&&t.next(u())}return e(),{unsubscribe:h(e)}}})[S]=function(){return this},t},n}function C(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return 0===e.length?function(t){return t}:1===e.length?e[0]:e.reduce(function(t,e){return function(){return t(e.apply(void 0,arguments))}})}function N(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(t){return function(){var r=t.apply(void 0,arguments),n=function(){throw Error(I(15))},i={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},s=e.map(function(t){return t(i)});return n=C.apply(void 0,s)(r.dispatch),P(P({},r),{},{dispatch:n})}}}function D(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+t+(r.length?" "+r.map(function(t){return"'"+t+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function T(t){return!!t&&!!t[tg]}function M(t){var e;return!!t&&(function(t){if(!t||"object"!=typeof t)return!1;var e=Object.getPrototypeOf(t);if(null===e)return!0;var r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===tm}(t)||Array.isArray(t)||!!t[ty]||!!(null===(e=t.constructor)||void 0===e?void 0:e[ty])||U(t)||G(t))}function B(t,e,r){void 0===r&&(r=!1),0===R(t)?(r?Object.keys:tv)(t).forEach(function(n){r&&"symbol"==typeof n||e(n,t[n],t)}):t.forEach(function(r,n){return e(n,r,t)})}function R(t){var e=t[tg];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:U(t)?2:G(t)?3:0}function j(t,e){return 2===R(t)?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function L(t,e,r){var n=R(t);2===n?t.set(e,r):3===n?t.add(r):t[e]=r}function U(t){return th&&t instanceof Map}function G(t){return tp&&t instanceof Set}function q(t){return t.o||t.t}function F(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=tb(t);delete e[tg];for(var r=tv(e),n=0;n<r.length;n++){var i=r[n],s=e[i];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(e[i]={configurable:!0,writable:!0,enumerable:s.enumerable,value:t[i]})}return Object.create(Object.getPrototypeOf(t),e)}function $(t,e){return void 0===e&&(e=!1),J(t)||T(t)||!M(t)||(R(t)>1&&(t.set=t.add=t.clear=t.delete=V),Object.freeze(t),e&&B(t,function(t,e){return $(e,!0)},!0)),t}function V(){D(2)}function J(t){return null==t||"object"!=typeof t||Object.isFrozen(t)}function z(t){var e=tw[t];return e||D(18,t),e}function W(t,e){e&&(z("Patches"),t.u=[],t.s=[],t.v=e)}function H(t){K(t),t.p.forEach(X),t.p=null}function K(t){t===tl&&(tl=t.l)}function Y(t){return tl={p:[],l:tl,h:t,m:!0,_:0}}function X(t){var e=t[tg];0===e.i||1===e.i?e.j():e.g=!0}function Q(t,e){e._=e.p.length;var r=e.p[0],n=void 0!==t&&t!==r;return e.h.O||z("ES5").S(e,t,n),n?(r[tg].P&&(H(e),D(4)),M(t)&&(t=Z(e,t),e.l||te(e,t)),e.u&&z("Patches").M(r[tg].t,t,e.u,e.s)):t=Z(e,r,[]),H(e),e.u&&e.v(e.u,e.s),t!==td?t:void 0}function Z(t,e,r){if(J(e))return e;var n=e[tg];if(!n)return B(e,function(i,s){return tt(t,n,e,i,s,r)},!0),e;if(n.A!==t)return e;if(!n.P)return te(t,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=4===n.i||5===n.i?n.o=F(n.k):n.o,s=i,a=!1;3===n.i&&(s=new Set(i),i.clear(),a=!0),B(s,function(e,s){return tt(t,n,i,e,s,r,a)}),te(t,i,!1),r&&t.u&&z("Patches").N(n,r,t.u,t.s)}return n.o}function tt(t,e,r,n,i,s,a){if(T(i)){var o=Z(t,i,s&&e&&3!==e.i&&!j(e.R,n)?s.concat(n):void 0);if(L(r,n,o),!T(o))return;t.m=!1}else a&&r.add(i);if(M(i)&&!J(i)){if(!t.h.D&&t._<1)return;Z(t,i),e&&e.A.l||te(t,i)}}function te(t,e,r){void 0===r&&(r=!1),!t.l&&t.h.D&&t.m&&$(e,r)}function tr(t,e){var r=t[tg];return(r?q(r):t)[e]}function tn(t,e){if(e in t)for(var r=Object.getPrototypeOf(t);r;){var n=Object.getOwnPropertyDescriptor(r,e);if(n)return n;r=Object.getPrototypeOf(r)}}function ti(t){t.P||(t.P=!0,t.l&&ti(t.l))}function ts(t){t.o||(t.o=F(t.t))}function ta(t,e,r){var n,i,s,a,o,c,l,u=U(e)?z("MapSet").F(e,r):G(e)?z("MapSet").T(e,r):t.O?(s=i={i:(n=Array.isArray(e))?1:0,A:r?r.A:tl,P:!1,I:!1,R:{},l:r,t:e,k:null,o:null,j:null,C:!1},a=tE,n&&(s=[i],a=t_),c=(o=Proxy.revocable(s,a)).revoke,l=o.proxy,i.k=l,i.j=c,l):z("ES5").J(e,r);return(r?r.A:tl).p.push(u),u}function to(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return F(t)}var tc,tl,tu="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),th="undefined"!=typeof Map,tp="undefined"!=typeof Set,tf="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,td=tu?Symbol.for("immer-nothing"):((tc={})["immer-nothing"]=!0,tc),ty=tu?Symbol.for("immer-draftable"):"__$immer_draftable",tg=tu?Symbol.for("immer-state"):"__$immer_state",tm=""+Object.prototype.constructor,tv="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,tb=Object.getOwnPropertyDescriptors||function(t){var e={};return tv(t).forEach(function(r){e[r]=Object.getOwnPropertyDescriptor(t,r)}),e},tw={},tE={get:function(t,e){if(e===tg)return t;var r,n,i=q(t);if(!j(i,e))return(n=tn(i,e))?"value"in n?n.value:null===(r=n.get)||void 0===r?void 0:r.call(t.k):void 0;var s=i[e];return t.I||!M(s)?s:s===tr(t.t,e)?(ts(t),t.o[e]=ta(t.A.h,s,t)):s},has:function(t,e){return e in q(t)},ownKeys:function(t){return Reflect.ownKeys(q(t))},set:function(t,e,r){var n=tn(q(t),e);if(null==n?void 0:n.set)return n.set.call(t.k,r),!0;if(!t.P){var i=tr(q(t),e),s=null==i?void 0:i[tg];if(s&&s.t===r)return t.o[e]=r,t.R[e]=!1,!0;if((r===i?0!==r||1/r==1/i:r!=r&&i!=i)&&(void 0!==r||j(t.t,e)))return!0;ts(t),ti(t)}return t.o[e]===r&&(void 0!==r||e in t.o)||Number.isNaN(r)&&Number.isNaN(t.o[e])||(t.o[e]=r,t.R[e]=!0),!0},deleteProperty:function(t,e){return void 0!==tr(t.t,e)||e in t.t?(t.R[e]=!1,ts(t),ti(t)):delete t.R[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var r=q(t),n=Reflect.getOwnPropertyDescriptor(r,e);return n?{writable:!0,configurable:1!==t.i||"length"!==e,enumerable:n.enumerable,value:r[e]}:n},defineProperty:function(){D(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){D(12)}},t_={};B(tE,function(t,e){t_[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),t_.deleteProperty=function(t,e){return t_.set.call(this,t,e,void 0)},t_.set=function(t,e,r){return tE.set.call(this,t[0],e,r,t[0])};var tO=new(function(){function t(t){var e=this;this.O=tf,this.D=!0,this.produce=function(t,r,n){if("function"==typeof t&&"function"!=typeof r){var i,s=r;return r=t,function(t){var n=this;void 0===t&&(t=s);for(var i=arguments.length,a=Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return e.produce(t,function(t){var e;return(e=r).call.apply(e,[n,t].concat(a))})}}if("function"!=typeof r&&D(6),void 0!==n&&"function"!=typeof n&&D(7),M(t)){var a=Y(e),o=ta(e,t,void 0),c=!0;try{i=r(o),c=!1}finally{c?H(a):K(a)}return"undefined"!=typeof Promise&&i instanceof Promise?i.then(function(t){return W(a,n),Q(t,a)},function(t){throw H(a),t}):(W(a,n),Q(i,a))}if(!t||"object"!=typeof t){if(void 0===(i=r(t))&&(i=t),i===td&&(i=void 0),e.D&&$(i,!0),n){var l=[],u=[];z("Patches").M(t,i,l,u),n(l,u)}return i}D(21,t)},this.produceWithPatches=function(t,r){if("function"==typeof t)return function(r){for(var n=arguments.length,i=Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return e.produceWithPatches(r,function(e){return t.apply(void 0,[e].concat(i))})};var n,i,s=e.produce(t,r,function(t,e){n=t,i=e});return"undefined"!=typeof Promise&&s instanceof Promise?s.then(function(t){return[t,n,i]}):[s,n,i]},"boolean"==typeof(null==t?void 0:t.useProxies)&&this.setUseProxies(t.useProxies),"boolean"==typeof(null==t?void 0:t.autoFreeze)&&this.setAutoFreeze(t.autoFreeze)}var e=t.prototype;return e.createDraft=function(t){M(t)||D(8),T(t)&&(T(e=t)||D(22,e),t=function t(e){if(!M(e))return e;var r,n=e[tg],i=R(e);if(n){if(!n.P&&(n.i<4||!z("ES5").K(n)))return n.t;n.I=!0,r=to(e,i),n.I=!1}else r=to(e,i);return B(r,function(e,i){var s;n&&(2===R(s=n.t)?s.get(e):s[e])===i||L(r,e,t(i))}),3===i?new Set(r):r}(e));var e,r=Y(this),n=ta(this,t,void 0);return n[tg].C=!0,K(r),n},e.finishDraft=function(t,e){var r=(t&&t[tg]).A;return W(r,e),Q(void 0,r)},e.setAutoFreeze=function(t){this.D=t},e.setUseProxies=function(t){t&&!tf&&D(20),this.O=t},e.applyPatches=function(t,e){for(r=e.length-1;r>=0;r--){var r,n=e[r];if(0===n.path.length&&"replace"===n.op){t=n.value;break}}r>-1&&(e=e.slice(r+1));var i=z("Patches").$;return T(t)?i(t,e):this.produce(t,function(t){return i(t,e)})},t}()),tP=tO.produce;tO.produceWithPatches.bind(tO),tO.setAutoFreeze.bind(tO),tO.setUseProxies.bind(tO),tO.applyPatches.bind(tO),tO.createDraft.bind(tO),tO.finishDraft.bind(tO);class tI{constructor(t){let e;let r=(e=4022871197,function(t){let r=t.toString();for(let t=0;t<r.length;t++){let n=.02519603282416938*(e+=r.charCodeAt(t));e=n>>>0,n-=e,n*=e,e=n>>>0,n-=e,e+=4294967296*n}return(e>>>0)*23283064365386963e-26});this.c=1,this.s0=r(" "),this.s1=r(" "),this.s2=r(" "),this.s0-=r(t),this.s0<0&&(this.s0+=1),this.s1-=r(t),this.s1<0&&(this.s1+=1),this.s2-=r(t),this.s2<0&&(this.s2+=1)}next(){let t=2091639*this.s0+23283064365386963e-26*this.c;return this.s0=this.s1,this.s1=this.s2,this.s2=t-(this.c=Math.trunc(t))}}function tS(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function tA(t,e){let r=new tI(t),n=r.next.bind(r);return e&&tS(e,r),n.state=()=>tS(r,{}),n}class tk{constructor(t){this.state=t||{seed:"0"},this.used=!1}static seed(){return Date.now().toString(36).slice(-10)}isUsed(){return this.used}getState(){return this.state}_random(){this.used=!0;let t=this.state,e=tA(t.prngstate?"":t.seed,t.prngstate),r=e();return this.state={...t,prngstate:e.state()},r}api(){let t=this._random.bind(this),e={D4:4,D6:6,D8:8,D10:10,D12:12,D20:20},r={};for(let n in e){let i=e[n];r[n]=e=>void 0===e?Math.floor(t()*i)+1:Array.from({length:e}).map(()=>Math.floor(t()*i)+1)}return{...r,Die:function(e=6,r){return void 0===r?Math.floor(t()*e)+1:Array.from({length:r}).map(()=>Math.floor(t()*e)+1)},Number:()=>t(),Shuffle:e=>{let r=[...e],n=e.length,i=0,s=Array.from({length:n});for(;n;){let e=Math.trunc(n*t());s[i++]=r[e],r[e]=r[--n]}return s},_private:this}}}let tx="MAKE_MOVE",tC="GAME_EVENT",tN="REDO",tD="RESET",tT="SYNC",tM="UNDO",tB="UPDATE",tR="PATCH",tj="PLUGIN",tL="STRIP_TRANSIENTS",tU=(t,e,r,n)=>({type:tx,payload:{type:t,args:e,playerID:r,credentials:n}}),tG=(t,e,r,n)=>({type:tC,payload:{type:t,args:e,playerID:r,credentials:n}}),tq=(t,e,r,n)=>({type:tC,payload:{type:t,args:e,playerID:r,credentials:n},automatic:!0}),tF=t=>({type:tT,state:t.state,log:t.log,initialState:t.initialState,clientOnly:!0}),t$=(t,e,r,n)=>({type:tR,prevStateID:t,stateID:e,patch:r,deltalog:n,clientOnly:!0}),tV=(t,e)=>({type:tB,state:t,deltalog:e,clientOnly:!0}),tJ=t=>({type:tD,state:t,clientOnly:!0}),tz=(t,e)=>({type:tM,payload:{type:null,args:null,playerID:t,credentials:e}}),tW=(t,e)=>({type:tN,payload:{type:null,args:null,playerID:t,credentials:e}}),tH=()=>({type:tL});var tK=Object.freeze({__proto__:null,makeMove:tU,gameEvent:tG,automaticGameEvent:tq,sync:tF,patch:t$,update:tV,reset:tJ,undo:tz,redo:tW,plugin:(t,e,r,n)=>({type:tj,payload:{type:t,args:e,playerID:r,credentials:n}}),stripTransients:tH});let tY="INVALID_MOVE";(s=p||(p={})).MOVE="MOVE",s.GAME_ON_END="GAME_ON_END",s.PHASE_ON_BEGIN="PHASE_ON_BEGIN",s.PHASE_ON_END="PHASE_ON_END",s.TURN_ON_BEGIN="TURN_ON_BEGIN",s.TURN_ON_MOVE="TURN_ON_MOVE",s.TURN_ON_END="TURN_ON_END",(a=f||(f={})).CalledOutsideHook="Events must be called from moves or the `onBegin`, `onEnd`, and `onMove` hooks.\nThis error probably means you called an event from other game code, like an `endIf` trigger or one of the `turn.order` methods.",a.EndTurnInOnEnd="`endTurn` is disallowed in `onEnd` hooks — the turn is already ending.",a.MaxTurnEndings="Maximum number of turn endings exceeded for this update.\nThis likely means game code is triggering an infinite loop.",a.PhaseEventInOnEnd="`setPhase` & `endPhase` are disallowed in a phase’s `onEnd` hook — the phase is already ending.\nIf you’re trying to dynamically choose the next phase when a phase ends, use the phase’s `next` trigger.",a.StageEventInOnEnd="`setStage`, `endStage` & `setActivePlayers` are disallowed in `onEnd` hooks.",a.StageEventInPhaseBegin="`setStage`, `endStage` & `setActivePlayers` are disallowed in a phase’s `onBegin` hook.\nUse `setActivePlayers` in a `turn.onBegin` hook or declare stages with `turn.activePlayers` instead.",a.StageEventInTurnBegin="`setStage` & `endStage` are disallowed in `turn.onBegin`.\nUse `setActivePlayers` or declare stages with `turn.activePlayers` instead.";class tX{constructor(t,e,r){this.flow=t,this.playerID=r,this.dispatch=[],this.initialTurn=e.turn,this.updateTurnContext(e,void 0),this.maxEndedTurnsPerAction=100*e.numPlayers}api(){let t={_private:this};for(let e of this.flow.eventNames)t[e]=(...t)=>{this.dispatch.push({type:e,args:t,phase:this.currentPhase,turn:this.currentTurn,calledFrom:this.currentMethod,error:Error("Events Plugin Error")})};return t}isUsed(){return this.dispatch.length>0}updateTurnContext(t,e){this.currentPhase=t.phase,this.currentTurn=t.turn,this.currentMethod=e}unsetCurrentMethod(){this.currentMethod=void 0}update(t){let e=t,r=({stack:t},r)=>({...e,plugins:{...e.plugins,events:{...e.plugins.events,data:{error:r+"\n"+t}}}});for(let e=0;e<this.dispatch.length;e++){let n=this.dispatch[e],i=n.turn!==t.ctx.turn;if(this.currentTurn-this.initialTurn>=this.maxEndedTurnsPerAction)return r(n.error,f.MaxTurnEndings);if(void 0===n.calledFrom)return r(n.error,f.CalledOutsideHook);if(t.ctx.gameover)break;switch(n.type){case"endStage":case"setStage":case"setActivePlayers":switch(n.calledFrom){case p.TURN_ON_END:case p.PHASE_ON_END:return r(n.error,f.StageEventInOnEnd);case p.PHASE_ON_BEGIN:return r(n.error,f.StageEventInPhaseBegin);case p.TURN_ON_BEGIN:if("setActivePlayers"===n.type)break;return r(n.error,f.StageEventInTurnBegin)}if(i)continue;break;case"endTurn":if(n.calledFrom===p.TURN_ON_END||n.calledFrom===p.PHASE_ON_END)return r(n.error,f.EndTurnInOnEnd);if(i)continue;break;case"endPhase":case"setPhase":if(n.calledFrom===p.PHASE_ON_END)return r(n.error,f.PhaseEventInOnEnd);if(n.phase!==t.ctx.phase)continue}let s=tq(n.type,n.args,this.playerID);t=this.flow.processEvent(t,s)}return t}}let tQ={name:"events",noClient:({api:t})=>t._private.isUsed(),isInvalid:({data:t})=>t.error||!1,fnWrap:(t,e)=>(r,...n)=>{let i=r.events;i&&i._private.updateTurnContext(r.ctx,e);let s=t(r,...n);return i&&i._private.unsetCurrentMethod(),s},dangerouslyFlushRawState:({state:t,api:e})=>e._private.update(t),api:({game:t,ctx:e,playerID:r})=>new tX(t.flow,e,r).api()},tZ=()=>{},t0=(...t)=>console.error(...t);function t1(t){tZ(`INFO: ${t}`)}function t2(t){t0("ERROR:",t)}let t8=[{name:"plugin-immer",fnWrap:t=>(e,...r)=>{let n=!1,i=tP(e.G,i=>{let s=t({...e,G:i},...r);if(s===tY){n=!0;return}return s});return n?tY:i}},{name:"random",noClient:({api:t})=>t._private.isUsed(),flush:({api:t})=>t._private.getState(),api:({data:t})=>new tk(t).api(),setup:({game:t})=>{let{seed:e}=t;return void 0===e&&(e=tk.seed()),{seed:e}},playerView:()=>void 0},{name:"log",flush:()=>({}),api:({data:t})=>({setMetadata:e=>{t.metadata=e}}),setup:()=>({})},{name:"plugin-serializable",fnWrap:t=>(e,...r)=>t(e,...r)}],t6=[...t8,tQ],t3=(t,e,r)=>(r.game.plugins.filter(t=>void 0!==t.action).filter(t=>t.name===e.payload.type).forEach(r=>{let n=r.name,i=t.plugins[n]||{data:{}},s=r.action(i.data,e.payload);t={...t,plugins:{...t.plugins,[n]:{...i,data:s}}}}),t),t4=({plugins:t})=>Object.entries(t||{}).reduce((t,[e,{api:r}])=>(t[e]=r,t),{}),t5=(t,e,r)=>[...t8,...r,tQ].filter(t=>void 0!==t.fnWrap).reduce((t,{fnWrap:r})=>r(t,e),t),t9=(t,e)=>([...t6,...e.game.plugins].filter(t=>void 0!==t.setup).forEach(r=>{let n=r.name,i=r.setup({G:t.G,ctx:t.ctx,game:e.game});t={...t,plugins:{...t.plugins,[n]:{data:i}}}}),t),t7=(t,e)=>([...t6,...e.game.plugins].filter(t=>void 0!==t.api).forEach(r=>{let n=r.name,i=t.plugins[n]||{data:{}},s=r.api({G:t.G,ctx:t.ctx,data:i.data,game:e.game,playerID:e.playerID});t={...t,plugins:{...t.plugins,[n]:{...i,api:s}}}}),t),et=(t,e)=>([...t8,...e.game.plugins,tQ].reverse().forEach(r=>{let n=r.name,i=t.plugins[n]||{data:{}};if(r.flush){let n=r.flush({G:t.G,ctx:t.ctx,game:e.game,api:i.api,data:i.data});t={...t,plugins:{...t.plugins,[r.name]:{data:n}}}}else if(r.dangerouslyFlushRawState){let s=(t=r.dangerouslyFlushRawState({state:t,game:e.game,api:i.api,data:i.data})).plugins[n].data;t={...t,plugins:{...t.plugins,[r.name]:{data:s}}}}}),t),ee=(t,e)=>[...t6,...e.game.plugins].filter(t=>void 0!==t.noClient).map(r=>{let n=r.name,i=t.plugins[n];return!!i&&r.noClient({G:t.G,ctx:t.ctx,game:e.game,api:i.api,data:i.data})}).includes(!0),er=(t,e)=>[...t6,...e.game.plugins].filter(t=>void 0!==t.isInvalid).map(r=>{let{name:n}=r,i=t.plugins[n],s=r.isInvalid({G:t.G,ctx:t.ctx,game:e.game,data:i&&i.data});return!!s&&{plugin:n,message:s}}).find(t=>t)||!1,en=(t,e)=>{let r=et(t,e),n=er(r,e);if(!n)return[r];let{plugin:i,message:s}=n;return t2(`${i} plugin declared action invalid:
${s}`),[t,n]},ei=({G:t,ctx:e,plugins:r={}},{game:n,playerID:i})=>([...t6,...n.plugins].forEach(({name:s,playerView:a})=>{if(!a)return;let{data:o}=r[s]||{data:{}},c=a({G:t,ctx:e,game:n,data:o,playerID:i});r={...r,[s]:{data:c}}}),r);function es(t,e=!1){t.moveLimit&&(e&&(t.minMoves=t.moveLimit),t.maxMoves=t.moveLimit,delete t.moveLimit)}function ea(t,e){let r={},n=[],i=null,s={},a={};if(Array.isArray(e)){let t={};e.forEach(e=>t[e]=el.NULL),r=t}else{if(es(e),e.next&&(i=e.next),e.revert&&(n=[...t._prevActivePlayers,{activePlayers:t.activePlayers,_activePlayersMinMoves:t._activePlayersMinMoves,_activePlayersMaxMoves:t._activePlayersMaxMoves,_activePlayersNumMoves:t._activePlayersNumMoves}]),void 0!==e.currentPlayer&&eo(r,s,a,t.currentPlayer,e.currentPlayer),void 0!==e.others)for(let n=0;n<t.playOrder.length;n++){let i=t.playOrder[n];i!==t.currentPlayer&&eo(r,s,a,i,e.others)}if(void 0!==e.all)for(let n=0;n<t.playOrder.length;n++)eo(r,s,a,t.playOrder[n],e.all);if(e.value)for(let t in e.value)eo(r,s,a,t,e.value[t]);if(e.minMoves)for(let t in r)void 0===s[t]&&(s[t]=e.minMoves);if(e.maxMoves)for(let t in r)void 0===a[t]&&(a[t]=e.maxMoves)}0===Object.keys(r).length&&(r=null),0===Object.keys(s).length&&(s=null),0===Object.keys(a).length&&(a=null);let o={};for(let t in r)o[t]=0;return{...t,activePlayers:r,_activePlayersMinMoves:s,_activePlayersMaxMoves:a,_activePlayersNumMoves:o,_prevActivePlayers:n,_nextActivePlayers:i}}function eo(t,e,r,n,i){("object"!=typeof i||i===el.NULL)&&(i={stage:i}),void 0!==i.stage&&(es(i),t[n]=i.stage,i.minMoves&&(e[n]=i.minMoves),i.maxMoves&&(r[n]=i.maxMoves))}let ec={DEFAULT:{first:({ctx:t})=>0===t.turn?t.playOrderPos:(t.playOrderPos+1)%t.playOrder.length,next:({ctx:t})=>(t.playOrderPos+1)%t.playOrder.length}},el={NULL:null};function eu(t){if(void 0!==t.processMove)return t;if(void 0===t.name&&(t.name="default"),void 0===t.deltaState&&(t.deltaState=!1),void 0===t.disableUndo&&(t.disableUndo=!1),void 0===t.setup&&(t.setup=()=>({})),void 0===t.moves&&(t.moves={}),void 0===t.playerView&&(t.playerView=({G:t})=>t),void 0===t.plugins&&(t.plugins=[]),t.plugins.forEach(t=>{if(void 0===t.name)throw Error("Plugin missing name attribute");if(t.name.includes(" "))throw Error(t.name+": Plugin name must not include spaces")}),t.name.includes(" "))throw Error(t.name+": Game name must not include spaces");let e=function({moves:t,phases:e,endIf:r,onEnd:n,turn:i,events:s,plugins:a}){void 0===t&&(t={}),void 0===s&&(s={}),void 0===a&&(a=[]),void 0===e&&(e={}),r||(r=()=>void 0),n||(n=({G:t})=>t),i||(i={});let o={...e};""in o&&t2("cannot specify phase with empty name"),o[""]={};let c={},l=new Set,u=null;Object.keys(t).forEach(t=>l.add(t));let h=(t,e)=>{let r=t5(t,e,a);return t=>r({...t4(t),G:t.G,ctx:t.ctx,playerID:t.playerID})},f=t=>e=>t({...t4(e),G:e.G,ctx:e.ctx}),d={onEnd:h(n,p.GAME_ON_END),endIf:f(r)};for(let t in o){let e=o[t];if(!0===e.start&&(u=t),void 0!==e.moves)for(let r of Object.keys(e.moves))c[t+"."+r]=e.moves[r],l.add(r);for(let r in void 0===e.endIf&&(e.endIf=()=>void 0),void 0===e.onBegin&&(e.onBegin=({G:t})=>t),void 0===e.onEnd&&(e.onEnd=({G:t})=>t),void 0===e.turn&&(e.turn=i),void 0===e.turn.order&&(e.turn.order=ec.DEFAULT),void 0===e.turn.onBegin&&(e.turn.onBegin=({G:t})=>t),void 0===e.turn.onEnd&&(e.turn.onEnd=({G:t})=>t),void 0===e.turn.endIf&&(e.turn.endIf=()=>!1),void 0===e.turn.onMove&&(e.turn.onMove=({G:t})=>t),void 0===e.turn.stages&&(e.turn.stages={}),es(e.turn,!0),e.turn.stages){let n=e.turn.stages[r].moves||{};for(let e of Object.keys(n))c[t+"."+r+"."+e]=n[e],l.add(e)}if(e.wrapped={onBegin:h(e.onBegin,p.PHASE_ON_BEGIN),onEnd:h(e.onEnd,p.PHASE_ON_END),endIf:f(e.endIf)},e.turn.wrapped={onMove:h(e.turn.onMove,p.TURN_ON_MOVE),onBegin:h(e.turn.onBegin,p.TURN_ON_BEGIN),onEnd:h(e.turn.onEnd,p.TURN_ON_END),endIf:f(e.turn.endIf)},"function"!=typeof e.next){let{next:t}=e;e.next=()=>t||null}e.wrapped.next=f(e.next)}function y(t){return t.phase?o[t.phase]:o[""]}function g(t){return t}function m(t,e){let r=new Set,n=new Set;for(let a=0;a<e.length;a++){var i,s;let{fn:o,arg:c,...l}=e[a];if(o===S){n.clear();let e=t.ctx.phase;if(r.has(e)){let e={...t.ctx,phase:null};return{...t,ctx:e}}r.add(e)}let u=[];if(t=o(t,{...l,arg:c,next:u}),o===I)break;let h=(i=t,d.endIf(i));if(h){e.push({fn:I,arg:h,turn:t.ctx.turn,phase:t.ctx.phase,automatic:!0});continue}let p=y((s=t).ctx).wrapped.endIf(s);if(p){e.push({fn:S,arg:p,turn:t.ctx.turn,phase:t.ctx.phase,automatic:!0});continue}if([g,O,P].includes(o)){let r=function(t){let e=y(t.ctx),r=t.ctx.numMoves||0;return!!e.turn.maxMoves&&r>=e.turn.maxMoves||e.turn.wrapped.endIf(t)}(t);if(r){e.push({fn:A,arg:r,turn:t.ctx.turn,phase:t.ctx.phase,automatic:!0});continue}}e.push(...u)}return t}function v(t,{next:e}){return e.push({fn:b}),t}function b(t,{next:e}){let{G:r,ctx:n}=t;return r=y(n).wrapped.onBegin(t),e.push({fn:w}),{...t,G:r,ctx:n}}function w(t,{currentPlayer:e}){let{ctx:r}=t,n=y(r);e?(r={...r,currentPlayer:e},n.turn.activePlayers&&(r=ea(r,n.turn.activePlayers))):r=function(t,e){let{G:r,ctx:n}=t,{numPlayers:i}=n,s={...t4(t),G:r,ctx:n},a=e.order,o=[...Array.from({length:i})].map((t,e)=>e+"");void 0!==a.playOrder&&(o=a.playOrder(s));let c=a.first(s),l=typeof c;"number"!==l&&t2(`invalid value returned by turn.order.first — expected number got ${l} “${c}”.`);let u=o[c]+"";return ea(n={...n,currentPlayer:u,playOrderPos:c,playOrder:o},e.activePlayers||{})}(t,n.turn);let i=r.turn+1;r={...r,turn:i,numMoves:0,_prevActivePlayers:[]};let s=n.turn.wrapped.onBegin({...t,ctx:r});return{...t,G:s,ctx:r,_undo:[],_redo:[]}}function E(t,{arg:e,next:r,phase:n}){let i=y({phase:n}),{ctx:s}=t;if(e&&e.next){if(!(e.next in o))return t2("invalid phase: "+e.next),t;s={...s,phase:e.next}}else s={...s,phase:i.wrapped.next(t)||null};return t={...t,ctx:s},r.push({fn:b}),t}function _(t,{arg:e,currentPlayer:r,next:n}){let{G:i,ctx:s}=t,{endPhase:a,ctx:o}=function(t,e,r,n){let i=r.order,{G:s,ctx:a}=t,o=a.playOrderPos,c=!1;if(n&&!0!==n)"object"!=typeof n&&t2(`invalid argument to endTurn: ${n}`),Object.keys(n).forEach(t=>{switch(t){case"remove":e=a.playOrder[o]+"";break;case"next":o=a.playOrder.indexOf(n.next),e=n.next;break;default:t2(`invalid argument to endTurn: ${t}`)}});else{let r={...t4(t),G:s,ctx:a},n=i.next(r),l=typeof n;(void 0!==n&&"number"!==l&&t2(`invalid value returned by turn.order.next — expected number or undefined got ${l} “${n}”.`),void 0===n)?c=!0:(o=n,e=a.playOrder[o]+"")}return{endPhase:c,ctx:a={...a,playOrderPos:o,currentPlayer:e}}}(t,r,y(s).turn,e);return s=o,t={...t,G:i,ctx:s},a?n.push({fn:S,turn:s.turn,phase:s.phase}):n.push({fn:w,currentPlayer:s.currentPlayer}),t}function O(t,{arg:e,playerID:r}){if(("string"==typeof e||e===el.NULL)&&(e={stage:e}),"object"!=typeof e)return t;es(e);let{ctx:n}=t,{activePlayers:i,_activePlayersMinMoves:s,_activePlayersMaxMoves:a,_activePlayersNumMoves:o}=n;return void 0!==e.stage&&(null===i&&(i={}),i[r]=e.stage,o[r]=0,e.minMoves&&(null===s&&(s={}),s[r]=e.minMoves),e.maxMoves&&(null===a&&(a={}),a[r]=e.maxMoves)),n={...n,activePlayers:i,_activePlayersMinMoves:s,_activePlayersMaxMoves:a,_activePlayersNumMoves:o},{...t,ctx:n}}function P(t,{arg:e}){return{...t,ctx:ea(t.ctx,e)}}function I(t,{arg:e,phase:r}){t=S(t,{phase:r}),void 0===e&&(e=!0),t={...t,ctx:{...t.ctx,gameover:e}};let n=d.onEnd(t);return{...t,G:n}}function S(t,{arg:e,next:r,turn:n,automatic:i}){let{phase:s,turn:a}=(t=A(t,{turn:n,force:!0,automatic:!0})).ctx;if(r&&r.push({fn:E,arg:e,phase:s}),null===s)return t;let o=y(t.ctx).wrapped.onEnd(t),c={...t.ctx,phase:null},l=tG("endPhase",e),{_stateID:u}=t,h={action:l,_stateID:u,turn:a,phase:s};i&&(h.automatic=!0);let p=[...t.deltalog||[],h];return{...t,G:o,ctx:c,deltalog:p}}function A(t,{arg:e,next:r,turn:n,force:i,automatic:s,playerID:a}){if(n!==t.ctx.turn)return t;let{currentPlayer:o,numMoves:c,phase:l,turn:u}=t.ctx,h=y(t.ctx);if(!i&&h.turn.minMoves&&(c||0)<h.turn.minMoves)return t1(`cannot end turn before making ${h.turn.minMoves} moves`),t;let p=h.turn.wrapped.onEnd(t);r&&r.push({fn:_,arg:e,currentPlayer:o});let f={...t.ctx,activePlayers:null};if(e&&e.remove){a=a||o;let e=f.playOrder.filter(t=>t!=a),n=f.playOrderPos>e.length-1?0:f.playOrderPos;if(f={...f,playOrder:e,playOrderPos:n},0===e.length)return r.push({fn:S,turn:u,phase:l}),t}let d=tG("endTurn",e),{_stateID:g}=t,m={action:d,_stateID:g,turn:u,phase:l};s&&(m.automatic=!0);let v=[...t.deltalog||[],m];return{...t,G:p,ctx:f,deltalog:v,_undo:[],_redo:[]}}function k(t,{arg:e,next:r,automatic:n,playerID:i}){i=i||t.ctx.currentPlayer;let{ctx:s,_stateID:a}=t,{activePlayers:o,_activePlayersNumMoves:c,_activePlayersMinMoves:l,_activePlayersMaxMoves:u,phase:h,turn:p}=s,f=null!==o&&i in o,d=y(s);if(!e&&f){let t=d.turn.stages[o[i]];t&&t.next&&(e=t.next)}if(r&&r.push({fn:O,arg:e,playerID:i}),!f)return t;let g=c[i]||0;if(l&&l[i]&&g<l[i])return t1(`cannot end stage before making ${l[i]} moves`),t;o={...o},delete o[i],l&&(l={...l},delete l[i]),u&&(u={...u},delete u[i]),s=function(t){let{activePlayers:e,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:i,_prevActivePlayers:s,_nextActivePlayers:a}=t;if(e&&0===Object.keys(e).length){if(a)t=ea(t,a),{activePlayers:e,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:i,_prevActivePlayers:s}=t;else if(s.length>0){let t=s.length-1;({activePlayers:e,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:i}=s[t]),s=s.slice(0,t)}else e=null,r=null,n=null}return{...t,activePlayers:e,_activePlayersMinMoves:r,_activePlayersMaxMoves:n,_activePlayersNumMoves:i,_prevActivePlayers:s}}({...s,activePlayers:o,_activePlayersMinMoves:l,_activePlayersMaxMoves:u});let m={action:tG("endStage",e),_stateID:a,turn:p,phase:h};n&&(m.automatic=!0);let v=[...t.deltalog||[],m];return{...t,ctx:s,deltalog:v}}function x(e,r,n){let i=y(e),s=i.turn.stages,{activePlayers:a}=e;if(a&&void 0!==a[n]&&a[n]!==el.NULL&&void 0!==s[a[n]]&&void 0!==s[a[n]].moves){let t=s[a[n]].moves;if(r in t)return t[r]}else if(i.moves){if(r in i.moves)return i.moves[r]}else if(r in t)return t[r];return null}let C={endStage:function(t,e){return m(t,[{fn:k,playerID:e}])},setStage:function(t,e,r){return m(t,[{fn:k,arg:r,playerID:e}])},endTurn:function(t,e,r){return m(t,[{fn:A,turn:t.ctx.turn,phase:t.ctx.phase,arg:r}])},pass:function(t,e,r){return m(t,[{fn:A,turn:t.ctx.turn,phase:t.ctx.phase,force:!0,arg:r}])},endPhase:function(t){return m(t,[{fn:S,phase:t.ctx.phase,turn:t.ctx.turn}])},setPhase:function(t,e,r){return m(t,[{fn:S,phase:t.ctx.phase,turn:t.ctx.turn,arg:{next:r}}])},endGame:function(t,e,r){return m(t,[{fn:I,turn:t.ctx.turn,phase:t.ctx.phase,arg:r}])},setActivePlayers:function(t,e,r){return m(t,[{fn:P,arg:r}])}},N=[];return!1!==s.endTurn&&N.push("endTurn"),!1!==s.pass&&N.push("pass"),!1!==s.endPhase&&N.push("endPhase"),!1!==s.setPhase&&N.push("setPhase"),!1!==s.endGame&&N.push("endGame"),!1!==s.setActivePlayers&&N.push("setActivePlayers"),!1!==s.endStage&&N.push("endStage"),!1!==s.setStage&&N.push("setStage"),{ctx:t=>({numPlayers:t,turn:0,currentPlayer:"0",playOrder:[...Array.from({length:t})].map((t,e)=>e+""),playOrderPos:0,phase:u,activePlayers:null}),init:t=>m(t,[{fn:v}]),isPlayerActive:function(t,e,r){return e.activePlayers?r in e.activePlayers:e.currentPlayer===r},eventHandlers:C,eventNames:Object.keys(C),enabledEventNames:N,moveMap:c,moveNames:[...l.values()],processMove:function(t,e){let{playerID:r,type:n}=e,{currentPlayer:i,activePlayers:s,_activePlayersMaxMoves:a}=t.ctx,o=x(t.ctx,n,r),c=!o||"function"==typeof o||!0!==o.noLimit,{numMoves:l,_activePlayersNumMoves:u}=t.ctx;c&&(r===i&&l++,s&&u[r]++),t={...t,ctx:{...t.ctx,numMoves:l,_activePlayersNumMoves:u}},a&&u[r]>=a[r]&&(t=k(t,{playerID:r,automatic:!0}));let h=y(t.ctx).turn.wrapped.onMove({...t,playerID:r});return m(t={...t,G:h},[{fn:g}])},processEvent:function(t,e){let{type:r,playerID:n,args:i}=e.payload;return"function"!=typeof C[r]?t:C[r](t,n,...Array.isArray(i)?i:[i])},getMove:x}}(t);return{...t,flow:e,moveNames:e.moveNames,pluginNames:t.plugins.map(t=>t.name),processMove:(r,n)=>{let i=e.getMove(r.ctx,n.type,n.playerID);if(eh(i)&&(i=i.move),i instanceof Function){let e=t5(i,p.MOVE,t.plugins),s=[];return void 0!==n.args&&(s=Array.isArray(n.args)?n.args:[n.args]),e({...t4(r),G:r.G,ctx:r.ctx,playerID:n.playerID},...s)}return t2(`invalid move object: ${n.type}`),r.G}}}function eh(t){return t instanceof Object&&void 0!==t.move}el.NULL,el.NULL,el.NULL,el.NULL,(o=d||(d={})).UnauthorizedAction="update/unauthorized_action",o.MatchNotFound="update/match_not_found",o.PatchFailed="update/patch_failed",(c=y||(y={})).StaleStateId="action/stale_state_id",c.UnavailableMove="action/unavailable_move",c.InvalidMove="action/invalid_move",c.InactivePlayer="action/inactive_player",c.GameOver="action/gameover",c.ActionDisabled="action/action_disabled",c.ActionInvalid="action/action_invalid",c.PluginActionInvalid="action/plugin_invalid";let ep=t=>null!==t.payload.playerID&&void 0!==t.payload.playerID,ef=(t,e,r)=>void 0===r.undoable||(r.undoable instanceof Function?r.undoable({G:t,ctx:e}):r.undoable);function ed(t,e){if(e.game.disableUndo)return t;let r={G:t.G,ctx:t.ctx,plugins:t.plugins,playerID:e.action.payload.playerID||t.ctx.currentPlayer};return"MAKE_MOVE"===e.action.type&&(r.moveType=e.action.payload.type),{...t,_undo:[...t._undo,r],_redo:[]}}function ey(t,e,r){let n={action:e,_stateID:t._stateID,turn:t.ctx.turn,phase:t.ctx.phase},i=t.plugins.log.data.metadata;return void 0!==i&&(n.metadata=i),"object"==typeof r&&!0===r.redact?n.redact=!0:"object"==typeof r&&r.redact instanceof Function&&(n.redact=r.redact({G:t.G,ctx:t.ctx})),{...t,deltalog:[n]}}function eg(t,e,r){let[n,i]=en(t,r);return i?[n,ev(e,y.PluginActionInvalid,i)]:[n]}function em(t){if(!t)return[null,void 0];let{transients:e,...r}=t;return[r,e]}function ev(t,e,r){return{...t,transients:{error:{type:e,payload:r}}}}let eb=t=>e=>r=>{let n=e(r);if(r.type===tL)return n;{let[,e]=em(t.getState());return void 0!==e?(t.dispatch(tH()),{...n,transients:e}):n}};function ew({game:t,isClient:e}){return t=eu(t),(r=null,n)=>{let[i]=em(r);switch(n.type){case tL:return i;case tC:{let r;if(i={...i,deltalog:[]},e)return i;if(void 0!==i.ctx.gameover)return t2("cannot call event after game end"),ev(i,y.GameOver);if(ep(n)&&!t.flow.isPlayerActive(i.G,i.ctx,n.payload.playerID))return t2(`disallowed event: ${n.payload.type}`),ev(i,y.InactivePlayer);i=t7(i,{game:t,isClient:!1,playerID:n.payload.playerID});let s=t.flow.processEvent(i,n);if([s,r]=eg(s,i,{game:t,isClient:!1}),r)return r;return{...s=ed(s,{game:t,action:n}),_stateID:i._stateID+1}}case tx:{let r;let s=i={...i,deltalog:[]},a=t.flow.getMove(i.ctx,n.payload.type,n.payload.playerID||i.ctx.currentPlayer);if(null===a)return t2(`disallowed move: ${n.payload.type}`),ev(i,y.UnavailableMove);if(e&&!1===a.client)return i;if(void 0!==i.ctx.gameover)return t2("cannot make move after game end"),ev(i,y.GameOver);if(ep(n)&&!t.flow.isPlayerActive(i.G,i.ctx,n.payload.playerID))return t2(`disallowed move: ${n.payload.type}`),ev(i,y.InactivePlayer);i=t7(i,{game:t,isClient:e,playerID:n.payload.playerID});let o=t.processMove(i,n.payload);if(o===tY)return t2(`invalid move: ${n.payload.type} args: ${n.payload.args}`),ev(i,y.InvalidMove);let c={...i,G:o};if(e&&ee(c,{game:t}))return i;if(i=c,e){let e;if([i,e]=eg(i,s,{game:t,isClient:!0}),e)return e;return{...i,_stateID:i._stateID+1}}if(i=ey(i,n,a),i=t.flow.processMove(i,n.payload),[i,r]=eg(i,s,{game:t}),r)return r;return{...i=ed(i,{game:t,action:n}),_stateID:i._stateID+1}}case tD:case tB:case tT:return n.state;case tM:{if(i={...i,deltalog:[]},t.disableUndo)return t2("Undo is not enabled"),ev(i,y.ActionDisabled);let{G:e,ctx:r,_undo:s,_redo:a,_stateID:o}=i;if(s.length<2)return t2("No moves to undo"),ev(i,y.ActionInvalid);let c=s[s.length-1],l=s[s.length-2];if(ep(n)&&n.payload.playerID!==c.playerID)return t2("Cannot undo other players' moves"),ev(i,y.ActionInvalid);if(c.moveType&&!ef(e,r,t.flow.getMove(l.ctx,c.moveType,c.playerID)))return t2("Move cannot be undone"),ev(i,y.ActionInvalid);return{...i=ey(i,n),G:l.G,ctx:l.ctx,plugins:l.plugins,_stateID:o+1,_undo:s.slice(0,-1),_redo:[c,...a]}}case tN:{if(i={...i,deltalog:[]},t.disableUndo)return t2("Redo is not enabled"),ev(i,y.ActionDisabled);let{_undo:e,_redo:r,_stateID:s}=i;if(0===r.length)return t2("No moves to redo"),ev(i,y.ActionInvalid);let a=r[0];if(ep(n)&&n.payload.playerID!==a.playerID)return t2("Cannot redo other players' moves"),ev(i,y.ActionInvalid);return{...i=ey(i,n),G:a.G,ctx:a.ctx,plugins:a.plugins,_stateID:s+1,_undo:[...e,a],_redo:r.slice(1)}}case tj:return t3(i,n,{game:t});case tR:{let t=i,e=JSON.parse(JSON.stringify(t)),r=(0,w.af)(e,n.patch);if(r.some(t=>null!==t))return t2(`Patch ${JSON.stringify(n.patch)} apply failed`),ev(t,d.PatchFailed,r);return e}default:return i}}}function eE({game:t,numPlayers:e,setupData:r}){t=eu(t),e||(e=2);let n={G:{},ctx:t.flow.ctx(e),plugins:{}},i=t4(n=t7(n=t9(n,{game:t}),{game:t,playerID:void 0}));n.G=t.setup({...i,ctx:n.ctx},r);let s={...n,_undo:[],_redo:[],_stateID:0};return s=t.flow.init(s),[s]=en(s,{game:t}),t.disableUndo||(s._undo=[{G:s.G,ctx:s.ctx,plugins:s.plugins}]),s}class e_{constructor({transportDataCallback:t,gameName:e,playerID:r,matchID:n,credentials:i,numPlayers:s}){this.connectionStatusCallback=()=>{},this.isConnected=!1,this.transportDataCallback=t,this.gameName=e||"default",this.playerID=r||null,this.matchID=n||"default",this.credentials=i,this.numPlayers=s||2}subscribeToConnectionStatus(t){this.connectionStatusCallback=t}setConnectionStatus(t){this.isConnected=t,this.connectionStatusCallback()}notifyClient(t){this.transportDataCallback(t)}}class eO extends e_{connect(){}disconnect(){}sendAction(){}sendChatMessage(){}requestSync(){}updateCredentials(){}updateMatchID(){}updatePlayerID(){}}let eP=t=>new eO(t);class eI{constructor(){this.debugPanel=null,this.currentClient=null,this.clients=new Map,this.subscribers=new Map}register(t){this.clients.set(t,t),this.mountDebug(t),this.notifySubscribers()}unregister(t){if(this.clients.delete(t),this.currentClient===t)for(let[t]of(this.unmountDebug(),this.clients)){if(this.debugPanel)break;this.mountDebug(t)}this.notifySubscribers()}subscribe(t){let e=Symbol();return this.subscribers.set(e,t),t(this.getState()),()=>{this.subscribers.delete(e)}}switchPlayerID(t){if(this.currentClient.multiplayer){for(let[e]of this.clients)if(e.playerID===t&&!1!==e.debugOpt&&e.multiplayer===this.currentClient.multiplayer){this.switchToClient(e);return}}this.currentClient.updatePlayerID(t),this.notifySubscribers()}switchToClient(t){t!==this.currentClient&&(this.unmountDebug(),this.mountDebug(t),this.notifySubscribers())}notifySubscribers(){let t=this.getState();this.subscribers.forEach(e=>{e(t)})}getState(){return{client:this.currentClient,debuggableClients:this.getDebuggableClients()}}getDebuggableClients(){return[...this.clients.values()].filter(t=>!1!==t.debugOpt)}mountDebug(t){let e;if(!1===t.debugOpt||null!==this.debugPanel||"undefined"==typeof document)return;let r=document.body;t.debugOpt&&!0!==t.debugOpt&&(e=t.debugOpt.impl||e,r=t.debugOpt.target||r),e&&(this.currentClient=t,this.debugPanel=new e({target:r,props:{clientManager:this}}))}unmountDebug(){this.debugPanel.$destroy(),this.debugPanel=null,this.currentClient=null}}let eS=new eI;function eA(t,e,r){return r||null!=t||(t=e.getState().ctx.currentPlayer),t}function ek(t,e,r,n,i,s){let a={};for(let o of e)a[o]=(...e)=>{let a=tK[t](o,e,eA(n,r,s),i);r.dispatch(a)};return a}let ex=ek.bind(null,"makeMove"),eC=ek.bind(null,"gameEvent"),eN=ek.bind(null,"plugin");class eD{constructor({game:t,debug:e,numPlayers:r,multiplayer:n,matchID:i,playerID:s,credentials:a,enhancer:o}){this.game=eu(t),this.playerID=s,this.matchID=i||"default",this.credentials=a,this.multiplayer=n,this.debugOpt=e,this.manager=eS,this.gameStateOverride=null,this.subscribers={},this._running=!1,this.reducer=ew({game:this.game,isClient:void 0!==n}),this.initialState=null,n||(this.initialState=eE({game:this.game,numPlayers:r})),this.reset=()=>{this.store.dispatch(tJ(this.initialState))},this.undo=()=>{let t=tz(eA(this.playerID,this.store,this.multiplayer),this.credentials);this.store.dispatch(t)},this.redo=()=>{let t=tW(eA(this.playerID,this.store,this.multiplayer),this.credentials);this.store.dispatch(t)},this.log=[];let c=N(eb,()=>t=>e=>{let r=t(e);return this.notifySubscribers(),r},t=>e=>r=>{let n=t.getState(),i=e(r);return"clientOnly"in r||r.type===tL||this.transport.sendAction(n,r),i},t=>e=>r=>{let n=e(r),i=t.getState();switch(r.type){case tx:case tC:case tM:case tN:{let t=i.deltalog;this.log=[...this.log,...t];break}case tD:this.log=[];break;case tR:case tB:{let t=-1;this.log.length>0&&(t=this.log[this.log.length-1]._stateID);let e=r.deltalog||[];e=e.filter(e=>e._stateID>t),this.log=[...this.log,...e];break}case tT:this.initialState=r.initialState,this.log=r.log||[]}return n});o=void 0!==o?C(c,o):c,this.store=x(this.reducer,this.initialState,o),n||(n=eP),this.transport=n({transportDataCallback:t=>this.receiveTransportData(t),gameKey:t,game:this.game,matchID:i,playerID:s,credentials:a,gameName:this.game.name,numPlayers:r}),this.createDispatchers(),this.chatMessages=[],this.sendChatMessage=t=>{this.transport.sendChatMessage(this.matchID,{id:E(7),sender:this.playerID,payload:t})}}receiveMatchData(t){this.matchData=t,this.notifySubscribers()}receiveChatMessage(t){this.chatMessages=[...this.chatMessages,t],this.notifySubscribers()}receiveTransportData(t){let[e]=t.args;if(e===this.matchID)switch(t.type){case"sync":{let[,e]=t.args,r=tF(e);this.receiveMatchData(e.filteredMetadata),this.store.dispatch(r);break}case"update":{let[,e,r]=t.args,n=this.store.getState();if(e._stateID>=n._stateID){let t=tV(e,r);this.store.dispatch(t)}break}case"patch":{let[,e,r,n,i]=t.args,s=this.store.getState()._stateID;if(e!==s)break;let a=t$(e,r,n,i);this.store.dispatch(a),this.store.getState()._stateID===s&&this.transport.requestSync();break}case"matchData":{let[,e]=t.args;this.receiveMatchData(e);break}case"chat":{let[,e]=t.args;this.receiveChatMessage(e)}}}notifySubscribers(){Object.values(this.subscribers).forEach(t=>t(this.getState()))}overrideGameState(t){this.gameStateOverride=t,this.notifySubscribers()}start(){this.transport.connect(),this._running=!0,this.manager.register(this)}stop(){this.transport.disconnect(),this._running=!1,this.manager.unregister(this)}subscribe(t){let e=Object.keys(this.subscribers).length;return this.subscribers[e]=t,this.transport.subscribeToConnectionStatus(()=>this.notifySubscribers()),(this._running||!this.multiplayer)&&t(this.getState()),()=>{delete this.subscribers[e]}}getInitialState(){return this.initialState}getState(){let t=this.store.getState();if(null!==this.gameStateOverride&&(t=this.gameStateOverride),null===t)return t;let e=!0,r=this.game.flow.isPlayerActive(t.G,t.ctx,this.playerID);return this.multiplayer&&!r&&(e=!1),this.multiplayer||null===this.playerID||void 0===this.playerID||r||(e=!1),void 0!==t.ctx.gameover&&(e=!1),this.multiplayer||(t={...t,G:this.game.playerView({G:t.G,ctx:t.ctx,playerID:this.playerID}),plugins:ei(t,this)}),{...t,log:this.log,isActive:e,isConnected:this.transport.isConnected}}createDispatchers(){this.moves=ex(this.game.moveNames,this.store,this.playerID,this.credentials,this.multiplayer),this.events=eC(this.game.flow.enabledEventNames,this.store,this.playerID,this.credentials,this.multiplayer),this.plugins=eN(this.game.pluginNames,this.store,this.playerID,this.credentials,this.multiplayer)}updatePlayerID(t){this.playerID=t,this.createDispatchers(),this.transport.updatePlayerID(t),this.notifySubscribers()}updateMatchID(t){this.matchID=t,this.createDispatchers(),this.transport.updateMatchID(t),this.notifySubscribers()}updateCredentials(t){this.credentials=t,this.createDispatchers(),this.transport.updateCredentials(t),this.notifySubscribers()}}let{parse:eT,stringify:eM}=JSON,{keys:eB}=Object;r(2001);class eR{constructor({enumerate:t,seed:e}){this.enumerateFn=t,this.seed=e,this.iterationCounter=0,this._opts={}}addOpt({key:t,range:e,initial:r}){this._opts[t]={range:e,value:r}}getOpt(t){return this._opts[t].value}setOpt(t,e){t in this._opts&&(this._opts[t].value=e)}opts(){return this._opts}enumerate(t,e,r){return this.enumerateFn(t,e,r).map(t=>"payload"in t?t:"move"in t?tU(t.move,t.args,r):"event"in t?tG(t.event,t.args,r):void 0)}random(t){let e;if(void 0!==this.seed){let t=tA(this.prngstate?"":this.seed,this.prngstate);e=t(),this.prngstate=t.state()}else e=Math.random();if(t){if(!Array.isArray(t))return Math.floor(e*t);{let r=Math.floor(e*t.length);return t[r]}}return e}}class ej extends eR{constructor({enumerate:t,seed:e,objectives:r,game:n,iterations:i,playoutDepth:s,iterationCallback:a}){super({enumerate:t,seed:e}),void 0===r&&(r=()=>({})),this.objectives=r,this.iterationCallback=a||(()=>{}),this.reducer=ew({game:n}),this.iterations=i,this.playoutDepth=s,this.addOpt({key:"async",initial:!1}),this.addOpt({key:"iterations",initial:"number"==typeof i?i:1e3,range:{min:1,max:2e3}}),this.addOpt({key:"playoutDepth",initial:"number"==typeof s?s:50,range:{min:1,max:100}})}createNode({state:t,parentAction:e,parent:r,playerID:n}){let{G:i,ctx:s}=t,a=[],o=[];if(void 0!==n)a=this.enumerate(i,s,n),o=this.objectives(i,s,n);else if(s.activePlayers)for(let t in s.activePlayers)a.push(...this.enumerate(i,s,t)),o.push(this.objectives(i,s,t));else a=this.enumerate(i,s,s.currentPlayer),o=this.objectives(i,s,s.currentPlayer);return{state:t,parent:r,parentAction:e,actions:a,objectives:o,children:[],visits:0,value:0}}select(t){if(t.actions.length>0||0===t.children.length)return t;let e=null,r=0;for(let n of t.children){let i=n.visits+Number.EPSILON,s=n.value/i+Math.sqrt(2*Math.log(t.visits)/i);(null==e||s>r)&&(r=s,e=n)}return this.select(e)}expand(t){let e=t.actions;if(0===e.length||void 0!==t.state.ctx.gameover)return t;let r=this.random(e.length),n=e[r];t.actions.splice(r,1);let i=this.reducer(t.state,n),s=this.createNode({state:i,parentAction:n,parent:t});return t.children.push(s),s}playout({state:t}){let e=this.getOpt("playoutDepth");"function"==typeof this.playoutDepth&&(e=this.playoutDepth(t.G,t.ctx));for(let r=0;r<e&&void 0===t.ctx.gameover;r++){let{G:e,ctx:r}=t,n=r.currentPlayer;r.activePlayers&&(n=Object.keys(r.activePlayers)[0]);let i=this.enumerate(e,r,n),s=this.objectives(e,r,n),a=Object.keys(s).reduce((t,n)=>{let i=s[n];return i.checker(e,r)?t+i.weight:t},0);if(a>0)return{score:a};if(!i||0===i.length)return;let o=this.random(i.length);t=this.reducer(t,i[o])}return t.ctx.gameover}backpropagate(t,e={}){t.visits++,void 0!==e.score&&(t.value+=e.score),!0===e.draw&&(t.value+=.5),t.parentAction&&e.winner===t.parentAction.payload.playerID&&t.value++,t.parent&&this.backpropagate(t.parent,e)}play(t,e){let r=this.createNode({state:t,playerID:e}),n=this.getOpt("iterations");"function"==typeof this.iterations&&(n=this.iterations(t.G,t.ctx));let i=()=>{let t=null;for(let e of r.children)(null==t||e.visits>t.visits)&&(t=e);return{action:t&&t.parentAction,metadata:r}};return new Promise(t=>{let e=()=>{for(let t=0;t<25&&this.iterationCounter<n;t++){let t=this.select(r),e=this.expand(t),n=this.playout(e);this.backpropagate(e,n),this.iterationCounter++}this.iterationCallback({iterationCounter:this.iterationCounter,numIterations:n,metadata:r})};if(this.iterationCounter=0,this.getOpt("async")){let r=()=>{this.iterationCounter<n?(e(),setImmediate(r)):t(i())};r()}else{for(;this.iterationCounter<n;)e();t(i())}})}}let eL=(t,e)=>{if(!t||"string"!=typeof t)throw Error(`Expected ${e} string, got "${t}".`)},eU=t=>eL(t,"game name"),eG=t=>eL(t,"match ID"),eq=(t,e)=>{if(!t)throw Error(`Expected body, got “${t}”.`);for(let r in e){let n=e[r],i=Array.isArray(n)?n:[n],s=t[r];if(!i.includes(typeof s)){let t=i.join("|");throw TypeError(`Expected body.${r} to be of type ${t}, got “${s}”.`)}}};class eF extends Error{constructor(t,e){super(t),this.details=e}}class e${constructor({server:t=""}={}){this.server=t.replace(/\/$/,"")}async request(t,e){let r=await fetch(this.server+t,e);if(!r.ok){let t;try{t=await r.clone().json()}catch{try{t=await r.text()}catch(e){t=e.message}}throw new eF(`HTTP status ${r.status}`,t)}return r.json()}async post(t,e){let r={method:"post",body:JSON.stringify(e.body),headers:{"Content-Type":"application/json"}};return e.init&&(r={...r,...e.init,headers:{...r.headers,...e.init.headers}}),this.request(t,r)}async listGames(t){return this.request("/games",t)}async listMatches(t,e,r){eU(t);let n="";if(e){let t=[],{isGameover:r,updatedBefore:i,updatedAfter:s}=e;void 0!==r&&t.push(`isGameover=${r}`),i&&t.push(`updatedBefore=${i}`),s&&t.push(`updatedAfter=${s}`),t.length>0&&(n="?"+t.join("&"))}return this.request(`/games/${t}${n}`,r)}async getMatch(t,e,r){return eU(t),eG(e),this.request(`/games/${t}/${e}`,r)}async createMatch(t,e,r){return eU(t),eq(e,{numPlayers:"number"}),this.post(`/games/${t}/create`,{body:e,init:r})}async joinMatch(t,e,r,n){return eU(t),eG(e),eq(r,{playerID:["string","undefined"],playerName:"string"}),this.post(`/games/${t}/${e}/join`,{body:r,init:n})}async leaveMatch(t,e,r,n){eU(t),eG(e),eq(r,{playerID:"string",credentials:"string"}),await this.post(`/games/${t}/${e}/leave`,{body:r,init:n})}async updatePlayer(t,e,r,n){eU(t),eG(e),eq(r,{playerID:"string",credentials:"string"}),await this.post(`/games/${t}/${e}/update`,{body:r,init:n})}async playAgain(t,e,r,n){return eU(t),eG(e),eq(r,{playerID:"string",credentials:"string"}),this.post(`/games/${t}/${e}/playAgain`,{body:r,init:n})}}var eV=r(2773),eJ=r(6988),ez=r.n(eJ),eW=r(3309);function eH(t){return t.type()===g.SYNC}(l=g||(g={}))[l.SYNC=0]="SYNC",l[l.ASYNC=1]="ASYNC";class eK{type(){return g.SYNC}connect(){}createMatch(t,e){if(this.createGame)return console.warn("The database connector does not implement a createMatch method.","\nUsing the deprecated createGame method instead."),this.createGame(t,e);console.error("The database connector does not implement a createMatch method.")}listMatches(t){if(this.listGames)return console.warn("The database connector does not implement a listMatches method.","\nUsing the deprecated listGames method instead."),this.listGames(t);console.error("The database connector does not implement a listMatches method.")}}let eY=({game:t,unlisted:e,setupData:r,numPlayers:n})=>{let i={gameName:t.name,unlisted:!!e,players:{},createdAt:Date.now(),updatedAt:Date.now()};void 0!==r&&(i.setupData=r);for(let t=0;t<n;t++)i.players[t]={id:t};return i},eX=({game:t,numPlayers:e,setupData:r,unlisted:n})=>{e&&"number"==typeof e||(e=2);let i=t.validateSetupData&&t.validateSetupData(r,e);return void 0!==i?{setupDataError:i}:{metadata:eY({game:t,numPlayers:e,setupData:r,unlisted:n}),initialState:eE({game:t,numPlayers:e,setupData:r})}},eQ=t=>Object.values(t.players).map(t=>{let{credentials:e,...r}=t;return r}),eZ=t=>{let{credentials:e,...r}=t.payload;return{...t,payload:r}};class e0{constructor(t,e,r,n){this.game=eu(t),this.storageAPI=e,this.transportAPI=r,this.subscribeCallback=()=>{},this.auth=n}subscribe(t){this.subscribeCallback=t}async onUpdate(t,e,r,n){let i,s,a;if(!t||!t.payload)return{error:"missing action or action payload"};if(eH(this.storageAPI)?{metadata:i}=this.storageAPI.fetch(r,{metadata:!0}):{metadata:i}=await this.storageAPI.fetch(r,{metadata:!0}),this.auth&&!await this.auth.authenticateCredentials({playerID:n,credentials:t.payload.credentials,metadata:i}))return{error:"unauthorized action"};let o=eZ(t);if(eH(this.storageAPI)?{state:s}=this.storageAPI.fetch(r,{state:!0}):{state:s}=await this.storageAPI.fetch(r,{state:!0}),void 0===s)return t2(`game not found, matchID=[${r}]`),{error:"game not found"};if(void 0!==s.ctx.gameover){t2(`game over - matchID=[${r}] - playerID=[${n}] - action[${o.payload.type}]`);return}let c=x(ew({game:this.game}),s,N(eb));if(o.type==tM||o.type==tN){let t=null!==s.ctx.activePlayers,e=s.ctx.currentPlayer===n;if(!t&&!e||t&&(void 0===s.ctx.activePlayers[n]||Object.keys(s.ctx.activePlayers).length>1)){t2(`playerID=[${n}] cannot undo / redo right now`);return}}if(!this.game.flow.isPlayerActive(s.G,s.ctx,n)){t2(`player not active - playerID=[${n}] - action[${o.payload.type}]`);return}let l=o.type==tx?this.game.flow.getMove(s.ctx,o.payload.type,n):null;if(o.type==tx&&!l){t2(`move not processed - canPlayerMakeMove=false - playerID=[${n}] - action[${o.payload.type}]`);return}if(s._stateID!==e&&!(l&&eh(l)&&l.ignoreStaleStateID)){t2(`invalid stateID, was=[${e}], expected=[${s._stateID}] - playerID=[${n}] - action[${o.payload.type}]`);return}let u=c.getState();c.dispatch(o),s=c.getState(),this.subscribeCallback({state:s,action:o,matchID:r}),this.game.deltaState?this.transportAPI.sendAll({type:"patch",args:[r,e,u,s]}):this.transportAPI.sendAll({type:"update",args:[r,s]});let{deltalog:h,...p}=s;if(i&&(void 0===i.gameover||null===i.gameover)&&(a={...i,updatedAt:Date.now()},void 0!==s.ctx.gameover&&(a.gameover=s.ctx.gameover)),eH(this.storageAPI))this.storageAPI.setState(r,p,h),a&&this.storageAPI.setMetadata(r,a);else{let t=[this.storageAPI.setState(r,p,h)];a&&t.push(this.storageAPI.setMetadata(r,a)),await Promise.all(t)}}async onSync(t,e,r,n=2){let i={state:!0,metadata:!0,log:!0,initialState:!0},{state:s,initialState:a,log:o,metadata:c}=eH(this.storageAPI)?this.storageAPI.fetch(t,i):await this.storageAPI.fetch(t,i);if(this.auth&&null!=e&&!await this.auth.authenticateCredentials({playerID:e,credentials:r,metadata:c}))return{error:"unauthorized"};if(void 0===s){let e=eX({game:this.game,unlisted:!0,numPlayers:n,setupData:void 0});if("setupDataError"in e)return{error:"game requires setupData"};a=s=e.initialState,c=e.metadata,this.subscribeCallback({state:s,matchID:t}),eH(this.storageAPI)?this.storageAPI.createMatch(t,{initialState:a,metadata:c}):await this.storageAPI.createMatch(t,{initialState:a,metadata:c})}let l={state:s,log:o,filteredMetadata:c?eQ(c):void 0,initialState:a};this.transportAPI.send({playerID:e,type:"sync",args:[t,l]})}async onConnectionChange(t,e,r,n){let i;if(null==e)return;if(eH(this.storageAPI)?{metadata:i}=this.storageAPI.fetch(t,{metadata:!0}):{metadata:i}=await this.storageAPI.fetch(t,{metadata:!0}),void 0===i)return t2(`metadata not found for matchID=[${t}]`),{error:"metadata not found"};if(void 0===i.players[e])return t2(`Player not in the match, matchID=[${t}] playerID=[${e}]`),{error:"player not in the match"};if(this.auth&&!await this.auth.authenticateCredentials({playerID:e,credentials:r,metadata:i}))return{error:"unauthorized"};i.players[e].isConnected=n;let s=eQ(i);this.transportAPI.sendAll({type:"matchData",args:[t,s]}),eH(this.storageAPI)?this.storageAPI.setMetadata(t,i):await this.storageAPI.setMetadata(t,i)}async onChatMessage(t,e,r){if(this.auth){let{metadata:n}=await this.storageAPI.fetch(t,{metadata:!0});if(!(e&&"string"==typeof e.sender)||!await this.auth.authenticateCredentials({playerID:e.sender,credentials:r,metadata:n}))return{error:"unauthorized"}}this.transportAPI.sendAll({type:"chat",args:[t,e]})}}let e1=(t,e,r)=>({...r,G:t.playerView({G:r.G,ctx:r.ctx,playerID:e}),plugins:ei(r,{playerID:e,game:t}),deltalog:void 0,_undo:[],_redo:[]}),e2=t=>(e,r)=>{switch(r.type){case"patch":{let[n,i,s,a]=r.args,o=e8(a.deltalog,e),c=e1(t,e,a),l=a._stateID,u=e1(t,e,s);return{type:"patch",args:[n,i,l,(0,w.rh)(u,c),o]}}case"update":{let[n,i]=r.args,s=e8(i.deltalog,e);return{type:"update",args:[n,e1(t,e,i),s]}}case"sync":{let[n,i]=r.args,s=e1(t,e,i.state),a=e8(i.log,e);return{type:"sync",args:[n,{...i,state:s,log:a}]}}default:return r}};function e8(t,e){return void 0===t?t:t.map(t=>{if(null!==e&&+e==+t.action.payload.playerID||!0!==t.redact)return t;let r={...t.action.payload,args:null},{redact:n,...i}={...t,action:{...t.action,payload:r}};return i})}let e6=Object.create(null);e6.open="0",e6.close="1",e6.ping="2",e6.pong="3",e6.message="4",e6.upgrade="5",e6.noop="6";let e3=Object.create(null);Object.keys(e6).forEach(t=>{e3[e6[t]]=t});let e4={type:"error",data:"parser error"},e5="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),e9="function"==typeof ArrayBuffer,e7=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,rt=({type:t,data:e},r,n)=>e5&&e instanceof Blob?r?n(e):re(e,n):e9&&(e instanceof ArrayBuffer||e7(e))?r?n(e):re(new Blob([e]),n):n(e6[t]+(e||"")),re=(t,e)=>{let r=new FileReader;return r.onload=function(){e("b"+(r.result.split(",")[1]||""))},r.readAsDataURL(t)};function rr(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let rn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ri="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let t=0;t<rn.length;t++)ri[rn.charCodeAt(t)]=t;let rs=t=>{let e=.75*t.length,r=t.length,n,i=0,s,a,o,c;"="===t[t.length-1]&&(e--,"="===t[t.length-2]&&e--);let l=new ArrayBuffer(e),u=new Uint8Array(l);for(n=0;n<r;n+=4)s=ri[t.charCodeAt(n)],a=ri[t.charCodeAt(n+1)],o=ri[t.charCodeAt(n+2)],c=ri[t.charCodeAt(n+3)],u[i++]=s<<2|a>>4,u[i++]=(15&a)<<4|o>>2,u[i++]=(3&o)<<6|63&c;return l},ra="function"==typeof ArrayBuffer,ro=(t,e)=>{if("string"!=typeof t)return{type:"message",data:rl(t,e)};let r=t.charAt(0);return"b"===r?{type:"message",data:rc(t.substring(1),e)}:e3[r]?t.length>1?{type:e3[r],data:t.substring(1)}:{type:e3[r]}:e4},rc=(t,e)=>ra?rl(rs(t),e):{base64:!0,data:t},rl=(t,e)=>"blob"===e?t instanceof Blob?t:new Blob([t]):t instanceof ArrayBuffer?t:t.buffer,ru=(t,e)=>{let r=t.length,n=Array(r),i=0;t.forEach((t,s)=>{rt(t,!1,t=>{n[s]=t,++i===r&&e(n.join("\x1e"))})})},rh=(t,e)=>{let r=t.split("\x1e"),n=[];for(let t=0;t<r.length;t++){let i=ro(r[t],e);if(n.push(i),"error"===i.type)break}return n};function rp(t){return t.reduce((t,e)=>t+e.length,0)}function rf(t,e){if(t[0].length===e)return t.shift();let r=new Uint8Array(e),n=0;for(let i=0;i<e;i++)r[i]=t[0][n++],n===t[0].length&&(t.shift(),n=0);return t.length&&n<t[0].length&&(t[0]=t[0].slice(n)),r}function rd(t){if(t)return function(t){for(var e in rd.prototype)t[e]=rd.prototype[e];return t}(t)}rd.prototype.on=rd.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},rd.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this},rd.prototype.off=rd.prototype.removeListener=rd.prototype.removeAllListeners=rd.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<n.length;i++)if((r=n[i])===e||r.fn===e){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+t],this},rd.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=Array(arguments.length-1),r=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(r){r=r.slice(0);for(var n=0,i=r.length;n<i;++n)r[n].apply(this,e)}return this},rd.prototype.emitReserved=rd.prototype.emit,rd.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},rd.prototype.hasListeners=function(t){return!!this.listeners(t).length};let ry="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function rg(t,...e){return e.reduce((e,r)=>(t.hasOwnProperty(r)&&(e[r]=t[r]),e),{})}let rm=ry.setTimeout,rv=ry.clearTimeout;function rb(t,e){e.useNativeTimers?(t.setTimeoutFn=rm.bind(ry),t.clearTimeoutFn=rv.bind(ry)):(t.setTimeoutFn=ry.setTimeout.bind(ry),t.clearTimeoutFn=ry.clearTimeout.bind(ry))}class rw extends Error{constructor(t,e,r){super(t),this.description=e,this.context=r,this.type="TransportError"}}class rE extends rd{constructor(t){super(),this.writable=!1,rb(this,t),this.opts=t,this.query=t.query,this.socket=t.socket}onError(t,e,r){return super.emitReserved("error",new rw(t,e,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){let e=ro(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,e={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){let t=this.opts.hostname;return -1===t.indexOf(":")?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(t){let e=function(t){let e="";for(let r in t)t.hasOwnProperty(r)&&(e.length&&(e+="&"),e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e}(t);return e.length?"?"+e:""}}let r_="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),rO={},rP=0,rI=0,rS;function rA(t){let e="";do e=r_[t%64]+e,t=Math.floor(t/64);while(t>0);return e}function rk(){let t=rA(+new Date);return t!==rS?(rP=0,rS=t):t+"."+rA(rP++)}for(;rI<64;rI++)rO[r_[rI]]=rI;let rx=!1;try{rx="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){}let rC=rx;function rN(t){let e=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!e||rC))return new XMLHttpRequest}catch(t){}if(!e)try{return new ry[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function rD(){}let rT=null!=new rN({xdomain:!1}).responseType;class rM extends rE{constructor(t){if(super(t),this.polling=!1,"undefined"!=typeof location){let e="https:"===location.protocol,r=location.port;r||(r=e?"443":"80"),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||r!==t.port}let e=t&&t.forceBase64;this.supportsBinary=rT&&!e,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";let e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once("pollComplete",function(){--t||e()})),this.writable||(t++,this.once("drain",function(){--t||e()}))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){rh(t,this.socket.binaryType).forEach(t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){let t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,ru(t,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let t=this.opts.secure?"https":"http",e=this.query||{};return!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=rk()),this.supportsBinary||e.sid||(e.b64=1),this.createUri(t,e)}request(t={}){return Object.assign(t,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new rB(this.uri(),t)}doWrite(t,e){let r=this.request({method:"POST",data:t});r.on("success",e),r.on("error",(t,e)=>{this.onError("xhr post error",t,e)})}doPoll(){let t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(t,e)=>{this.onError("xhr poll error",t,e)}),this.pollXhr=t}}class rB extends rd{constructor(t,e){super(),rb(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.data=void 0!==e.data?e.data:null,this.create()}create(){var t;let e=rg(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd;let r=this.xhr=new rN(e);try{r.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders)for(let t in r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(t)&&r.setRequestHeader(t,this.opts.extraHeaders[t])}catch(t){}if("POST"===this.method)try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{r.setRequestHeader("Accept","*/*")}catch(t){}null===(t=this.opts.cookieJar)||void 0===t||t.addCookies(r),"withCredentials"in r&&(r.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(r.timeout=this.opts.requestTimeout),r.onreadystatechange=()=>{var t;3===r.readyState&&(null===(t=this.opts.cookieJar)||void 0===t||t.parseCookies(r)),4===r.readyState&&(200===r.status||1223===r.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof r.status?r.status:0)},0))},r.send(this.data)}catch(t){this.setTimeoutFn(()=>{this.onError(t)},0);return}"undefined"!=typeof document&&(this.index=rB.requestsCount++,rB.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=rD,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete rB.requests[this.index],this.xhr=null}}onLoad(){let t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}function rR(){for(let t in rB.requests)rB.requests.hasOwnProperty(t)&&rB.requests[t].abort()}rB.requestsCount=0,rB.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",rR):"function"==typeof addEventListener&&addEventListener("onpagehide"in ry?"pagehide":"unload",rR,!1));let rj="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),rL=ry.WebSocket||ry.MozWebSocket;r(3842).lW;let rU="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class rG extends rE{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let t=this.uri(),e=this.opts.protocols,r=rU?{}:rg(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=rU?new rL(t,e,r):e?new rL(t,e):new rL(t)}catch(t){return this.emitReserved("error",t)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){let r=t[e],n=e===t.length-1;rt(r,this.supportsBinary,t=>{try{this.ws.send(t)}catch(t){}n&&rj(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let t=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=rk()),this.supportsBinary||(e.b64=1),this.createUri(t,e)}check(){return!!rL}}class rq extends rE{get name(){return"webtransport"}doOpen(){"function"==typeof WebTransport&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(t=>{let e=function(t,e){i||(i=new TextDecoder);let r=[],n=0,s=-1,a=!1;return new TransformStream({transform(o,c){for(r.push(o);;){if(0===n){if(1>rp(r))break;let t=rf(r,1);a=(128&t[0])==128,n=(s=127&t[0])<126?3:126===s?1:2}else if(1===n){if(2>rp(r))break;let t=rf(r,2);s=new DataView(t.buffer,t.byteOffset,t.length).getUint16(0),n=3}else if(2===n){if(8>rp(r))break;let t=rf(r,8),e=new DataView(t.buffer,t.byteOffset,t.length),i=e.getUint32(0);if(i>2097151){c.enqueue(e4);break}s=4294967296*i+e.getUint32(4),n=3}else{if(rp(r)<s)break;let t=rf(r,s);c.enqueue(ro(a?t:i.decode(t),e)),n=0}if(0===s||s>t){c.enqueue(e4);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=t.readable.pipeThrough(e).getReader(),s=new TransformStream({transform(t,e){var r;r=r=>{let n;let i=r.length;if(i<126)new DataView((n=new Uint8Array(1)).buffer).setUint8(0,i);else if(i<65536){let t=new DataView((n=new Uint8Array(3)).buffer);t.setUint8(0,126),t.setUint16(1,i)}else{let t=new DataView((n=new Uint8Array(9)).buffer);t.setUint8(0,127),t.setBigUint64(1,BigInt(i))}t.data&&"string"!=typeof t.data&&(n[0]|=128),e.enqueue(n),e.enqueue(r)},e5&&t.data instanceof Blob?t.data.arrayBuffer().then(rr).then(r):e9&&(t.data instanceof ArrayBuffer||e7(t.data))?r(rr(t.data)):rt(t,!1,t=>{n||(n=new TextEncoder),r(n.encode(t))})}});s.readable.pipeTo(t.writable),this.writer=s.writable.getWriter();let a=()=>{r.read().then(({done:t,value:e})=>{t||(this.onPacket(e),a())}).catch(t=>{})};a();let o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this.writer.write(o).then(()=>this.onOpen())})}))}write(t){this.writable=!1;for(let e=0;e<t.length;e++){let r=t[e],n=e===t.length-1;this.writer.write(r).then(()=>{n&&rj(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;null===(t=this.transport)||void 0===t||t.close()}}let rF={websocket:rG,webtransport:rq,polling:rM},r$=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,rV=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function rJ(t){if(t.length>2e3)throw"URI too long";let e=t,r=t.indexOf("["),n=t.indexOf("]");-1!=r&&-1!=n&&(t=t.substring(0,r)+t.substring(r,n).replace(/:/g,";")+t.substring(n,t.length));let i=r$.exec(t||""),s={},a=14;for(;a--;)s[rV[a]]=i[a]||"";return -1!=r&&-1!=n&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=function(t,e){let r=e.replace(/\/{2,9}/g,"/").split("/");return("/"==e.slice(0,1)||0===e.length)&&r.splice(0,1),"/"==e.slice(-1)&&r.splice(r.length-1,1),r}(0,s.path),s.queryKey=function(t,e){let r={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(t,e,n){e&&(r[e]=n)}),r}(0,s.query),s}class rz extends rd{constructor(t,e={}){super(),this.binaryType="arraybuffer",this.writeBuffer=[],t&&"object"==typeof t&&(e=t,t=null),t?(t=rJ(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=rJ(e.host).host),rb(this,e),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(t){let e={},r=t.split("&");for(let t=0,n=r.length;t<n;t++){let n=r[t].split("=");e[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){let e=Object.assign({},this.opts.query);e.EIO=4,e.transport=t,this.id&&(e.sid=this.id);let r=Object.assign({},this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new rF[t](r)}open(){let t;if(this.opts.rememberUpgrade&&rz.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else if(0===this.transports.length){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else t=this.transports[0];this.readyState="opening";try{t=this.createTransport(t)}catch(t){this.transports.shift(),this.open();return}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(t){let e=this.createTransport(t),r=!1;rz.priorWebsocketSuccess=!1;let n=()=>{r||(e.send([{type:"ping",data:"probe"}]),e.once("packet",t=>{if(!r){if("pong"===t.type&&"probe"===t.data)this.upgrading=!0,this.emitReserved("upgrading",e),e&&(rz.priorWebsocketSuccess="websocket"===e.name,this.transport.pause(()=>{r||"closed"===this.readyState||(l(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())}));else{let t=Error("probe error");t.transport=e.name,this.emitReserved("upgradeError",t)}}}))};function i(){r||(r=!0,l(),e.close(),e=null)}let s=t=>{let r=Error("probe error: "+t);r.transport=e.name,i(),this.emitReserved("upgradeError",r)};function a(){s("transport closed")}function o(){s("socket closed")}function c(t){e&&t.name!==e.name&&i()}let l=()=>{e.removeListener("open",n),e.removeListener("error",s),e.removeListener("close",a),this.off("close",o),this.off("upgrading",c)};e.once("open",n),e.once("error",s),e.once("close",a),this.once("close",o),this.once("upgrading",c),-1!==this.upgrades.indexOf("webtransport")&&"webtransport"!==t?this.setTimeoutFn(()=>{r||e.open()},200):e.open()}onOpen(){if(this.readyState="open",rz.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let t=0,e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),this.resetPingTimeout(),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let e=Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let e=0;e<this.writeBuffer.length;e++){let r=this.writeBuffer[e].data;if(r&&(t+="string"==typeof r?function(t){let e=0,r=0;for(let n=0,i=t.length;n<i;n++)(e=t.charCodeAt(n))<128?r+=1:e<2048?r+=2:e<55296||e>=57344?r+=3:(n++,r+=4);return r}(r):Math.ceil(1.33*(r.byteLength||r.size))),e>0&&t>this.maxPayload)return this.writeBuffer.slice(0,e);t+=2}return this.writeBuffer}write(t,e,r){return this.sendPacket("message",t,e,r),this}send(t,e,r){return this.sendPacket("message",t,e,r),this}sendPacket(t,e,r,n){if("function"==typeof e&&(n=e,e=void 0),"function"==typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;let i={type:t,data:e,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}close(){let t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},r=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():t()}):this.upgrading?r():t()),this}onError(t){rz.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,e){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){let e=[],r=0,n=t.length;for(;r<n;r++)~this.transports.indexOf(t[r])&&e.push(t[r]);return e}}rz.protocol=4,rz.protocol;let rW="function"==typeof ArrayBuffer,rH=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,rK=Object.prototype.toString,rY="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===rK.call(Blob),rX="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===rK.call(File);function rQ(t){return rW&&(t instanceof ArrayBuffer||rH(t))||rY&&t instanceof Blob||rX&&t instanceof File}let rZ=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],r0=5;(u=m||(m={}))[u.CONNECT=0]="CONNECT",u[u.DISCONNECT=1]="DISCONNECT",u[u.EVENT=2]="EVENT",u[u.ACK=3]="ACK",u[u.CONNECT_ERROR=4]="CONNECT_ERROR",u[u.BINARY_EVENT=5]="BINARY_EVENT",u[u.BINARY_ACK=6]="BINARY_ACK";class r1{constructor(t){this.replacer=t}encode(t){return(t.type===m.EVENT||t.type===m.ACK)&&function t(e,r){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let r=0,n=e.length;r<n;r++)if(t(e[r]))return!0;return!1}if(rQ(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1==arguments.length)return t(e.toJSON(),!0);for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return!0;return!1}(t)?this.encodeAsBinary({type:t.type===m.EVENT?m.BINARY_EVENT:m.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let e=""+t.type;return(t.type===m.BINARY_EVENT||t.type===m.BINARY_ACK)&&(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){let e=function(t){let e=[],r=t.data;return t.data=function t(e,r){if(!e)return e;if(rQ(e)){let t={_placeholder:!0,num:r.length};return r.push(e),t}if(Array.isArray(e)){let n=Array(e.length);for(let i=0;i<e.length;i++)n[i]=t(e[i],r);return n}if("object"==typeof e&&!(e instanceof Date)){let n={};for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=t(e[i],r));return n}return e}(r,e),t.attachments=e.length,{packet:t,buffers:e}}(t),r=this.encodeAsString(e.packet),n=e.buffers;return n.unshift(r),n}}function r2(t){return"[object Object]"===Object.prototype.toString.call(t)}class r8 extends rd{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw Error("got plaintext data when reconstructing a packet");let r=(e=this.decodeString(t)).type===m.BINARY_EVENT;r||e.type===m.BINARY_ACK?(e.type=r?m.EVENT:m.ACK,this.reconstructor=new r6(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else if(rQ(t)||t.base64){if(this.reconstructor)(e=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,super.emitReserved("decoded",e));else throw Error("got binary data when not reconstructing a packet")}else throw Error("Unknown type: "+t)}decodeString(t){let e=0,r={type:Number(t.charAt(0))};if(void 0===m[r.type])throw Error("unknown packet type "+r.type);if(r.type===m.BINARY_EVENT||r.type===m.BINARY_ACK){let n=e+1;for(;"-"!==t.charAt(++e)&&e!=t.length;);let i=t.substring(n,e);if(i!=Number(i)||"-"!==t.charAt(e))throw Error("Illegal attachments");r.attachments=Number(i)}if("/"===t.charAt(e+1)){let n=e+1;for(;++e&&","!==t.charAt(e)&&e!==t.length;);r.nsp=t.substring(n,e)}else r.nsp="/";let n=t.charAt(e+1);if(""!==n&&Number(n)==n){let n=e+1;for(;++e;){let r=t.charAt(e);if(null==r||Number(r)!=r){--e;break}if(e===t.length)break}r.id=Number(t.substring(n,e+1))}if(t.charAt(++e)){let n=this.tryParse(t.substr(e));if(r8.isPayloadValid(r.type,n))r.data=n;else throw Error("invalid payload")}return r}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(t){return!1}}static isPayloadValid(t,e){switch(t){case m.CONNECT:return r2(e);case m.DISCONNECT:return void 0===e;case m.CONNECT_ERROR:return"string"==typeof e||r2(e);case m.EVENT:case m.BINARY_EVENT:return Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0]&&-1===rZ.indexOf(e[0]));case m.ACK:case m.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class r6{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e,r;let t=(e=this.reconPack,r=this.buffers,e.data=function t(e,r){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<r.length)return r[e.num];throw Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=t(e[n],r);else if("object"==typeof e)for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=t(e[n],r));return e}(e.data,r),delete e.attachments,e);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function r3(t,e,r){return t.on(e,r),function(){t.off(e,r)}}let r4=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class r5 extends rd{constructor(t,e,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let t=this.io;this.subs=[r3(t,"open",this.onopen.bind(this)),r3(t,"packet",this.onpacket.bind(this)),r3(t,"error",this.onerror.bind(this)),r3(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(r4.hasOwnProperty(t))throw Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;let r={type:m.EVENT,data:e};if(r.options={},r.options.compress=!1!==this.flags.compress,"function"==typeof e[e.length-1]){let t=this.ids++,n=e.pop();this._registerAckCallback(t,n),r.id=t}let n=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return(!this.flags.volatile||n&&this.connected)&&(this.connected?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(t,e){var r;let n=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===n){this.acks[t]=e;return}let i=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,Error("operation has timed out"))},n),s=(...t)=>{this.io.clearTimeoutFn(i),e.apply(this,t)};s.withError=!0,this.acks[t]=s}emitWithAck(t,...e){return new Promise((r,n)=>{let i=(t,e)=>t?n(t):r(e);i.withError=!0,e.push(i),this.emit(t,...e)})}_addToQueue(t){let e;"function"==typeof t[t.length-1]&&(e=t.pop());let r={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((t,...n)=>{if(r===this._queue[0])return null!==t?r.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(t)):(this._queue.shift(),e&&e(null,...n)),r.pending=!1,this._drainQueue()}),this._queue.push(r),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||0===this._queue.length)return;let e=this._queue[0];(!e.pending||t)&&(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:m.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(e=>String(e.id)===t)){let e=this.acks[t];delete this.acks[t],e.withError&&e.call(this,Error("socket has been disconnected"))}})}onpacket(t){if(!(t.nsp!==this.nsp))switch(t.type){case m.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case m.EVENT:case m.BINARY_EVENT:this.onevent(t);break;case m.ACK:case m.BINARY_ACK:this.onack(t);break;case m.DISCONNECT:this.ondisconnect();break;case m.CONNECT_ERROR:this.destroy();let e=Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}onevent(t){let e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length)for(let e of this._anyListeners.slice())e.apply(this,t);super.emit.apply(this,t),this._pid&&t.length&&"string"==typeof t[t.length-1]&&(this._lastOffset=t[t.length-1])}ack(t){let e=this,r=!1;return function(...n){r||(r=!0,e.packet({type:m.ACK,id:t,data:n}))}}onack(t){let e=this.acks[t.id];"function"==typeof e&&(delete this.acks[t.id],e.withError&&t.data.unshift(null),e.apply(this,t.data))}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:m.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){let e=this._anyListeners;for(let r=0;r<e.length;r++)if(t===e[r]){e.splice(r,1);break}}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){let e=this._anyOutgoingListeners;for(let r=0;r<e.length;r++)if(t===e[r]){e.splice(r,1);break}}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length)for(let e of this._anyOutgoingListeners.slice())e.apply(this,t.data)}}function r9(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}r9.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),r=Math.floor(e*this.jitter*t);t=(1&Math.floor(10*e))==0?t-r:t+r}return 0|Math.min(t,this.max)},r9.prototype.reset=function(){this.attempts=0},r9.prototype.setMin=function(t){this.ms=t},r9.prototype.setMax=function(t){this.max=t},r9.prototype.setJitter=function(t){this.jitter=t};class r7 extends rd{constructor(t,e){var r;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.opts=e,rb(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=e.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new r9({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=t;let n=e.parser||b;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new rz(this.uri,this.opts);let e=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;let n=r3(e,"open",function(){r.onopen(),t&&t()}),i=e=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",e),t?t(e):this.maybeReconnectOnOpen()},s=r3(e,"error",i);if(!1!==this._timeout){let t=this._timeout,r=this.setTimeoutFn(()=>{n(),i(Error("timeout")),e.close()},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}return this.subs.push(n),this.subs.push(s),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let t=this.engine;this.subs.push(r3(t,"ping",this.onping.bind(this)),r3(t,"data",this.ondata.bind(this)),r3(t,"error",this.onerror.bind(this)),r3(t,"close",this.onclose.bind(this)),r3(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(t){this.onclose("parse error",t)}}ondecoded(t){rj(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let r=this.nsps[t];return r?this._autoConnect&&!r.active&&r.connect():(r=new r5(this,t,e),this.nsps[t]=r),r}_destroy(t){for(let t of Object.keys(this.nsps))if(this.nsps[t].active)return;this._close()}_packet(t){let e=this.encoder.encode(t);for(let r=0;r<e.length;r++)this.engine.write(e[r],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let e=this.backoff.duration();this._reconnecting=!0;let r=this.setTimeoutFn(()=>{!t.skipReconnect&&(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open(e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()}))},e);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){let t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}let nt={};function ne(t,e){let r;"object"==typeof t&&(e=t,t=void 0);let n=function(t,e="",r){let n=t;r=r||"undefined"!=typeof location&&location,null==t&&(t=r.protocol+"//"+r.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?r.protocol+t:r.host+t),/^(https?|wss?):\/\//.test(t)||(t=void 0!==r?r.protocol+"//"+t:"https://"+t),n=rJ(t)),!n.port&&(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";let i=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+i+":"+n.port+e,n.href=n.protocol+"://"+i+(r&&r.port===n.port?"":":"+n.port),n}(t,(e=e||{}).path||"/socket.io"),i=n.source,s=n.id,a=n.path,o=nt[s]&&a in nt[s].nsps;return e.forceNew||e["force new connection"]||!1===e.multiplex||o?r=new r7(i,e):(nt[s]||(nt[s]=new r7(i,e)),r=nt[s]),n.query&&!e.query&&(e.query=n.queryKey),r.socket(n.path,e)}Object.assign(ne,{Manager:r7,Socket:r5,io:ne,connect:ne});class nr extends eK{constructor(){super(),this.state=new Map,this.initial=new Map,this.metadata=new Map,this.log=new Map}createMatch(t,e){this.initial.set(t,e.initialState),this.setState(t,e.initialState),this.setMetadata(t,e.metadata)}setMetadata(t,e){this.metadata.set(t,e)}setState(t,e,r){if(r&&r.length>0){let e=this.log.get(t)||[];this.log.set(t,[...e,...r])}this.state.set(t,e)}fetch(t,e){let r={};return e.state&&(r.state=this.state.get(t)),e.metadata&&(r.metadata=this.metadata.get(t)),e.log&&(r.log=this.log.get(t)||[]),e.initialState&&(r.initialState=this.initial.get(t)),r}wipe(t){this.state.delete(t),this.metadata.delete(t)}listMatches(t){return[...this.metadata.entries()].filter(([,e])=>!t||(void 0===t.gameName||e.gameName===t.gameName)&&(void 0===t.where||(void 0===t.where.isGameover||void 0!==e.gameover===t.where.isGameover)&&(void 0===t.where.updatedBefore||!(e.updatedAt>=t.where.updatedBefore))&&(void 0===t.where.updatedAfter||!(e.updatedAt<=t.where.updatedAfter)))).map(([t])=>t)}}class nn extends Map{constructor(t){super(),this.key=t,(JSON.parse(localStorage.getItem(this.key))||[]).forEach(t=>this.set(...t))}sync(){let t=[...this.entries()];localStorage.setItem(this.key,JSON.stringify(t))}set(t,e){return super.set(t,e),this.sync(),this}delete(t){let e=super.delete(t);return this.sync(),e}}class ni extends nr{constructor(t="bgio"){super();let e=e=>new nn(`${t}_${e}`);this.state=e("state"),this.initial=e("initial"),this.metadata=e("metadata"),this.log=e("log")}}class ns extends e0{constructor({game:t,bots:e,storageKey:r,persist:n}){let i={},s={};if(t&&t.ai&&e)for(let r in e){let n=e[r];s[r]=new n({game:t,enumerate:t.ai.enumerate,seed:t.seed})}let a=({playerID:t,...e})=>{let r=i[t];void 0!==r&&r(o(t,e))},o=e2(t);super(t,n?new ni(r):new nr,{send:a,sendAll:t=>{for(let e in i)a({playerID:e,...t})}}),this.connect=(t,e)=>{i[t]=e},this.subscribe(({state:t,matchID:r})=>{if(!e)return;let n=function(t,e){if(void 0!==t.ctx.gameover)return null;if(t.ctx.activePlayers){for(let r of Object.keys(e))if(r in t.ctx.activePlayers)return r}else if(t.ctx.currentPlayer in e)return t.ctx.currentPlayer;return null}(t,s);null!==n&&setTimeout(async()=>{let e=await s[n].play(t,n);await this.onUpdate(e.action,t._stateID,r,e.action.payload.playerID)},100)})}}class na extends e_{constructor({master:t,...e}){super(e),this.master=t}sendChatMessage(t,e){let r=[t,e,this.credentials];this.master.onChatMessage(...r)}sendAction(t,e){this.master.onUpdate(e,t._stateID,this.matchID,this.playerID)}requestSync(){this.master.onSync(this.matchID,this.playerID,this.credentials,this.numPlayers)}connect(){this.setConnectionStatus(!0),this.master.connect(this.playerID,t=>this.notifyClient(t)),this.requestSync()}disconnect(){this.setConnectionStatus(!1)}updateMatchID(t){this.matchID=t,this.connect()}updatePlayerID(t){this.playerID=t,this.connect()}updateCredentials(t){this.credentials=t,this.connect()}}let no=new Map;class nc extends e_{constructor({socket:t,socketOpts:e,server:r,...n}){super(n),this.server=r,this.socket=t,this.socketOpts=e}sendAction(t,e){let r=[e,t._stateID,this.matchID,this.playerID];this.socket.emit("update",...r)}sendChatMessage(t,e){let r=[t,e,this.credentials];this.socket.emit("chat",...r)}connect(){if(!this.socket){if(this.server){let t=this.server;-1==t.search(/^https?:\/\//)&&(t="http://"+this.server),"/"!=t.slice(-1)&&(t+="/"),this.socket=ne(t+this.gameName,this.socketOpts)}else this.socket=ne("/"+this.gameName,this.socketOpts)}this.socket.on("patch",(t,e,r,n,i)=>{this.notifyClient({type:"patch",args:[t,e,r,n,i]})}),this.socket.on("update",(t,e,r)=>{this.notifyClient({type:"update",args:[t,e,r]})}),this.socket.on("sync",(t,e)=>{this.notifyClient({type:"sync",args:[t,e]})}),this.socket.on("matchData",(t,e)=>{this.notifyClient({type:"matchData",args:[t,e]})}),this.socket.on("chat",(t,e)=>{this.notifyClient({type:"chat",args:[t,e]})}),this.socket.on("connect",()=>{this.requestSync(),this.setConnectionStatus(!0)}),this.socket.on("disconnect",()=>{this.setConnectionStatus(!1)})}disconnect(){this.socket.close(),this.socket=null,this.setConnectionStatus(!1)}requestSync(){if(this.socket){let t=[this.matchID,this.playerID,this.credentials,this.numPlayers];this.socket.emit("sync",...t)}}updateMatchID(t){this.matchID=t,this.requestSync()}updatePlayerID(t){this.playerID=t,this.requestSync()}updateCredentials(t){this.credentials=t,this.requestSync()}}function nl({server:t,socketOpts:e}={}){return r=>new nc({server:t,socketOpts:e,...r})}function nu(t){var e;let{game:r,numPlayers:n,board:i,multiplayer:s,enhancer:a}=t,{loading:o,debug:c}=t;return void 0===o&&(o=()=>eV.createElement("div",{className:"bgio-loading"},"connecting...")),(e=class extends eV.Component{constructor(t){super(t),void 0===c&&(c=t.debug),this.client=new eD({game:r,debug:c,numPlayers:n,multiplayer:s,matchID:t.matchID,playerID:t.playerID,credentials:t.credentials,enhancer:a})}componentDidMount(){this.unsubscribe=this.client.subscribe(()=>this.forceUpdate()),this.client.start()}componentWillUnmount(){this.client.stop(),this.unsubscribe()}componentDidUpdate(t){this.props.matchID!=t.matchID&&this.client.updateMatchID(this.props.matchID),this.props.playerID!=t.playerID&&this.client.updatePlayerID(this.props.playerID),this.props.credentials!=t.credentials&&this.client.updateCredentials(this.props.credentials)}render(){let t=this.client.getState();if(null===t)return eV.createElement(o);let e=null;return i&&(e=eV.createElement(i,{...t,...this.props,isMultiplayer:!!s,moves:this.client.moves,events:this.client.events,matchID:this.client.matchID,playerID:this.client.playerID,reset:this.client.reset,undo:this.client.undo,redo:this.client.redo,log:this.client.log,matchData:this.client.matchData,sendChatMessage:this.client.sendChatMessage,chatMessages:this.client.chatMessages})),eV.createElement("div",{className:"bgio-client"},e)}}).propTypes={matchID:ez().string,playerID:ez().string,credentials:ez().string,debug:ez().any},e.defaultProps={matchID:"default",playerID:null,credentials:null,debug:!0},e}class nh{constructor({server:t,gameComponents:e,playerName:r,playerCredentials:n}){this.client=new e$({server:t}),this.gameComponents=e,this.playerName=r||"Visitor",this.playerCredentials=n,this.matches=[]}async refresh(){try{for(let t of(this.matches=[],await this.client.listGames())){if(!this._getGameComponents(t))continue;let{matches:e}=await this.client.listMatches(t);this.matches.push(...e)}}catch(t){throw Error("failed to retrieve list of matches ("+t+")")}}_getMatchInstance(t){for(let e of this.matches)if(e.matchID===t)return e}_getGameComponents(t){for(let e of this.gameComponents)if(e.game.name===t)return e}_findPlayer(t){for(let e of this.matches)if(e.players.some(e=>e.name===t))return e}async join(t,e,r){try{let n=this._findPlayer(this.playerName);if(n)throw Error("player has already joined "+n.matchID);if(!(n=this._getMatchInstance(e)))throw Error("game instance "+e+" not found");let i=await this.client.joinMatch(t,e,{playerID:r,playerName:this.playerName});n.players[Number.parseInt(r)].name=this.playerName,this.playerCredentials=i.playerCredentials}catch(t){throw Error("failed to join match "+e+" ("+t+")")}}async leave(t,e){try{let r=this._getMatchInstance(e);if(!r)throw Error("match instance not found");for(let n of r.players)if(n.name===this.playerName){await this.client.leaveMatch(t,e,{playerID:n.id.toString(),credentials:this.playerCredentials}),delete n.name,delete this.playerCredentials;return}throw Error("player not found in match")}catch(t){throw Error("failed to leave match "+e+" ("+t+")")}}async disconnect(){let t=this._findPlayer(this.playerName);t&&await this.leave(t.gameName,t.matchID),this.matches=[],this.playerName="Visitor"}async create(t,e){try{let r=this._getGameComponents(t);if(!r)throw Error("game not found");if(e<r.game.minPlayers||e>r.game.maxPlayers)throw Error("invalid number of players "+e);await this.client.createMatch(t,{numPlayers:e})}catch(e){throw Error("failed to create match for "+t+" ("+e+")")}}}class np extends eV.Component{constructor(){super(...arguments),this.state={playerName:this.props.playerName,nameErrorMsg:""},this.onClickEnter=()=>{""!==this.state.playerName&&this.props.onEnter(this.state.playerName)},this.onKeyPress=t=>{"Enter"===t.key&&this.onClickEnter()},this.onChangePlayerName=t=>{let e=t.target.value.trim();this.setState({playerName:e,nameErrorMsg:e.length>0?"":"empty player name"})}}render(){return eV.createElement("div",null,eV.createElement("p",{className:"phase-title"},"Choose a player name:"),eV.createElement("input",{type:"text",value:this.state.playerName,onChange:this.onChangePlayerName,onKeyPress:this.onKeyPress}),eV.createElement("span",{className:"buttons"},eV.createElement("button",{className:"buttons",onClick:this.onClickEnter},"Enter")),eV.createElement("br",null),eV.createElement("span",{className:"error-msg"},this.state.nameErrorMsg,eV.createElement("br",null)))}}np.defaultProps={playerName:""};class nf extends eV.Component{constructor(){super(...arguments),this._createSeat=t=>t.name||"[free]",this._createButtonJoin=(t,e)=>eV.createElement("button",{key:"button-join-"+t.matchID,onClick:()=>this.props.onClickJoin(t.gameName,t.matchID,""+e)},"Join"),this._createButtonLeave=t=>eV.createElement("button",{key:"button-leave-"+t.matchID,onClick:()=>this.props.onClickLeave(t.gameName,t.matchID)},"Leave"),this._createButtonPlay=(t,e)=>eV.createElement("button",{key:"button-play-"+t.matchID,onClick:()=>this.props.onClickPlay(t.gameName,{matchID:t.matchID,playerID:""+e,numPlayers:t.players.length})},"Play"),this._createButtonSpectate=t=>eV.createElement("button",{key:"button-spectate-"+t.matchID,onClick:()=>this.props.onClickPlay(t.gameName,{matchID:t.matchID,numPlayers:t.players.length})},"Spectate"),this._createInstanceButtons=t=>{let e=t.players.find(t=>t.name===this.props.playerName),r=t.players.find(t=>!t.name);return e&&r?this._createButtonLeave(t):r?this._createButtonJoin(t,r.id):e?eV.createElement("div",null,[this._createButtonPlay(t,e.id),this._createButtonLeave(t)]):this._createButtonSpectate(t)}}render(){let t=this.props.match,e="OPEN";return t.players.some(t=>!t.name)||(e="RUNNING"),eV.createElement("tr",{key:"line-"+t.matchID},eV.createElement("td",{key:"cell-name-"+t.matchID},t.gameName),eV.createElement("td",{key:"cell-status-"+t.matchID},e),eV.createElement("td",{key:"cell-seats-"+t.matchID},t.players.map(t=>this._createSeat(t)).join(", ")),eV.createElement("td",{key:"cell-buttons-"+t.matchID},this._createInstanceButtons(t)))}}class nd extends eV.Component{constructor(t){for(let e of(super(t),this.state={selectedGame:0,numPlayers:2},this._createGameNameOption=(t,e)=>eV.createElement("option",{key:"name-option-"+e,value:e},t.game.name),this._createNumPlayersOption=t=>eV.createElement("option",{key:"num-option-"+t,value:t},t),this._createNumPlayersRange=t=>Array.from({length:t.maxPlayers+1}).map((t,e)=>e).slice(t.minPlayers),this.onChangeNumPlayers=t=>{this.setState({numPlayers:Number.parseInt(t.target.value)})},this.onChangeSelectedGame=t=>{let e=Number.parseInt(t.target.value);this.setState({selectedGame:e,numPlayers:this.props.games[e].game.minPlayers})},this.onClickCreate=()=>{this.props.createMatch(this.props.games[this.state.selectedGame].game.name,this.state.numPlayers)},t.games)){let t=e.game;t.minPlayers||(t.minPlayers=1),t.maxPlayers||(t.maxPlayers=4),console.assert(t.maxPlayers>=t.minPlayers)}this.state={selectedGame:0,numPlayers:t.games[0].game.minPlayers}}render(){return eV.createElement("div",null,eV.createElement("select",{value:this.state.selectedGame,onChange:t=>this.onChangeSelectedGame(t)},this.props.games.map((t,e)=>this._createGameNameOption(t,e))),eV.createElement("span",null,"Players:"),eV.createElement("select",{value:this.state.numPlayers,onChange:this.onChangeNumPlayers},this._createNumPlayersRange(this.props.games[this.state.selectedGame].game).map(t=>this._createNumPlayersOption(t))),eV.createElement("span",{className:"buttons"},eV.createElement("button",{onClick:this.onClickCreate},"Create")))}}(h=v||(v={})).ENTER="enter",h.PLAY="play",h.LIST="list";class ny extends eV.Component{constructor(t){super(t),this.state={phase:v.ENTER,playerName:"Visitor",runningMatch:null,errorMsg:"",credentialStore:{}},this._createConnection=t=>{let e=this.state.playerName;this.connection=new nh({server:t.lobbyServer,gameComponents:t.gameComponents,playerName:e,playerCredentials:this.state.credentialStore[e]})},this._updateCredentials=(t,e)=>{this.setState(r=>{let n=Object.assign({},r.credentialStore);return n[t]=e,{credentialStore:n}})},this._updateConnection=async()=>{await this.connection.refresh(),this.forceUpdate()},this._enterLobby=t=>{this._startRefreshInterval(),this.setState({playerName:t,phase:v.LIST})},this._exitLobby=async()=>{this._clearRefreshInterval(),await this.connection.disconnect(),this.setState({phase:v.ENTER,errorMsg:""})},this._createMatch=async(t,e)=>{try{await this.connection.create(t,e),await this.connection.refresh(),this.setState({})}catch(t){this.setState({errorMsg:t.message})}},this._joinMatch=async(t,e,r)=>{try{await this.connection.join(t,e,r),await this.connection.refresh(),this._updateCredentials(this.connection.playerName,this.connection.playerCredentials)}catch(t){this.setState({errorMsg:t.message})}},this._leaveMatch=async(t,e)=>{try{await this.connection.leave(t,e),await this.connection.refresh(),this._updateCredentials(this.connection.playerName,this.connection.playerCredentials)}catch(t){this.setState({errorMsg:t.message})}},this._startMatch=(t,e)=>{let r;let n=this.connection._getGameComponents(t);if(!n){this.setState({errorMsg:"game "+t+" not supported"});return}if(e.numPlayers>1&&(r=this.props.gameServer?nl({server:this.props.gameServer}):nl()),1==e.numPlayers){let t=n.game.maxPlayers,e={};for(let r=1;r<t;r++)e[r+""]=ej;r=function({bots:t,persist:e,storageKey:r}={}){return n=>{let i;let{gameKey:s,game:a}=n,o=no.get(s);return o&&o.bots===t&&o.storageKey===r&&o.persist===e&&(i=o.master),i||(i=new ns({game:a,bots:t,persist:e,storageKey:r}),no.set(s,{master:i,bots:t,persist:e,storageKey:r})),new na({master:i,...n})}}({bots:e})}let i={app:this.props.clientFactory({game:n.game,board:n.board,debug:this.props.debug,multiplayer:r}),matchID:e.matchID,playerID:e.numPlayers>1?e.playerID:"0",credentials:this.connection.playerCredentials};this._clearRefreshInterval(),this.setState({phase:v.PLAY,runningMatch:i})},this._exitMatch=()=>{this._startRefreshInterval(),this.setState({phase:v.LIST,runningMatch:null})},this._getPhaseVisibility=t=>this.state.phase!==t?"hidden":"phase",this.renderMatches=(t,e)=>t.map(t=>{let{matchID:r,gameName:n,players:i}=t;return eV.createElement(nf,{key:"instance-"+r,match:{matchID:r,gameName:n,players:Object.values(i)},playerName:e,onClickJoin:this._joinMatch,onClickLeave:this._leaveMatch,onClickPlay:this._startMatch})}),this._createConnection(this.props)}componentDidMount(){let t=eW.ZP.load("lobbyState")||{};t.phase&&t.phase===v.PLAY&&(t.phase=v.LIST),t.phase&&t.phase!==v.ENTER&&this._startRefreshInterval(),this.setState({phase:t.phase||v.ENTER,playerName:t.playerName||"Visitor",credentialStore:t.credentialStore||{}})}componentDidUpdate(t,e){let r=this.state.playerName,n=this.state.credentialStore[r];if(e.phase!==this.state.phase||e.credentialStore[r]!==n||e.playerName!==r){this._createConnection(this.props),this._updateConnection();let t={phase:this.state.phase,playerName:r,credentialStore:this.state.credentialStore};eW.ZP.save("lobbyState",t,{path:"/"})}t.refreshInterval!==this.props.refreshInterval&&this._startRefreshInterval()}componentWillUnmount(){this._clearRefreshInterval()}_startRefreshInterval(){this._clearRefreshInterval(),this._currentInterval=setInterval(this._updateConnection,this.props.refreshInterval)}_clearRefreshInterval(){clearInterval(this._currentInterval)}render(){let{gameComponents:t,renderer:e}=this.props,{errorMsg:r,playerName:n,phase:i,runningMatch:s}=this.state;return e?e({errorMsg:r,gameComponents:t,matches:this.connection.matches,phase:i,playerName:n,runningMatch:s,handleEnterLobby:this._enterLobby,handleExitLobby:this._exitLobby,handleCreateMatch:this._createMatch,handleJoinMatch:this._joinMatch,handleLeaveMatch:this._leaveMatch,handleExitMatch:this._exitMatch,handleRefreshMatches:this._updateConnection,handleStartMatch:this._startMatch}):eV.createElement("div",{id:"lobby-view",style:{padding:50}},eV.createElement("div",{className:this._getPhaseVisibility(v.ENTER)},eV.createElement(np,{key:n,playerName:n,onEnter:this._enterLobby})),eV.createElement("div",{className:this._getPhaseVisibility(v.LIST)},eV.createElement("p",null,"Welcome, ",n),eV.createElement("div",{className:"phase-title",id:"match-creation"},eV.createElement("span",null,"Create a match:"),eV.createElement(nd,{games:t,createMatch:this._createMatch})),eV.createElement("p",{className:"phase-title"},"Join a match:"),eV.createElement("div",{id:"instances"},eV.createElement("table",null,eV.createElement("tbody",null,this.renderMatches(this.connection.matches,n))),eV.createElement("span",{className:"error-msg"},r,eV.createElement("br",null))),eV.createElement("p",{className:"phase-title"},"Matches that become empty are automatically deleted.")),eV.createElement("div",{className:this._getPhaseVisibility(v.PLAY)},s&&eV.createElement(s.app,{matchID:s.matchID,playerID:s.playerID,credentials:s.credentials}),eV.createElement("div",{className:"buttons",id:"match-exit"},eV.createElement("button",{onClick:this._exitMatch},"Exit match"))),eV.createElement("div",{className:"buttons",id:"lobby-exit"},eV.createElement("button",{onClick:this._exitLobby},"Exit lobby")))}}ny.propTypes={gameComponents:ez().array.isRequired,lobbyServer:ez().string,gameServer:ez().string,debug:ez().bool,clientFactory:ez().func,refreshInterval:ez().number},ny.defaultProps={debug:!1,clientFactory:nu,refreshInterval:2e3}},3842:function(t,e,r){"use strict";var n=r(1974),i=r(8101),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(t){if(t>2147483647)throw RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return Object.setPrototypeOf(e,o.prototype),e}function o(t,e,r){if("number"==typeof t){if("string"==typeof e)throw TypeError('The "string" argument must be of type string. Received type number');return u(t)}return c(t,e,r)}function c(t,e,r){if("string"==typeof t)return function(t,e){if(("string"!=typeof e||""===e)&&(e="utf8"),!o.isEncoding(e))throw TypeError("Unknown encoding: "+e);var r=0|d(t,e),n=a(r),i=n.write(t,e);return i!==r&&(n=n.slice(0,i)),n}(t,e);if(ArrayBuffer.isView(t))return function(t){if(x(t,Uint8Array)){var e=new Uint8Array(t);return p(e.buffer,e.byteOffset,e.byteLength)}return h(t)}(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(x(t,ArrayBuffer)||t&&x(t.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(x(t,SharedArrayBuffer)||t&&x(t.buffer,SharedArrayBuffer)))return p(t,e,r);if("number"==typeof t)throw TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return o.from(n,e,r);var i=function(t){if(o.isBuffer(t)){var e,r=0|f(t.length),n=a(r);return 0===n.length||t.copy(n,0,0,r),n}return void 0!==t.length?"number"!=typeof t.length||(e=t.length)!=e?a(0):h(t):"Buffer"===t.type&&Array.isArray(t.data)?h(t.data):void 0}(t);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return o.from(t[Symbol.toPrimitive]("string"),e,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function l(t){if("number"!=typeof t)throw TypeError('"size" argument must be of type number');if(t<0)throw RangeError('The value "'+t+'" is invalid for option "size"')}function u(t){return l(t),a(t<0?0:0|f(t))}function h(t){for(var e=t.length<0?0:0|f(t.length),r=a(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function p(t,e,r){var n;if(e<0||t.byteLength<e)throw RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),o.prototype),n}function f(t){if(t>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|t}function d(t,e){if(o.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||x(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return S(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return A(t).length;default:if(i)return n?-1:S(t).length;e=(""+e).toLowerCase(),i=!0}}function y(t,e,r){var i,s,a=!1;if((void 0===e||e<0)&&(e=0),e>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(e>>>=0)))return"";for(t||(t="utf8");;)switch(t){case"hex":return function(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=e;s<r;++s)i+=C[t[s]];return i}(this,e,r);case"utf8":case"utf-8":return b(this,e,r);case"ascii":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}(this,e,r);case"latin1":case"binary":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}(this,e,r);case"base64":return i=e,s=r,0===i&&s===this.length?n.fromByteArray(this):n.fromByteArray(this.slice(i,s));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,r){for(var n=t.slice(e,r),i="",s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(this,e,r);default:if(a)throw TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),a=!0}}function g(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function m(t,e,r,n,i){var s;if(0===t.length)return -1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),(s=r=+r)!=s&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return -1;r=t.length-1}else if(r<0){if(!i)return -1;r=0}if("string"==typeof e&&(e=o.from(e,n)),o.isBuffer(e))return 0===e.length?-1:v(t,e,r,n,i);if("number"==typeof e)return(e&=255,"function"==typeof Uint8Array.prototype.indexOf)?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):v(t,[e],r,n,i);throw TypeError("val must be string, number or Buffer")}function v(t,e,r,n,i){var s,a=1,o=t.length,c=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return -1;a=2,o/=2,c/=2,r/=2}function l(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){var u=-1;for(s=r;s<o;s++)if(l(t,s)===l(e,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===c)return u*a}else -1!==u&&(s-=s-u),u=-1}else for(r+c>o&&(r=o-c),s=r;s>=0;s--){for(var h=!0,p=0;p<c;p++)if(l(t,s+p)!==l(e,p)){h=!1;break}if(h)return s}return -1}function b(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var s,a,o,c,l=t[i],u=null,h=l>239?4:l>223?3:l>191?2:1;if(i+h<=r)switch(h){case 1:l<128&&(u=l);break;case 2:(192&(s=t[i+1]))==128&&(c=(31&l)<<6|63&s)>127&&(u=c);break;case 3:s=t[i+1],a=t[i+2],(192&s)==128&&(192&a)==128&&(c=(15&l)<<12|(63&s)<<6|63&a)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:s=t[i+1],a=t[i+2],o=t[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(c=(15&l)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&c<1114112&&(u=c)}null===u?(u=65533,h=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),i+=h}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=4096));return r}(n)}function w(t,e,r){if(t%1!=0||t<0)throw RangeError("offset is not uint");if(t+e>r)throw RangeError("Trying to access beyond buffer length")}function E(t,e,r,n,i,s){if(!o.isBuffer(t))throw TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw RangeError('"value" argument is out of bounds');if(r+n>t.length)throw RangeError("Index out of range")}function _(t,e,r,n,i,s){if(r+n>t.length||r<0)throw RangeError("Index out of range")}function O(t,e,r,n,s){return e=+e,r>>>=0,s||_(t,e,r,4,34028234663852886e22,-34028234663852886e22),i.write(t,e,r,n,23,4),r+4}function P(t,e,r,n,s){return e=+e,r>>>=0,s||_(t,e,r,8,17976931348623157e292,-17976931348623157e292),i.write(t,e,r,n,52,8),r+8}e.lW=o,e.h2=50,o.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(t,e,r){return c(t,e,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(t,e,r){return(l(t),t<=0)?a(t):void 0!==e?"string"==typeof r?a(t).fill(e,r):a(t).fill(e):a(t)},o.allocUnsafe=function(t){return u(t)},o.allocUnsafeSlow=function(t){return u(t)},o.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==o.prototype},o.compare=function(t,e){if(x(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),x(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(t)||!o.isBuffer(e))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,n=e.length,i=0,s=Math.min(r,n);i<s;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},o.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(t,e){if(!Array.isArray(t))throw TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return o.alloc(0);if(void 0===e)for(r=0,e=0;r<t.length;++r)e+=t[r].length;var r,n=o.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var s=t[r];if(x(s,Uint8Array))i+s.length>n.length?o.from(s).copy(n,i):Uint8Array.prototype.set.call(n,s,i);else if(o.isBuffer(s))s.copy(n,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=s.length}return n},o.byteLength=d,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},o.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},o.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},o.prototype.toString=function(){var t=this.length;return 0===t?"":0==arguments.length?b(this,0,t):y.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(t){if(!o.isBuffer(t))throw TypeError("Argument must be a Buffer");return this===t||0===o.compare(this,t)},o.prototype.inspect=function(){var t="",r=e.h2;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(t,e,r,n,i){if(x(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(t))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return -1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,i>>>=0,this===t)return 0;for(var s=i-n,a=r-e,c=Math.min(s,a),l=this.slice(n,i),u=t.slice(e,r),h=0;h<c;++h)if(l[h]!==u[h]){s=l[h],a=u[h];break}return s<a?-1:a<s?1:0},o.prototype.includes=function(t,e,r){return -1!==this.indexOf(t,e,r)},o.prototype.indexOf=function(t,e,r){return m(this,t,e,r,!0)},o.prototype.lastIndexOf=function(t,e,r){return m(this,t,e,r,!1)},o.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else if(isFinite(e))e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,c,l,u,h,p=this.length-e;if((void 0===r||r>p)&&(r=p),t.length>0&&(r<0||e<0)||e>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var f=!1;;)switch(n){case"hex":return function(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=e.length;n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o=parseInt(e.substr(2*a,2),16);if(o!=o)break;t[r+a]=o}return a}(this,t,e,r);case"utf8":case"utf-8":return i=e,s=r,k(S(t,this.length-i),this,i,s);case"ascii":case"latin1":case"binary":return a=e,o=r,k(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(t),this,a,o);case"base64":return c=e,l=r,k(A(t),this,c,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=e,h=r,k(function(t,e){for(var r,n,i=[],s=0;s<t.length&&!((e-=2)<0);++s)n=(r=t.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(t,this.length-u),this,u,h);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var n=this.subarray(t,e);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUintLE=o.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||w(t,e,this.length);for(var n=this[t],i=1,s=0;++s<e&&(i*=256);)n+=this[t+s]*i;return n},o.prototype.readUintBE=o.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||w(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},o.prototype.readUint8=o.prototype.readUInt8=function(t,e){return t>>>=0,e||w(t,1,this.length),this[t]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(t,e){return t>>>=0,e||w(t,2,this.length),this[t]|this[t+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(t,e){return t>>>=0,e||w(t,2,this.length),this[t]<<8|this[t+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(t,e){return t>>>=0,e||w(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(t,e){return t>>>=0,e||w(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},o.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||w(t,e,this.length);for(var n=this[t],i=1,s=0;++s<e&&(i*=256);)n+=this[t+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},o.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||w(t,e,this.length);for(var n=e,i=1,s=this[t+--n];n>0&&(i*=256);)s+=this[t+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*e)),s},o.prototype.readInt8=function(t,e){return(t>>>=0,e||w(t,1,this.length),128&this[t])?-((255-this[t]+1)*1):this[t]},o.prototype.readInt16LE=function(t,e){t>>>=0,e||w(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt16BE=function(t,e){t>>>=0,e||w(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt32LE=function(t,e){return t>>>=0,e||w(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},o.prototype.readInt32BE=function(t,e){return t>>>=0,e||w(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},o.prototype.readFloatLE=function(t,e){return t>>>=0,e||w(t,4,this.length),i.read(this,t,!0,23,4)},o.prototype.readFloatBE=function(t,e){return t>>>=0,e||w(t,4,this.length),i.read(this,t,!1,23,4)},o.prototype.readDoubleLE=function(t,e){return t>>>=0,e||w(t,8,this.length),i.read(this,t,!0,52,8)},o.prototype.readDoubleBE=function(t,e){return t>>>=0,e||w(t,8,this.length),i.read(this,t,!1,52,8)},o.prototype.writeUintLE=o.prototype.writeUIntLE=function(t,e,r,n){if(t=+t,e>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;E(this,t,e,r,i,0)}var s=1,a=0;for(this[e]=255&t;++a<r&&(s*=256);)this[e+a]=t/s&255;return e+r},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(t,e,r,n){if(t=+t,e>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;E(this,t,e,r,i,0)}var s=r-1,a=1;for(this[e+s]=255&t;--s>=0&&(a*=256);)this[e+s]=t/a&255;return e+r},o.prototype.writeUint8=o.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||E(this,t,e,1,255,0),this[e]=255&t,e+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||E(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||E(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||E(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||E(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},o.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);E(this,t,e,r,i-1,-i)}var s=0,a=1,o=0;for(this[e]=255&t;++s<r&&(a*=256);)t<0&&0===o&&0!==this[e+s-1]&&(o=1),this[e+s]=(t/a>>0)-o&255;return e+r},o.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);E(this,t,e,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[e+s]=255&t;--s>=0&&(a*=256);)t<0&&0===o&&0!==this[e+s+1]&&(o=1),this[e+s]=(t/a>>0)-o&255;return e+r},o.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||E(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},o.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||E(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},o.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||E(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},o.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||E(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},o.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||E(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},o.prototype.writeFloatLE=function(t,e,r){return O(this,t,e,!0,r)},o.prototype.writeFloatBE=function(t,e,r){return O(this,t,e,!1,r)},o.prototype.writeDoubleLE=function(t,e,r){return P(this,t,e,!0,r)},o.prototype.writeDoubleBE=function(t,e,r){return P(this,t,e,!1,r)},o.prototype.copy=function(t,e,r,n){if(!o.isBuffer(t))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r||0===t.length||0===this.length)return 0;if(e<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i=n-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,n):Uint8Array.prototype.set.call(t,this.subarray(r,n),e),i},o.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===t.length){var i,s=t.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(t=s)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw RangeError("Out of range index");if(r<=e)return this;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(i=e;i<r;++i)this[i]=t;else{var a=o.isBuffer(t)?t:o.from(t,n),c=a.length;if(0===c)throw TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<r-e;++i)this[i+e]=a[i%c]}return this};var I=/[^+/0-9A-Za-z-_]/g;function S(t,e){e=e||1/0;for(var r,n=t.length,i=null,s=[],a=0;a<n;++a){if((r=t.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function A(t){return n.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(I,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function k(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length)&&!(i>=t.length);++i)e[i+r]=t[i];return i}function x(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}var C=function(){for(var t="0123456789abcdef",e=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)e[n+i]=t[r]+t[i];return e}()},2812:function(t,e){"use strict";e.parse=function(t,e){if("string"!=typeof t)throw TypeError("argument str must be a string");for(var n={},s=t.split(i),a=(e||{}).decode||r,o=0;o<s.length;o++){var c=s[o],l=c.indexOf("=");if(!(l<0)){var u=c.substr(0,l).trim(),h=c.substr(++l,c.length).trim();'"'==h[0]&&(h=h.slice(1,-1)),void 0==n[u]&&(n[u]=function(t,e){try{return e(t)}catch(e){return t}}(h,a))}}return n},e.serialize=function(t,e,r){var i=r||{},a=i.encode||n;if("function"!=typeof a)throw TypeError("option encode is invalid");if(!s.test(t))throw TypeError("argument name is invalid");var o=a(e);if(o&&!s.test(o))throw TypeError("argument val is invalid");var c=t+"="+o;if(null!=i.maxAge){var l=i.maxAge-0;if(isNaN(l))throw Error("maxAge should be a Number");c+="; Max-Age="+Math.floor(l)}if(i.domain){if(!s.test(i.domain))throw TypeError("option domain is invalid");c+="; Domain="+i.domain}if(i.path){if(!s.test(i.path))throw TypeError("option path is invalid");c+="; Path="+i.path}if(i.expires){if("function"!=typeof i.expires.toUTCString)throw TypeError("option expires is invalid");c+="; Expires="+i.expires.toUTCString()}if(i.httpOnly&&(c+="; HttpOnly"),i.secure&&(c+="; Secure"),i.sameSite)switch("string"==typeof i.sameSite?i.sameSite.toLowerCase():i.sameSite){case!0:case"strict":c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;default:throw TypeError("option sameSite is invalid")}return c};var r=decodeURIComponent,n=encodeURIComponent,i=/; */,s=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/},8101:function(t,e){e.read=function(t,e,r,n,i){var s,a,o=8*i-n-1,c=(1<<o)-1,l=c>>1,u=-7,h=r?i-1:0,p=r?-1:1,f=t[e+h];for(h+=p,s=f&(1<<-u)-1,f>>=-u,u+=o;u>0;s=256*s+t[e+h],h+=p,u-=8);for(a=s&(1<<-u)-1,s>>=-u,u+=n;u>0;a=256*a+t[e+h],h+=p,u-=8);if(0===s)s=1-l;else{if(s===c)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=l}return(f?-1:1)*a*Math.pow(2,s-n)},e.write=function(t,e,r,n,i,s){var a,o,c,l=8*s-i-1,u=(1<<l)-1,h=u>>1,p=23===i?5960464477539062e-23:0,f=n?0:s-1,d=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(isNaN(e=Math.abs(e))||e===1/0?(o=isNaN(e)?1:0,a=u):(a=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-a))<1&&(a--,c*=2),a+h>=1?e+=p/c:e+=p*Math.pow(2,1-h),e*c>=2&&(a++,c/=2),a+h>=u?(o=0,a=u):a+h>=1?(o=(e*c-1)*Math.pow(2,i),a+=h):(o=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[r+f]=255&o,f+=d,o/=256,i-=8);for(a=a<<i|o,l+=i;l>0;t[r+f]=255&a,f+=d,a/=256,l-=8);t[r+f-d]|=128*y}},5385:function(t){var e,r,n=Object.prototype,i=Function.prototype.toString,s=n.hasOwnProperty,a=i.call(Object),o=n.toString,c=(e=Object.getPrototypeOf,r=Object,function(t){return e(r(t))});t.exports=function(t){if(!(t&&"object"==typeof t)||"[object Object]"!=o.call(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t))return!1;var e=c(t);if(null===e)return!0;var r=s.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&i.call(r)==a}},5173:function(t){"use strict";var e=Object.assign.bind(Object);t.exports=e,t.exports.default=t.exports},6434:function(t,e,r){"use strict";var n,i;t.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(i=r.g.process)?void 0:i.env)?r.g.process:r(7669)},7669:function(t){!function(){var e={229:function(t){var e,r,n,i=t.exports={};function s(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function o(t){if(e===setTimeout)return setTimeout(t,0);if((e===s||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(r){try{return e.call(null,t,0)}catch(r){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:s}catch(t){e=s}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var c=[],l=!1,u=-1;function h(){l&&n&&(l=!1,n.length?c=n.concat(c):u=-1,c.length&&p())}function p(){if(!l){var t=o(h);l=!0;for(var e=c.length;e;){for(n=c,c=[];++u<e;)n&&n[u].run();u=-1,e=c.length}n=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function d(){}i.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new f(t,e)),1!==c.length||l||o(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=d,i.addListener=d,i.once=d,i.off=d,i.removeListener=d,i.removeAllListeners=d,i.emit=d,i.prependListener=d,i.prependOnceListener=d,i.listeners=function(t){return[]},i.binding=function(t){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},r={};function n(t){var i=r[t];if(void 0!==i)return i.exports;var s=r[t]={exports:{}},a=!0;try{e[t](s,s.exports,n),a=!1}finally{a&&delete r[t]}return s.exports}n.ab="//";var i=n(229);t.exports=i}()},2001:function(t,e,r){var n=r(6434);"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab="//"),({189:function(){!function(t,e){"use strict";if(!t.setImmediate){var r,i,s,a,o,c=1,l={},u=!1,h=t.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(t);(p=p&&p.setTimeout?p:t,"[object process]"===({}).toString.call(t.process))?o=function(t){n.nextTick(function(){d(t)})}:function(){if(t.postMessage&&!t.importScripts){var e=!0,r=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=r,e}}()?(r="setImmediate$"+Math.random()+"$",i=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(r)&&d(+e.data.slice(r.length))},t.addEventListener?t.addEventListener("message",i,!1):t.attachEvent("onmessage",i),o=function(e){t.postMessage(r+e,"*")}):t.MessageChannel?((s=new MessageChannel).port1.onmessage=function(t){d(t.data)},o=function(t){s.port2.postMessage(t)}):h&&"onreadystatechange"in h.createElement("script")?(a=h.documentElement,o=function(t){var e=h.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,a.removeChild(e),e=null},a.appendChild(e)}):o=function(t){setTimeout(d,0,t)},p.setImmediate=function(t){"function"!=typeof t&&(t=Function(""+t));for(var e=Array(arguments.length-1),r=0;r<e.length;r++)e[r]=arguments[r+1];var n={callback:t,args:e};return l[c]=n,o(c),c++},p.clearImmediate=f}function f(t){delete l[t]}function d(t){if(u)setTimeout(d,0,t);else{var r=l[t];if(r){u=!0;try{!function(t){var r=t.callback,n=t.args;switch(n.length){case 0:r();break;case 1:r(n[0]);break;case 2:r(n[0],n[1]);break;case 3:r(n[0],n[1],n[2]);break;default:r.apply(e,n)}}(r)}finally{f(t),u=!1}}}}}("undefined"==typeof self?void 0===r.g?this:r.g:self)}})[189](),t.exports={}},794:function(t,e,r){"use strict";var n=r(8450);function i(){}function s(){}s.resetWarningCache=i,t.exports=function(){function t(t,e,r,i,s,a){if(a!==n){var o=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function e(){return t}t.isRequired=t;var r={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:s,resetWarningCache:i};return r.PropTypes=r,r}},6988:function(t,e,r){t.exports=r(794)()},8450:function(t){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},3309:function(t,e,r){"use strict";var n=r(6434),i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=o(r(2812)),a=o(r(5173));function o(t){return t&&t.__esModule?t:{default:t}}var c="undefined"==typeof document||void 0!==n&&n.env&&!1,l={},u=void 0;function h(){return u&&!u.headersSent}function p(t){l=t?s.default.parse(t):{}}e.ZP={setRawCookie:p,load:function(t,e){var r=c?l:s.default.parse(document.cookie),n=r&&r[t];if(void 0===e&&(e=!n||"{"!==n[0]&&"["!==n[0]),!e)try{n=JSON.parse(n)}catch(t){}return n},loadAll:function(t){var e=c?l:s.default.parse(document.cookie);if(void 0===t&&(t=!e||"{"!==e[0]&&"["!==e[0]),!t)try{e=JSON.parse(e)}catch(t){}return e},select:function(t){var e=c?l:s.default.parse(document.cookie);return e?t?Object.keys(e).reduce(function(r,n){if(!t.test(n))return r;var i={};return i[n]=e[n],(0,a.default)({},r,i)},{}):e:{}},save:function(t,e,r){l[t]=e,(void 0===e?"undefined":i(e))==="object"&&(l[t]=JSON.stringify(e)),c||(document.cookie=s.default.serialize(t,l[t],r)),h()&&u.cookie&&u.cookie(t,e,r)},remove:function(t,e){delete l[t],e=void 0===e?{}:"string"==typeof e?{path:e}:(0,a.default)({},e),"undefined"!=typeof document&&(e.expires=new Date(1970,1,1,0,0,1),e.maxAge=0,document.cookie=s.default.serialize(t,"",e)),h()&&u.clearCookie&&u.clearCookie(t,e)},plugToRequest:function(t,e){return t.cookie?l=t.cookie:t.cookies?l=t.cookies:t.headers&&t.headers.cookie?p(t.headers.cookie):l={},u=e,function(){u=null,l={}}}}},2713:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.diffAny=e.diffObjects=e.diffArrays=e.intersection=e.subtract=e.isDestructive=void 0;var n=r(8498);function i(t,e){var r={};for(var i in t)n.hasOwnProperty.call(t,i)&&void 0!==t[i]&&(r[i]=1);for(var s in e)n.hasOwnProperty.call(e,s)&&void 0!==e[s]&&delete r[s];return Object.keys(r)}function s(t){for(var e=t.length,r={},i=0;i<e;i++){var s=t[i];for(var a in s)n.hasOwnProperty.call(s,a)&&void 0!==s[a]&&(r[a]=(r[a]||0)+1)}for(var a in r)r[a]<e&&delete r[a];return Object.keys(r)}function a(t,e){return{operations:t.operations.concat(e),cost:t.cost+1}}function o(t,e,r,n){void 0===n&&(n=l);var i={"0,0":{operations:[],cost:0}},s=isNaN(t.length)||t.length<=0?0:t.length;return(function s(o,c){var l="".concat(o,",").concat(c),u=i[l];if(void 0===u){if(o>0&&c>0&&!n(t[o-1],e[c-1],r.add(String(o-1))).length)u=s(o-1,c-1);else{var h=[];if(o>0){var p=s(o-1,c);h.push(a(p,{op:"remove",index:o-1}))}if(c>0){var f=s(o,c-1),d={op:"add",index:o-1,value:e[c-1]};h.push(a(f,d))}if(o>0&&c>0){var y=s(o-1,c-1),g={op:"replace",index:o-1,original:t[o-1],value:e[c-1]};h.push(a(y,g))}u=h.sort(function(t,e){return t.cost-e.cost})[0]}i[l]=u}return u})(s,isNaN(e.length)||e.length<=0?0:e.length).operations.reduce(function(t,e){var i=t[0],a=t[1];if("add"===e.op){var o=e.index+1+a,c=o<s+a?String(o):"-",l={op:e.op,path:r.add(c).toString(),value:e.value};return[i.concat(l),a+1]}if("remove"===e.op){var l={op:e.op,path:r.add(String(e.index+a)).toString()};return[i.concat(l),a-1]}var u=r.add(String(e.index+a)),h=n(e.original,e.value,u);return[i.concat.apply(i,h),a]},[[],0])[0]}function c(t,e,r,n){void 0===n&&(n=l);var a=[];return i(t,e).forEach(function(t){a.push({op:"remove",path:r.add(t).toString()})}),i(e,t).forEach(function(t){a.push({op:"add",path:r.add(t).toString(),value:e[t]})}),s([t,e]).forEach(function(i){a.push.apply(a,n(t[i],e[i],r.add(i)))}),a}function l(t,e,r,i){if(void 0===i&&(i=l),t===e)return[];var s=(0,n.objectType)(t),a=(0,n.objectType)(e);return"array"==s&&"array"==a?o(t,e,r,i):"object"==s&&"object"==a?c(t,e,r,i):[{op:"replace",path:r.toString(),value:e}]}e.isDestructive=function(t){var e=t.op;return"remove"===e||"replace"===e||"copy"===e||"move"===e},e.subtract=i,e.intersection=s,e.diffArrays=o,e.diffObjects=c,e.diffAny=l},8074:function(t,e,r){"use strict";e.rh=e.af=void 0;var n=r(8324),i=r(113),s=r(2713);e.af=function(t,e){return e.map(function(e){return(0,i.apply)(t,e)})},e.rh=function(t,e,r){var i=new n.Pointer;return(r?function t(e,n,i){var a=r(e,n,i);return Array.isArray(a)?a:(0,s.diffAny)(e,n,i,t)}:s.diffAny)(t,e,i)}},113:function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.apply=e.InvalidOperationError=e.test=e.copy=e.move=e.replace=e.remove=e.add=e.TestError=e.MissingError=void 0;var s=r(8324),a=r(8498),o=r(2713),c=function(t){function e(e){var r=t.call(this,"Value required at path: ".concat(e))||this;return r.path=e,r.name="MissingError",r}return i(e,t),e}(Error);e.MissingError=c;var l=function(t){function e(e,r){var n=t.call(this,"Test failed: ".concat(e," != ").concat(r))||this;return n.actual=e,n.expected=r,n.name="TestError",n}return i(e,t),e}(Error);function u(t,e,r){if(Array.isArray(t)){if("-"==e)t.push(r);else{var n=parseInt(e,10);t.splice(n,0,r)}}else t[e]=r}function h(t,e){if(Array.isArray(t)){var r=parseInt(e,10);t.splice(r,1)}else delete t[e]}function p(t,e){var r=s.Pointer.fromJSON(e.path).evaluate(t);return void 0===r.parent?new c(e.path):(u(r.parent,r.key,(0,a.clone)(e.value)),null)}function f(t,e){var r=s.Pointer.fromJSON(e.path).evaluate(t);return void 0===r.value?new c(e.path):(h(r.parent,r.key),null)}function d(t,e){var r=s.Pointer.fromJSON(e.path).evaluate(t);if(null===r.parent)return new c(e.path);if(Array.isArray(r.parent)){if(parseInt(r.key,10)>=r.parent.length)return new c(e.path)}else if(void 0===r.value)return new c(e.path);return r.parent[r.key]=(0,a.clone)(e.value),null}function y(t,e){var r=s.Pointer.fromJSON(e.from).evaluate(t);if(void 0===r.value)return new c(e.from);var n=s.Pointer.fromJSON(e.path).evaluate(t);return void 0===n.parent?new c(e.path):(h(r.parent,r.key),u(n.parent,n.key,r.value),null)}function g(t,e){var r=s.Pointer.fromJSON(e.from).evaluate(t);if(void 0===r.value)return new c(e.from);var n=s.Pointer.fromJSON(e.path).evaluate(t);return void 0===n.parent?new c(e.path):(u(n.parent,n.key,(0,a.clone)(r.value)),null)}function m(t,e){var r=s.Pointer.fromJSON(e.path).evaluate(t);return(0,o.diffAny)(r.value,e.value,new s.Pointer).length?new l(r.value,e.value):null}e.TestError=l,e.add=p,e.remove=f,e.replace=d,e.move=y,e.copy=g,e.test=m;var v=function(t){function e(e){var r=t.call(this,"Invalid operation: ".concat(e.op))||this;return r.operation=e,r.name="InvalidOperationError",r}return i(e,t),e}(Error);e.InvalidOperationError=v,e.apply=function(t,e){switch(e.op){case"add":return p(t,e);case"remove":return f(t,e);case"replace":return d(t,e);case"move":return y(t,e);case"copy":return g(t,e);case"test":return m(t,e)}return new v(e)}},8324:function(t,e){"use strict";function r(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function n(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(e,"__esModule",{value:!0}),e.Pointer=void 0;var i=function(){function t(t){void 0===t&&(t=[""]),this.tokens=t}return t.fromJSON=function(e){var n=e.split("/").map(r);if(""!==n[0])throw Error("Invalid JSON Pointer: ".concat(e));return new t(n)},t.prototype.toString=function(){return this.tokens.map(n).join("/")},t.prototype.evaluate=function(t){for(var e=null,r="",n=t,i=1,s=this.tokens.length;i<s;i++)e=n,"__proto__"!=(r=this.tokens[i])&&"constructor"!=r&&"prototype"!=r&&(n=(e||{})[r]);return{parent:e,key:r,value:n}},t.prototype.get=function(t){return this.evaluate(t).value},t.prototype.set=function(t,e){var r=this.evaluate(t);r.parent&&(r.parent[r.key]=e)},t.prototype.push=function(t){this.tokens.push(t)},t.prototype.add=function(e){return new t(this.tokens.concat(String(e)))},t}();e.Pointer=i},8498:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.clone=e.objectType=e.hasOwnProperty=void 0,e.hasOwnProperty=Object.prototype.hasOwnProperty,e.objectType=function(t){return void 0===t?"undefined":null===t?"null":Array.isArray(t)?"array":typeof t},e.clone=function t(r){if(!(null!=r&&"object"==typeof r))return r;if(r.constructor==Array){for(var n=r.length,i=Array(n),s=0;s<n;s++)i[s]=t(r[s]);return i}if(r.constructor==Date)return new Date(+r);var a={};for(var o in r)e.hasOwnProperty.call(r,o)&&(a[o]=t(r[o]));return a}}}]);